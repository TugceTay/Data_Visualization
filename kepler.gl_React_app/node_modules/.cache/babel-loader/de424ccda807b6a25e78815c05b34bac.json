{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport Vector3 from './vector3';\nimport { formatValue, equals, config } from '../lib/common';\nimport { degrees, radians, clamp } from '../lib/common';\nimport * as vec3 from 'gl-matrix/vec3';\nconst EPSILON = 0.000001;\nconst EARTH_RADIUS_METERS = 6371000;\nexport default class SphericalCoordinates {\n  constructor() {\n    let {\n      phi = 0,\n      theta = 0,\n      radius = 1,\n      bearing,\n      pitch,\n      altitude,\n      radiusScale = EARTH_RADIUS_METERS\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _defineProperty(this, \"phi\", void 0);\n    _defineProperty(this, \"theta\", void 0);\n    _defineProperty(this, \"radius\", void 0);\n    _defineProperty(this, \"radiusScale\", void 0);\n    this.phi = phi;\n    this.theta = theta;\n    this.radius = radius || altitude || 1;\n    this.radiusScale = radiusScale || 1;\n    if (bearing !== undefined) {\n      this.bearing = bearing;\n    }\n    if (pitch !== undefined) {\n      this.pitch = pitch;\n    }\n    this.check();\n  }\n  toString() {\n    return this.formatString(config);\n  }\n  formatString(_ref) {\n    let {\n      printTypes = false\n    } = _ref;\n    const f = formatValue;\n    return \"\".concat(printTypes ? 'Spherical' : '', \"[rho:\").concat(f(this.radius), \",theta:\").concat(f(this.theta), \",phi:\").concat(f(this.phi), \"]\");\n  }\n  equals(other) {\n    return equals(this.radius, other.radius) && equals(this.theta, other.theta) && equals(this.phi, other.phi);\n  }\n  exactEquals(other) {\n    return this.radius === other.radius && this.theta === other.theta && this.phi === other.phi;\n  }\n  get bearing() {\n    return 180 - degrees(this.phi);\n  }\n  set bearing(v) {\n    this.phi = Math.PI - radians(v);\n  }\n  get pitch() {\n    return degrees(this.theta);\n  }\n  set pitch(v) {\n    this.theta = radians(v);\n  }\n  get longitude() {\n    return degrees(this.phi);\n  }\n  get latitude() {\n    return degrees(this.theta);\n  }\n  get lng() {\n    return degrees(this.phi);\n  }\n  get lat() {\n    return degrees(this.theta);\n  }\n  get z() {\n    return (this.radius - 1) * this.radiusScale;\n  }\n  set(radius, phi, theta) {\n    this.radius = radius;\n    this.phi = phi;\n    this.theta = theta;\n    return this.check();\n  }\n  clone() {\n    return new SphericalCoordinates().copy(this);\n  }\n  copy(other) {\n    this.radius = other.radius;\n    this.phi = other.phi;\n    this.theta = other.theta;\n    return this.check();\n  }\n  fromLngLatZ(_ref2) {\n    let [lng, lat, z] = _ref2;\n    this.radius = 1 + z / this.radiusScale;\n    this.phi = radians(lat);\n    this.theta = radians(lng);\n    return this.check();\n  }\n  fromVector3(v) {\n    this.radius = vec3.length(v);\n    if (this.radius > 0) {\n      this.theta = Math.atan2(v[0], v[1]);\n      this.phi = Math.acos(clamp(v[2] / this.radius, -1, 1));\n    }\n    return this.check();\n  }\n  toVector3() {\n    return new Vector3(0, 0, this.radius).rotateX({\n      radians: this.theta\n    }).rotateZ({\n      radians: this.phi\n    });\n  }\n  makeSafe() {\n    this.phi = Math.max(EPSILON, Math.min(Math.PI - EPSILON, this.phi));\n    return this;\n  }\n  check() {\n    if (!Number.isFinite(this.phi) || !Number.isFinite(this.theta) || !(this.radius > 0)) {\n      throw new Error('SphericalCoordinates: some fields set to invalid numbers');\n    }\n    return this;\n  }\n}","map":{"version":3,"sources":["../../../src/classes/spherical-coordinates.ts"],"names":["Vector3","formatValue","equals","config","degrees","radians","clamp","vec3","EPSILON","EARTH_RADIUS_METERS","SphericalCoordinates","constructor","phi","theta","radius","bearing","pitch","altitude","radiusScale","undefined","check","toString","formatString","printTypes","f","other","exactEquals","v","Math","PI","longitude","latitude","lng","lat","z","set","clone","copy","fromLngLatZ","fromVector3","length","atan2","acos","toVector3","rotateX","rotateZ","makeSafe","max","min","Number","isFinite","Error"],"mappings":"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","sourcesContent":["// Copyright (c) 2017 Uber Technologies, Inc.\n// MIT License\n// Adaptation of THREE.js Spherical class, under MIT license\nimport Vector3 from './vector3';\nimport {formatValue, equals, config} from '../lib/common';\nimport {degrees, radians, clamp} from '../lib/common';\nimport * as vec3 from 'gl-matrix/vec3';\nimport {NumericArray} from '@math.gl/types';\n\ntype SphericalCoordinatesOptions = {\n  phi?: number;\n  theta?: number;\n  radius?: number;\n  bearing?: number;\n  pitch?: number;\n  altitude?: number;\n  radiusScale?: number;\n};\n\ntype FormatOptions = {\n  printTypes?: boolean;\n};\n\n// TODO - import epsilon\nconst EPSILON = 0.000001;\nconst EARTH_RADIUS_METERS = 6371000;\n\n/**\n * The poles (phi) are at the positive and negative y axis.\n * The equator starts at positive z.\n * @link https://en.wikipedia.org/wiki/Spherical_coordinate_system\n */\nexport default class SphericalCoordinates {\n  phi: number;\n  theta: number;\n  radius: number;\n  radiusScale: number;\n  // bearing: number;\n  // pitch: number;\n  // altitude: number;\n\n  // lnglatZ coordinates\n  // longitude: number;\n  // latitude: number;\n  // lng: number;\n  // lat: number;\n  // z: number;\n\n  /**\n   * Creates a new SphericalCoordinates object\n   * @param options\n   * @param [options.phi] =0 - rotation around X (latitude)\n   * @param [options.theta] =0 - rotation around Y (longitude)\n   * @param [options.radius] =1 - Distance from center\n   * @param [options.bearing]\n   * @param [options.pitch]\n   * @param [options.altitude]\n   * @param [options.radiusScale] =1\n   */\n  // eslint-disable-next-line complexity\n  constructor({\n    phi = 0,\n    theta = 0,\n    radius = 1,\n    bearing,\n    pitch,\n    altitude,\n    radiusScale = EARTH_RADIUS_METERS\n  }: SphericalCoordinatesOptions = {}) {\n    this.phi = phi;\n    this.theta = theta;\n    // TODO - silently accepts illegal 0\n    this.radius = radius || altitude || 1; // radial distance from center\n    this.radiusScale = radiusScale || 1; // Used by lngLatZ\n    if (bearing !== undefined) {\n      this.bearing = bearing; // up / down towards top and bottom pole\n    }\n    if (pitch !== undefined) {\n      this.pitch = pitch; // around the equator of the sphere\n    }\n    this.check();\n  }\n\n  toString(): string {\n    return this.formatString(config);\n  }\n\n  formatString({printTypes = false}: FormatOptions): string {\n    const f = formatValue;\n    return `${printTypes ? 'Spherical' : ''}\\\n[rho:${f(this.radius)},theta:${f(this.theta)},phi:${f(this.phi)}]`;\n  }\n\n  equals(other: SphericalCoordinates): boolean {\n    return (\n      equals(this.radius, other.radius) &&\n      equals(this.theta, other.theta) &&\n      equals(this.phi, other.phi)\n    );\n  }\n\n  exactEquals(other: SphericalCoordinates): boolean {\n    return this.radius === other.radius && this.theta === other.theta && this.phi === other.phi;\n  }\n\n  /* eslint-disable brace-style */\n  // Cartographic (bearing 0 north, pitch 0 look from above)\n  get bearing(): number {\n    return 180 - degrees(this.phi);\n  }\n\n  set bearing(v: number) {\n    this.phi = Math.PI - radians(v);\n  }\n\n  get pitch(): number {\n    return degrees(this.theta);\n  }\n\n  set pitch(v: number) {\n    this.theta = radians(v);\n  }\n\n  // get pitch() { return 90 - degrees(this.phi); }\n  // set pitch(v) { this.phi = radians(v) + Math.PI / 2; }\n  // get altitude() { return this.radius - 1; } // relative altitude\n  // lnglatZ coordinates\n  get longitude(): number {\n    return degrees(this.phi);\n  }\n\n  get latitude(): number {\n    return degrees(this.theta);\n  }\n\n  get lng(): number {\n    return degrees(this.phi);\n  }\n\n  get lat(): number {\n    return degrees(this.theta);\n  }\n\n  get z(): number {\n    return (this.radius - 1) * this.radiusScale;\n  }\n\n  /* eslint-enable brace-style */\n  set(radius: number, phi: number, theta: number): this {\n    this.radius = radius;\n    this.phi = phi;\n    this.theta = theta;\n    return this.check();\n  }\n\n  clone(): SphericalCoordinates {\n    return new SphericalCoordinates().copy(this);\n  }\n\n  copy(other: SphericalCoordinates): this {\n    this.radius = other.radius;\n    this.phi = other.phi;\n    this.theta = other.theta;\n    return this.check();\n  }\n\n  fromLngLatZ([lng, lat, z]: [number, number, number]): this {\n    this.radius = 1 + z / this.radiusScale;\n    this.phi = radians(lat);\n    this.theta = radians(lng);\n    return this.check();\n  }\n\n  fromVector3(v: Readonly<NumericArray>): this {\n    this.radius = vec3.length(v);\n    if (this.radius > 0) {\n      this.theta = Math.atan2(v[0], v[1]); // equator angle around y-up axis\n      this.phi = Math.acos(clamp(v[2] / this.radius, -1, 1)); // polar angle\n    }\n    return this.check();\n  }\n\n  toVector3(): Vector3 {\n    return new Vector3(0, 0, this.radius)\n      .rotateX({radians: this.theta})\n      .rotateZ({radians: this.phi});\n  }\n\n  // restrict phi to be betwee EPS and PI-EPS\n  makeSafe(): this {\n    this.phi = Math.max(EPSILON, Math.min(Math.PI - EPSILON, this.phi));\n    return this;\n  }\n\n  check(): this {\n    // this.makeSafe();\n    if (!Number.isFinite(this.phi) || !Number.isFinite(this.theta) || !(this.radius > 0)) {\n      throw new Error('SphericalCoordinates: some fields set to invalid numbers');\n    }\n    return this;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}