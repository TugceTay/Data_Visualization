{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.mapStateToProps = mapStateToProps;\nexports[\"default\"] = exports.DEFAULT_KEPLER_GL_PROPS = exports.notificationPanelSelector = exports.geoCoderPanelSelector = exports.modalContainerSelector = exports.bottomWidgetSelector = exports.isSplitSelector = exports.plotContainerSelector = exports.sidePanelSelector = exports.mapFieldsSelector = void 0;\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _console = _interopRequireDefault(require(\"global/console\"));\nvar _redux = require(\"redux\");\nvar _styledComponents = _interopRequireWildcard(require(\"styled-components\"));\nvar _reselect = require(\"reselect\");\nvar _keplerglConnect = require(\"../connect/keplergl-connect\");\nvar _reactIntl = require(\"react-intl\");\nvar _localization = require(\"../localization\");\nvar _context = require(\"./context\");\nvar VisStateActions = _interopRequireWildcard(require(\"../actions/vis-state-actions\"));\nvar MapStateActions = _interopRequireWildcard(require(\"../actions/map-state-actions\"));\nvar MapStyleActions = _interopRequireWildcard(require(\"../actions/map-style-actions\"));\nvar UIStateActions = _interopRequireWildcard(require(\"../actions/ui-state-actions\"));\nvar ProviderActions = _interopRequireWildcard(require(\"../actions/provider-actions\"));\nvar _defaultSettings = require(\"../constants/default-settings\");\nvar _userFeedbacks = require(\"../constants/user-feedbacks\");\nvar _sidePanel = _interopRequireDefault(require(\"./side-panel\"));\nvar _mapContainer = _interopRequireDefault(require(\"./map-container\"));\nvar _mapsLayout = _interopRequireDefault(require(\"./maps-layout\"));\nvar _bottomWidget = _interopRequireDefault(require(\"./bottom-widget\"));\nvar _modalContainer = _interopRequireDefault(require(\"./modal-container\"));\nvar _plotContainer = _interopRequireDefault(require(\"./plot-container\"));\nvar _notificationPanel = _interopRequireDefault(require(\"./notification-panel\"));\nvar _geocoderPanel = _interopRequireDefault(require(\"./geocoder-panel\"));\nvar _utils = require(\"../utils/utils\");\nvar _mapboxUtils = require(\"../utils/mapbox-utils\");\nvar _localeUtils = require(\"../utils/locale-utils\");\nvar _base = require(\"../styles/base\");\nvar _observeDimensions = require(\"../utils/observe-dimensions\");\nvar _templateObject;\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n// Maybe we should think about exporting this or creating a variable\n// as part of the base.js theme\nvar GlobalStyle = _styledComponents[\"default\"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  font-family: \", \";\\n  font-weight: \", \";\\n  font-size: \", \";\\n  line-height: \", \";\\n\\n  *,\\n  *:before,\\n  *:after {\\n    -webkit-box-sizing: border-box;\\n    -moz-box-sizing: border-box;\\n    box-sizing: border-box;\\n  }\\n\\n  ul {\\n    margin: 0;\\n    padding: 0;\\n  }\\n\\n  li {\\n    margin: 0;\\n  }\\n\\n  a {\\n    text-decoration: none;\\n    color: \", \";\\n  }\\n\\n  .mapboxgl-ctrl .mapboxgl-ctrl-logo {\\n    display: none;\\n  }\\n\"])), function (props) {\n  return props.theme.fontFamily;\n}, function (props) {\n  return props.theme.fontWeight;\n}, function (props) {\n  return props.theme.fontSize;\n}, function (props) {\n  return props.theme.lineHeight;\n}, function (props) {\n  return props.theme.labelColor;\n});\nvar BottomWidgetOuter = _styledComponents[\"default\"].div(function (_ref) {\n  var absolute = _ref.absolute;\n  return \"\\n  \".concat(absolute ? 'position: absolute; bottom: 0; right: 0;' : '', \"\\n  pointer-events: none; /* prevent padding from blocking input */\\n  & > * {\\n    /* all children should allow input */\\n    pointer-events: all;\\n  }\");\n});\nvar mapFieldsSelector = function mapFieldsSelector(props) {\n  return {\n    getMapboxRef: props.getMapboxRef,\n    mapboxApiAccessToken: props.mapboxApiAccessToken,\n    mapboxApiUrl: props.mapboxApiUrl,\n    mapState: props.mapState,\n    mapStyle: props.mapStyle,\n    onDeckInitialized: props.onDeckInitialized,\n    onViewStateChange: props.onViewStateChange,\n    deckGlProps: props.deckGlProps,\n    uiStateActions: props.uiStateActions,\n    visStateActions: props.visStateActions,\n    mapStateActions: props.mapStateActions,\n    // visState\n    editor: props.visState.editor,\n    datasets: props.visState.datasets,\n    layers: props.visState.layers,\n    layerOrder: props.visState.layerOrder,\n    layerData: props.visState.layerData,\n    layerBlending: props.visState.layerBlending,\n    filters: props.visState.filters,\n    interactionConfig: props.visState.interactionConfig,\n    hoverInfo: props.visState.hoverInfo,\n    clicked: props.visState.clicked,\n    mousePos: props.visState.mousePos,\n    animationConfig: props.visState.animationConfig,\n    // uiState\n    activeSidePanel: props.uiState.activeSidePanel,\n    mapControls: props.uiState.mapControls,\n    readOnly: props.uiState.readOnly,\n    locale: props.uiState.locale\n  };\n};\nexports.mapFieldsSelector = mapFieldsSelector;\nvar sidePanelSelector = function sidePanelSelector(props, availableProviders) {\n  return {\n    appName: props.appName,\n    version: props.version,\n    appWebsite: props.appWebsite,\n    mapStyle: props.mapStyle,\n    onSaveMap: props.onSaveMap,\n    uiState: props.uiState,\n    mapStyleActions: props.mapStyleActions,\n    visStateActions: props.visStateActions,\n    uiStateActions: props.uiStateActions,\n    datasets: props.visState.datasets,\n    filters: props.visState.filters,\n    layers: props.visState.layers,\n    layerOrder: props.visState.layerOrder,\n    layerClasses: props.visState.layerClasses,\n    interactionConfig: props.visState.interactionConfig,\n    mapInfo: props.visState.mapInfo,\n    layerBlending: props.visState.layerBlending,\n    width: props.sidePanelWidth,\n    availableProviders: availableProviders,\n    mapSaved: props.providerState.mapSaved\n  };\n};\nexports.sidePanelSelector = sidePanelSelector;\nvar plotContainerSelector = function plotContainerSelector(props) {\n  return {\n    width: props.width,\n    height: props.height,\n    exportImageSetting: props.uiState.exportImage,\n    mapFields: mapFieldsSelector(props),\n    addNotification: props.uiStateActions.addNotification,\n    setExportImageSetting: props.uiStateActions.setExportImageSetting,\n    setExportImageDataUri: props.uiStateActions.setExportImageDataUri,\n    setExportImageError: props.uiStateActions.setExportImageError,\n    splitMaps: props.visState.splitMaps\n  };\n};\nexports.plotContainerSelector = plotContainerSelector;\nvar isSplitSelector = function isSplitSelector(props) {\n  return props.visState.splitMaps && props.visState.splitMaps.length > 1;\n};\nexports.isSplitSelector = isSplitSelector;\nvar bottomWidgetSelector = function bottomWidgetSelector(props, theme) {\n  return {\n    filters: props.visState.filters,\n    datasets: props.visState.datasets,\n    uiState: props.uiState,\n    layers: props.visState.layers,\n    animationConfig: props.visState.animationConfig,\n    visStateActions: props.visStateActions,\n    toggleModal: props.uiStateActions.toggleModal,\n    sidePanelWidth: props.uiState.readOnly ? 0 : props.sidePanelWidth + theme.sidePanel.margin.left\n  };\n};\nexports.bottomWidgetSelector = bottomWidgetSelector;\nvar modalContainerSelector = function modalContainerSelector(props, rootNode) {\n  return {\n    appName: props.appName,\n    mapStyle: props.mapStyle,\n    visState: props.visState,\n    mapState: props.mapState,\n    uiState: props.uiState,\n    providerState: props.providerState,\n    mapboxApiAccessToken: props.mapboxApiAccessToken,\n    mapboxApiUrl: props.mapboxApiUrl,\n    visStateActions: props.visStateActions,\n    uiStateActions: props.uiStateActions,\n    mapStyleActions: props.mapStyleActions,\n    providerActions: props.providerActions,\n    rootNode: rootNode,\n    // User defined cloud provider props\n    cloudProviders: props.cloudProviders,\n    onExportToCloudSuccess: props.onExportToCloudSuccess,\n    onLoadCloudMapSuccess: props.onLoadCloudMapSuccess,\n    onLoadCloudMapError: props.onLoadCloudMapError,\n    onExportToCloudError: props.onExportToCloudError\n  };\n};\nexports.modalContainerSelector = modalContainerSelector;\nvar geoCoderPanelSelector = function geoCoderPanelSelector(props) {\n  return {\n    isGeocoderEnabled: props.visState.interactionConfig.geocoder.enabled,\n    mapboxApiAccessToken: props.mapboxApiAccessToken,\n    mapState: props.mapState,\n    updateVisData: props.visStateActions.updateVisData,\n    removeDataset: props.visStateActions.removeDataset,\n    updateMap: props.mapStateActions.updateMap\n  };\n};\nexports.geoCoderPanelSelector = geoCoderPanelSelector;\nvar notificationPanelSelector = function notificationPanelSelector(props) {\n  return {\n    removeNotification: props.uiStateActions.removeNotification,\n    notifications: props.uiState.notifications\n  };\n};\nexports.notificationPanelSelector = notificationPanelSelector;\nvar DEFAULT_KEPLER_GL_PROPS = {\n  mapStyles: [],\n  mapStylesReplaceDefault: false,\n  mapboxApiUrl: _defaultSettings.DEFAULT_MAPBOX_API_URL,\n  width: 800,\n  height: 800,\n  appName: _defaultSettings.KEPLER_GL_NAME,\n  version: _defaultSettings.KEPLER_GL_VERSION,\n  sidePanelWidth: _defaultSettings.DIMENSIONS.sidePanel.width,\n  theme: {},\n  cloudProviders: [],\n  readOnly: false\n};\nexports.DEFAULT_KEPLER_GL_PROPS = DEFAULT_KEPLER_GL_PROPS;\nKeplerGlFactory.deps = [_bottomWidget[\"default\"], _geocoderPanel[\"default\"], _mapContainer[\"default\"], _mapsLayout[\"default\"], _modalContainer[\"default\"], _sidePanel[\"default\"], _plotContainer[\"default\"], _notificationPanel[\"default\"]];\nfunction KeplerGlFactory(BottomWidget, GeoCoderPanel, MapContainer, MapsLayout, ModalContainer, SidePanel, PlotContainer, NotificationPanel) {\n  /** @typedef {import('./kepler-gl').UnconnectedKeplerGlProps} KeplerGlProps */\n\n  /** @augments React.Component<KeplerGlProps> */\n  var KeplerGL = /*#__PURE__*/function (_Component) {\n    (0, _inherits2[\"default\"])(KeplerGL, _Component);\n    var _super = _createSuper(KeplerGL);\n    function KeplerGL() {\n      var _this;\n      (0, _classCallCheck2[\"default\"])(this, KeplerGL);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"state\", {\n        dimensions: null\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_handleResize\", function (dimensions) {\n        _this.setState({\n          dimensions: dimensions\n        });\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"root\", /*#__PURE__*/(0, _react.createRef)());\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"bottomWidgetRef\", /*#__PURE__*/(0, _react.createRef)());\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"themeSelector\", function (props) {\n        return props.theme;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"availableThemeSelector\", (0, _reselect.createSelector)(_this.themeSelector, function (theme) {\n        return (0, _typeof2[\"default\"])(theme) === 'object' ? _objectSpread(_objectSpread({}, _base.theme), theme) : theme === _defaultSettings.THEME.light ? _base.themeLT : theme === _defaultSettings.THEME.base ? _base.themeBS : theme;\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"availableProviders\", (0, _reselect.createSelector)(function (props) {\n        return props.cloudProviders;\n      }, function (providers) {\n        return Array.isArray(providers) && providers.length ? {\n          hasStorage: providers.some(function (p) {\n            return p.hasPrivateStorage();\n          }),\n          hasShare: providers.some(function (p) {\n            return p.hasSharingUrl();\n          })\n        } : {};\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"localeMessagesSelector\", (0, _reselect.createSelector)(function (props) {\n        return props.localeMessages;\n      }, function (customMessages) {\n        return customMessages ? (0, _localeUtils.mergeMessages)(_localization.messages, customMessages) : _localization.messages;\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_loadMapStyle\", function () {\n        var defaultStyles = Object.values(_this.props.mapStyle.mapStyles); // add id to custom map styles if not given\n\n        var customStyles = (_this.props.mapStyles || []).map(function (ms) {\n          return _objectSpread(_objectSpread({}, ms), {}, {\n            id: ms.id || (0, _utils.generateHashId)()\n          });\n        });\n        var allStyles = [].concat((0, _toConsumableArray2[\"default\"])(customStyles), (0, _toConsumableArray2[\"default\"])(defaultStyles)).reduce(function (accu, style) {\n          var hasStyleObject = style.style && (0, _typeof2[\"default\"])(style.style) === 'object';\n          accu[hasStyleObject ? 'toLoad' : 'toRequest'][style.id] = style;\n          return accu;\n        }, {\n          toLoad: {},\n          toRequest: {}\n        });\n        _this.props.mapStyleActions.loadMapStyles(allStyles.toLoad);\n        _this.props.mapStyleActions.requestMapStyles(allStyles.toRequest);\n      });\n      return _this;\n    }\n    (0, _createClass2[\"default\"])(KeplerGL, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        this._validateMapboxToken();\n        this._loadMapStyle();\n        if (typeof this.props.onKeplerGlInitialized === 'function') {\n          this.props.onKeplerGlInitialized();\n        }\n        if (this.root.current instanceof HTMLElement) {\n          (0, _observeDimensions.observeDimensions)(this.root.current, this._handleResize);\n        }\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        if (this.root.current instanceof HTMLElement) {\n          (0, _observeDimensions.unobserveDimensions)(this.root.current);\n        }\n      }\n    }, {\n      key: \"_validateMapboxToken\",\n      value: /* private methods */\n      function _validateMapboxToken() {\n        var mapboxApiAccessToken = this.props.mapboxApiAccessToken;\n        if (!(0, _mapboxUtils.validateToken)(mapboxApiAccessToken)) {\n          _console[\"default\"].warn(_userFeedbacks.MISSING_MAPBOX_TOKEN);\n        }\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var _this$props = this.props,\n          id = _this$props.id,\n          width = _this$props.width,\n          height = _this$props.height,\n          uiState = _this$props.uiState,\n          visState = _this$props.visState,\n          readOnly = _this$props.readOnly;\n        var dimensions = this.state.dimensions || {\n          width: width,\n          height: height\n        };\n        var splitMaps = visState.splitMaps,\n          interactionConfig = visState.interactionConfig;\n        var isSplit = isSplitSelector(this.props);\n        var theme = this.availableThemeSelector(this.props);\n        var localeMessages = this.localeMessagesSelector(this.props);\n        var isExportingImage = uiState.exportImage.exporting;\n        var availableProviders = this.availableProviders(this.props);\n        var mapFields = mapFieldsSelector(this.props);\n        var sideFields = sidePanelSelector(this.props, availableProviders);\n        var plotContainerFields = plotContainerSelector(this.props);\n        var bottomWidgetFields = bottomWidgetSelector(this.props, theme);\n        var modalContainerFields = modalContainerSelector(this.props, this.root.current);\n        var geoCoderPanelFields = geoCoderPanelSelector(this.props);\n        var notificationPanelFields = notificationPanelSelector(this.props);\n        var mapContainers = !isSplit ? [/*#__PURE__*/_react[\"default\"].createElement(MapContainer, (0, _extends2[\"default\"])({\n          primary: true,\n          key: 0,\n          index: 0\n        }, mapFields, {\n          mapLayers: null\n        }))] : splitMaps.map(function (settings, index) {\n          return /*#__PURE__*/_react[\"default\"].createElement(MapContainer, (0, _extends2[\"default\"])({\n            key: index,\n            index: index,\n            primary: index === 1\n          }, mapFields, {\n            mapLayers: splitMaps[index].layers\n          }));\n        });\n        return /*#__PURE__*/_react[\"default\"].createElement(_context.RootContext.Provider, {\n          value: this.root\n        }, /*#__PURE__*/_react[\"default\"].createElement(_reactIntl.IntlProvider, {\n          locale: uiState.locale,\n          messages: localeMessages[uiState.locale]\n        }, /*#__PURE__*/_react[\"default\"].createElement(_styledComponents.ThemeProvider, {\n          theme: theme\n        }, /*#__PURE__*/_react[\"default\"].createElement(GlobalStyle, {\n          className: \"kepler-gl\",\n          id: \"kepler-gl__\".concat(id),\n          style: {\n            display: 'flex',\n            flexDirection: 'column',\n            position: 'relative',\n            width: \"\".concat(width, \"px\"),\n            height: \"\".concat(height, \"px\")\n          },\n          ref: this.root\n        }, /*#__PURE__*/_react[\"default\"].createElement(NotificationPanel, notificationPanelFields), !uiState.readOnly && !readOnly && /*#__PURE__*/_react[\"default\"].createElement(SidePanel, sideFields), /*#__PURE__*/_react[\"default\"].createElement(MapsLayout, {\n          className: \"maps\"\n        }, mapContainers), isExportingImage && /*#__PURE__*/_react[\"default\"].createElement(PlotContainer, plotContainerFields), interactionConfig.geocoder.enabled && /*#__PURE__*/_react[\"default\"].createElement(GeoCoderPanel, geoCoderPanelFields), /*#__PURE__*/_react[\"default\"].createElement(BottomWidgetOuter, {\n          absolute: true\n        }, /*#__PURE__*/_react[\"default\"].createElement(BottomWidget, (0, _extends2[\"default\"])({\n          ref: this.bottomWidgetRef\n        }, bottomWidgetFields, {\n          containerW: dimensions.width\n        }))), /*#__PURE__*/_react[\"default\"].createElement(ModalContainer, (0, _extends2[\"default\"])({}, modalContainerFields, {\n          containerW: dimensions.width,\n          containerH: dimensions.height\n        }))))));\n      }\n    }]);\n    return KeplerGL;\n  }(_react.Component);\n  (0, _defineProperty2[\"default\"])(KeplerGL, \"defaultProps\", DEFAULT_KEPLER_GL_PROPS);\n  (0, _defineProperty2[\"default\"])(KeplerGL, \"contextType\", _context.RootContext);\n  return (0, _keplerglConnect.connect)(mapStateToProps, makeMapDispatchToProps)((0, _styledComponents.withTheme)(KeplerGL));\n}\nfunction mapStateToProps() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var props = arguments.length > 1 ? arguments[1] : undefined;\n  return _objectSpread(_objectSpread({}, props), {}, {\n    visState: state.visState,\n    mapStyle: state.mapStyle,\n    mapState: state.mapState,\n    uiState: state.uiState,\n    providerState: state.providerState\n  });\n}\nvar defaultUserActions = {};\nvar getDispatch = function getDispatch(dispatch, props) {\n  return dispatch;\n};\nvar getUserActions = function getUserActions(dispatch, props) {\n  return props.actions || defaultUserActions;\n};\n/** @type {() => import('reselect').OutputParametricSelector<any, any, any, any>} */\n\nfunction makeGetActionCreators() {\n  return (0, _reselect.createSelector)([getDispatch, getUserActions], function (dispatch, userActions) {\n    var _map = [VisStateActions, MapStateActions, MapStyleActions, UIStateActions, ProviderActions].map(function (actions) {\n        return (0, _redux.bindActionCreators)(mergeActions(actions, userActions), dispatch);\n      }),\n      _map2 = (0, _slicedToArray2[\"default\"])(_map, 5),\n      visStateActions = _map2[0],\n      mapStateActions = _map2[1],\n      mapStyleActions = _map2[2],\n      uiStateActions = _map2[3],\n      providerActions = _map2[4];\n    return {\n      visStateActions: visStateActions,\n      mapStateActions: mapStateActions,\n      mapStyleActions: mapStyleActions,\n      uiStateActions: uiStateActions,\n      providerActions: providerActions,\n      dispatch: dispatch\n    };\n  });\n}\nfunction makeMapDispatchToProps() {\n  var getActionCreators = makeGetActionCreators();\n  var mapDispatchToProps = function mapDispatchToProps(dispatch, ownProps) {\n    var groupedActionCreators = getActionCreators(dispatch, ownProps);\n    return _objectSpread(_objectSpread({}, groupedActionCreators), {}, {\n      dispatch: dispatch\n    });\n  };\n  return mapDispatchToProps;\n}\n/**\n * Override default kepler.gl actions with user defined actions using the same key\n */\n\nfunction mergeActions(actions, userActions) {\n  var overrides = {};\n  for (var key in userActions) {\n    if (userActions.hasOwnProperty(key) && actions.hasOwnProperty(key)) {\n      overrides[key] = userActions[key];\n    }\n  }\n  return _objectSpread(_objectSpread({}, actions), overrides);\n}\nvar _default = KeplerGlFactory;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../src/components/kepler-gl.js"],"names":["GlobalStyle","styled","div","props","theme","fontFamily","fontWeight","fontSize","lineHeight","labelColor","BottomWidgetOuter","absolute","mapFieldsSelector","getMapboxRef","mapboxApiAccessToken","mapboxApiUrl","mapState","mapStyle","onDeckInitialized","onViewStateChange","deckGlProps","uiStateActions","visStateActions","mapStateActions","editor","visState","datasets","layers","layerOrder","layerData","layerBlending","filters","interactionConfig","hoverInfo","clicked","mousePos","animationConfig","activeSidePanel","uiState","mapControls","readOnly","locale","sidePanelSelector","availableProviders","appName","version","appWebsite","onSaveMap","mapStyleActions","layerClasses","mapInfo","width","sidePanelWidth","mapSaved","providerState","plotContainerSelector","height","exportImageSetting","exportImage","mapFields","addNotification","setExportImageSetting","setExportImageDataUri","setExportImageError","splitMaps","isSplitSelector","length","bottomWidgetSelector","toggleModal","sidePanel","margin","left","modalContainerSelector","rootNode","providerActions","cloudProviders","onExportToCloudSuccess","onLoadCloudMapSuccess","onLoadCloudMapError","onExportToCloudError","geoCoderPanelSelector","isGeocoderEnabled","geocoder","enabled","updateVisData","removeDataset","updateMap","notificationPanelSelector","removeNotification","notifications","DEFAULT_KEPLER_GL_PROPS","mapStyles","mapStylesReplaceDefault","DEFAULT_MAPBOX_API_URL","KEPLER_GL_NAME","KEPLER_GL_VERSION","DIMENSIONS","KeplerGlFactory","deps","BottomWidgetFactory","GeoCoderPanelFactory","MapContainerFactory","MapsLayoutFactory","ModalContainerFactory","SidePanelFactory","PlotContainerFactory","NotificationPanelFactory","BottomWidget","GeoCoderPanel","MapContainer","MapsLayout","ModalContainer","SidePanel","PlotContainer","NotificationPanel","KeplerGL","Component","dimensions","_validateMapboxToken","_loadMapStyle","onKeplerGlInitialized","root","current","HTMLElement","_handleResize","setState","RootContext","themeSelector","basicTheme","THEME","light","themeLT","base","themeBS","isArray","providers","hasStorage","some","p","hasPrivateStorage","hasShare","hasSharingUrl","localeMessages","customMessages","messages","Console","warn","MISSING_MAPBOX_TOKEN","defaultStyles","Object","values","customStyles","map","ms","id","allStyles","reduce","accu","style","hasStyleObject","toLoad","toRequest","loadMapStyles","requestMapStyles","state","isSplit","availableThemeSelector","localeMessagesSelector","isExportingImage","exporting","sideFields","plotContainerFields","bottomWidgetFields","modalContainerFields","geoCoderPanelFields","notificationPanelFields","mapContainers","settings","index","display","flexDirection","position","bottomWidgetRef","mapStateToProps","makeMapDispatchToProps","defaultUserActions","getDispatch","dispatch","getUserActions","actions","makeGetActionCreators","userActions","VisStateActions","MapStateActions","MapStyleActions","UIStateActions","ProviderActions","mergeActions","getActionCreators","mapDispatchToProps","ownProps","groupedActionCreators","overrides","key","hasOwnProperty"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {Component, createRef} from 'react';\nimport Console from 'global/console';\nimport {bindActionCreators} from 'redux';\nimport styled, {ThemeProvider, withTheme} from 'styled-components';\nimport {createSelector} from 'reselect';\nimport {connect as keplerGlConnect} from 'connect/keplergl-connect';\nimport {IntlProvider} from 'react-intl';\nimport {messages} from '../localization';\nimport {RootContext} from 'components/context';\n\nimport * as VisStateActions from 'actions/vis-state-actions';\nimport * as MapStateActions from 'actions/map-state-actions';\nimport * as MapStyleActions from 'actions/map-style-actions';\nimport * as UIStateActions from 'actions/ui-state-actions';\nimport * as ProviderActions from 'actions/provider-actions';\n\nimport {\n  DIMENSIONS,\n  KEPLER_GL_NAME,\n  KEPLER_GL_VERSION,\n  THEME,\n  DEFAULT_MAPBOX_API_URL\n} from 'constants/default-settings';\nimport {MISSING_MAPBOX_TOKEN} from 'constants/user-feedbacks';\n\nimport SidePanelFactory from './side-panel';\nimport MapContainerFactory from './map-container';\nimport MapsLayoutFactory from './maps-layout';\nimport BottomWidgetFactory from './bottom-widget';\nimport ModalContainerFactory from './modal-container';\nimport PlotContainerFactory from './plot-container';\nimport NotificationPanelFactory from './notification-panel';\nimport GeoCoderPanelFactory from './geocoder-panel';\n\nimport {generateHashId} from 'utils/utils';\nimport {validateToken} from 'utils/mapbox-utils';\nimport {mergeMessages} from 'utils/locale-utils';\n\nimport {theme as basicTheme, themeLT, themeBS} from 'styles/base';\nimport {observeDimensions, unobserveDimensions} from '../utils/observe-dimensions';\n\n// Maybe we should think about exporting this or creating a variable\n// as part of the base.js theme\nconst GlobalStyle = styled.div`\n  font-family: ${props => props.theme.fontFamily};\n  font-weight: ${props => props.theme.fontWeight};\n  font-size: ${props => props.theme.fontSize};\n  line-height: ${props => props.theme.lineHeight};\n\n  *,\n  *:before,\n  *:after {\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n  }\n\n  ul {\n    margin: 0;\n    padding: 0;\n  }\n\n  li {\n    margin: 0;\n  }\n\n  a {\n    text-decoration: none;\n    color: ${props => props.theme.labelColor};\n  }\n\n  .mapboxgl-ctrl .mapboxgl-ctrl-logo {\n    display: none;\n  }\n`;\n\nconst BottomWidgetOuter = styled.div(\n  ({absolute}) => `\n  ${absolute ? 'position: absolute; bottom: 0; right: 0;' : ''}\n  pointer-events: none; /* prevent padding from blocking input */\n  & > * {\n    /* all children should allow input */\n    pointer-events: all;\n  }`\n);\n\nexport const mapFieldsSelector = props => ({\n  getMapboxRef: props.getMapboxRef,\n  mapboxApiAccessToken: props.mapboxApiAccessToken,\n  mapboxApiUrl: props.mapboxApiUrl,\n  mapState: props.mapState,\n  mapStyle: props.mapStyle,\n  onDeckInitialized: props.onDeckInitialized,\n  onViewStateChange: props.onViewStateChange,\n  deckGlProps: props.deckGlProps,\n  uiStateActions: props.uiStateActions,\n  visStateActions: props.visStateActions,\n  mapStateActions: props.mapStateActions,\n\n  // visState\n  editor: props.visState.editor,\n  datasets: props.visState.datasets,\n  layers: props.visState.layers,\n  layerOrder: props.visState.layerOrder,\n  layerData: props.visState.layerData,\n  layerBlending: props.visState.layerBlending,\n  filters: props.visState.filters,\n  interactionConfig: props.visState.interactionConfig,\n  hoverInfo: props.visState.hoverInfo,\n  clicked: props.visState.clicked,\n  mousePos: props.visState.mousePos,\n  animationConfig: props.visState.animationConfig,\n\n  // uiState\n  activeSidePanel: props.uiState.activeSidePanel,\n  mapControls: props.uiState.mapControls,\n  readOnly: props.uiState.readOnly,\n  locale: props.uiState.locale\n});\n\nexport const sidePanelSelector = (props, availableProviders) => ({\n  appName: props.appName,\n  version: props.version,\n  appWebsite: props.appWebsite,\n  mapStyle: props.mapStyle,\n  onSaveMap: props.onSaveMap,\n  uiState: props.uiState,\n  mapStyleActions: props.mapStyleActions,\n  visStateActions: props.visStateActions,\n  uiStateActions: props.uiStateActions,\n\n  datasets: props.visState.datasets,\n  filters: props.visState.filters,\n  layers: props.visState.layers,\n  layerOrder: props.visState.layerOrder,\n  layerClasses: props.visState.layerClasses,\n  interactionConfig: props.visState.interactionConfig,\n  mapInfo: props.visState.mapInfo,\n  layerBlending: props.visState.layerBlending,\n\n  width: props.sidePanelWidth,\n  availableProviders,\n  mapSaved: props.providerState.mapSaved\n});\n\nexport const plotContainerSelector = props => ({\n  width: props.width,\n  height: props.height,\n  exportImageSetting: props.uiState.exportImage,\n  mapFields: mapFieldsSelector(props),\n  addNotification: props.uiStateActions.addNotification,\n  setExportImageSetting: props.uiStateActions.setExportImageSetting,\n  setExportImageDataUri: props.uiStateActions.setExportImageDataUri,\n  setExportImageError: props.uiStateActions.setExportImageError,\n  splitMaps: props.visState.splitMaps\n});\n\nexport const isSplitSelector = props =>\n  props.visState.splitMaps && props.visState.splitMaps.length > 1;\n\nexport const bottomWidgetSelector = (props, theme) => ({\n  filters: props.visState.filters,\n  datasets: props.visState.datasets,\n  uiState: props.uiState,\n  layers: props.visState.layers,\n  animationConfig: props.visState.animationConfig,\n  visStateActions: props.visStateActions,\n  toggleModal: props.uiStateActions.toggleModal,\n  sidePanelWidth: props.uiState.readOnly ? 0 : props.sidePanelWidth + theme.sidePanel.margin.left\n});\n\nexport const modalContainerSelector = (props, rootNode) => ({\n  appName: props.appName,\n  mapStyle: props.mapStyle,\n  visState: props.visState,\n  mapState: props.mapState,\n  uiState: props.uiState,\n  providerState: props.providerState,\n\n  mapboxApiAccessToken: props.mapboxApiAccessToken,\n  mapboxApiUrl: props.mapboxApiUrl,\n  visStateActions: props.visStateActions,\n  uiStateActions: props.uiStateActions,\n  mapStyleActions: props.mapStyleActions,\n  providerActions: props.providerActions,\n\n  rootNode,\n  // User defined cloud provider props\n  cloudProviders: props.cloudProviders,\n  onExportToCloudSuccess: props.onExportToCloudSuccess,\n  onLoadCloudMapSuccess: props.onLoadCloudMapSuccess,\n  onLoadCloudMapError: props.onLoadCloudMapError,\n  onExportToCloudError: props.onExportToCloudError\n});\n\nexport const geoCoderPanelSelector = props => ({\n  isGeocoderEnabled: props.visState.interactionConfig.geocoder.enabled,\n  mapboxApiAccessToken: props.mapboxApiAccessToken,\n  mapState: props.mapState,\n  updateVisData: props.visStateActions.updateVisData,\n  removeDataset: props.visStateActions.removeDataset,\n  updateMap: props.mapStateActions.updateMap\n});\n\nexport const notificationPanelSelector = props => ({\n  removeNotification: props.uiStateActions.removeNotification,\n  notifications: props.uiState.notifications\n});\n\nexport const DEFAULT_KEPLER_GL_PROPS = {\n  mapStyles: [],\n  mapStylesReplaceDefault: false,\n  mapboxApiUrl: DEFAULT_MAPBOX_API_URL,\n  width: 800,\n  height: 800,\n  appName: KEPLER_GL_NAME,\n  version: KEPLER_GL_VERSION,\n  sidePanelWidth: DIMENSIONS.sidePanel.width,\n  theme: {},\n  cloudProviders: [],\n  readOnly: false\n};\n\nKeplerGlFactory.deps = [\n  BottomWidgetFactory,\n  GeoCoderPanelFactory,\n  MapContainerFactory,\n  MapsLayoutFactory,\n  ModalContainerFactory,\n  SidePanelFactory,\n  PlotContainerFactory,\n  NotificationPanelFactory\n];\n\nfunction KeplerGlFactory(\n  BottomWidget,\n  GeoCoderPanel,\n  MapContainer,\n  MapsLayout,\n  ModalContainer,\n  SidePanel,\n  PlotContainer,\n  NotificationPanel\n) {\n  /** @typedef {import('./kepler-gl').UnconnectedKeplerGlProps} KeplerGlProps */\n  /** @augments React.Component<KeplerGlProps> */\n  class KeplerGL extends Component {\n    static defaultProps = DEFAULT_KEPLER_GL_PROPS;\n\n    state = {\n      dimensions: null\n    };\n\n    componentDidMount() {\n      this._validateMapboxToken();\n      this._loadMapStyle();\n      if (typeof this.props.onKeplerGlInitialized === 'function') {\n        this.props.onKeplerGlInitialized();\n      }\n      if (this.root.current instanceof HTMLElement) {\n        observeDimensions(this.root.current, this._handleResize);\n      }\n    }\n\n    componentWillUnmount() {\n      if (this.root.current instanceof HTMLElement) {\n        unobserveDimensions(this.root.current);\n      }\n    }\n\n    _handleResize = dimensions => {\n      this.setState({dimensions});\n    };\n\n    static contextType = RootContext;\n\n    root = createRef();\n    bottomWidgetRef = createRef();\n\n    /* selectors */\n    themeSelector = props => props.theme;\n    availableThemeSelector = createSelector(this.themeSelector, theme =>\n      typeof theme === 'object'\n        ? {\n            ...basicTheme,\n            ...theme\n          }\n        : theme === THEME.light\n        ? themeLT\n        : theme === THEME.base\n        ? themeBS\n        : theme\n    );\n\n    availableProviders = createSelector(\n      props => props.cloudProviders,\n      providers =>\n        Array.isArray(providers) && providers.length\n          ? {\n              hasStorage: providers.some(p => p.hasPrivateStorage()),\n              hasShare: providers.some(p => p.hasSharingUrl())\n            }\n          : {}\n    );\n\n    localeMessagesSelector = createSelector(\n      props => props.localeMessages,\n      customMessages => (customMessages ? mergeMessages(messages, customMessages) : messages)\n    );\n\n    /* private methods */\n    _validateMapboxToken() {\n      const {mapboxApiAccessToken} = this.props;\n      if (!validateToken(mapboxApiAccessToken)) {\n        Console.warn(MISSING_MAPBOX_TOKEN);\n      }\n    }\n\n    _loadMapStyle = () => {\n      const defaultStyles = Object.values(this.props.mapStyle.mapStyles);\n      // add id to custom map styles if not given\n      const customStyles = (this.props.mapStyles || []).map(ms => ({\n        ...ms,\n        id: ms.id || generateHashId()\n      }));\n\n      const allStyles = [...customStyles, ...defaultStyles].reduce(\n        (accu, style) => {\n          const hasStyleObject = style.style && typeof style.style === 'object';\n          accu[hasStyleObject ? 'toLoad' : 'toRequest'][style.id] = style;\n\n          return accu;\n        },\n        {toLoad: {}, toRequest: {}}\n      );\n\n      this.props.mapStyleActions.loadMapStyles(allStyles.toLoad);\n      this.props.mapStyleActions.requestMapStyles(allStyles.toRequest);\n    };\n\n    render() {\n      const {\n        id,\n        width,\n        height,\n        uiState,\n        visState,\n        // readOnly override\n        readOnly\n      } = this.props;\n\n      const dimensions = this.state.dimensions || {width, height};\n      const {\n        splitMaps, // this will store support for split map view is necessary\n        interactionConfig\n      } = visState;\n\n      const isSplit = isSplitSelector(this.props);\n      const theme = this.availableThemeSelector(this.props);\n      const localeMessages = this.localeMessagesSelector(this.props);\n      const isExportingImage = uiState.exportImage.exporting;\n      const availableProviders = this.availableProviders(this.props);\n\n      const mapFields = mapFieldsSelector(this.props);\n      const sideFields = sidePanelSelector(this.props, availableProviders);\n      const plotContainerFields = plotContainerSelector(this.props);\n      const bottomWidgetFields = bottomWidgetSelector(this.props, theme);\n      const modalContainerFields = modalContainerSelector(this.props, this.root.current);\n      const geoCoderPanelFields = geoCoderPanelSelector(this.props);\n      const notificationPanelFields = notificationPanelSelector(this.props);\n\n      const mapContainers = !isSplit\n        ? [<MapContainer primary={true} key={0} index={0} {...mapFields} mapLayers={null} />]\n        : splitMaps.map((settings, index) => (\n            <MapContainer\n              key={index}\n              index={index}\n              primary={index === 1}\n              {...mapFields}\n              mapLayers={splitMaps[index].layers}\n            />\n          ));\n\n      return (\n        <RootContext.Provider value={this.root}>\n          <IntlProvider locale={uiState.locale} messages={localeMessages[uiState.locale]}>\n            <ThemeProvider theme={theme}>\n              <GlobalStyle\n                className=\"kepler-gl\"\n                id={`kepler-gl__${id}`}\n                style={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                  position: 'relative',\n                  width: `${width}px`,\n                  height: `${height}px`\n                }}\n                ref={this.root}\n              >\n                <NotificationPanel {...notificationPanelFields} />\n                {!uiState.readOnly && !readOnly && <SidePanel {...sideFields} />}\n                <MapsLayout className=\"maps\">{mapContainers}</MapsLayout>\n                {isExportingImage && <PlotContainer {...plotContainerFields} />}\n                {interactionConfig.geocoder.enabled && <GeoCoderPanel {...geoCoderPanelFields} />}\n                <BottomWidgetOuter absolute>\n                  <BottomWidget\n                    ref={this.bottomWidgetRef}\n                    {...bottomWidgetFields}\n                    containerW={dimensions.width}\n                  />\n                </BottomWidgetOuter>\n                <ModalContainer\n                  {...modalContainerFields}\n                  containerW={dimensions.width}\n                  containerH={dimensions.height}\n                />\n              </GlobalStyle>\n            </ThemeProvider>\n          </IntlProvider>\n        </RootContext.Provider>\n      );\n    }\n  }\n\n  return keplerGlConnect(mapStateToProps, makeMapDispatchToProps)(withTheme(KeplerGL));\n}\n\nexport function mapStateToProps(state = {}, props) {\n  return {\n    ...props,\n    visState: state.visState,\n    mapStyle: state.mapStyle,\n    mapState: state.mapState,\n    uiState: state.uiState,\n    providerState: state.providerState\n  };\n}\n\nconst defaultUserActions = {};\n\nconst getDispatch = (dispatch, props) => dispatch;\nconst getUserActions = (dispatch, props) => props.actions || defaultUserActions;\n\n/** @type {() => import('reselect').OutputParametricSelector<any, any, any, any>} */\nfunction makeGetActionCreators() {\n  return createSelector([getDispatch, getUserActions], (dispatch, userActions) => {\n    const [visStateActions, mapStateActions, mapStyleActions, uiStateActions, providerActions] = [\n      VisStateActions,\n      MapStateActions,\n      MapStyleActions,\n      UIStateActions,\n      ProviderActions\n    ].map(actions => bindActionCreators(mergeActions(actions, userActions), dispatch));\n\n    return {\n      visStateActions,\n      mapStateActions,\n      mapStyleActions,\n      uiStateActions,\n      providerActions,\n      dispatch\n    };\n  });\n}\n\nfunction makeMapDispatchToProps() {\n  const getActionCreators = makeGetActionCreators();\n  const mapDispatchToProps = (dispatch, ownProps) => {\n    const groupedActionCreators = getActionCreators(dispatch, ownProps);\n\n    return {\n      ...groupedActionCreators,\n      dispatch\n    };\n  };\n\n  return mapDispatchToProps;\n}\n\n/**\n * Override default kepler.gl actions with user defined actions using the same key\n */\nfunction mergeActions(actions, userActions) {\n  const overrides = {};\n  for (const key in userActions) {\n    if (userActions.hasOwnProperty(key) && actions.hasOwnProperty(key)) {\n      overrides[key] = userActions[key];\n    }\n  }\n\n  return {...actions, ...overrides};\n}\n\nexport default KeplerGlFactory;\n"]},"metadata":{},"sourceType":"script"}