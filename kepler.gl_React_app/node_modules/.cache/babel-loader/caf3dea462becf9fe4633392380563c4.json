{"ast":null,"code":"import _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport { PROP_SYMBOLS } from './constants';\nvar COMPONENT = PROP_SYMBOLS.COMPONENT;\nexport function validateProps(props) {\n  var propTypes = getPropTypes(props);\n  for (var propName in propTypes) {\n    var propType = propTypes[propName];\n    var validate = propType.validate;\n    if (validate && !validate(props[propName], propType)) {\n      throw new Error(\"Invalid prop \".concat(propName, \": \").concat(props[propName]));\n    }\n  }\n}\nexport function diffProps(props, oldProps) {\n  var propsChangedReason = compareProps({\n    newProps: props,\n    oldProps: oldProps,\n    propTypes: getPropTypes(props),\n    ignoreProps: {\n      data: null,\n      updateTriggers: null,\n      extensions: null,\n      transitions: null\n    }\n  });\n  var dataChangedReason = diffDataProps(props, oldProps);\n  var updateTriggersChangedReason = false;\n  if (!dataChangedReason) {\n    updateTriggersChangedReason = diffUpdateTriggers(props, oldProps);\n  }\n  return {\n    dataChanged: dataChangedReason,\n    propsChanged: propsChangedReason,\n    updateTriggersChanged: updateTriggersChangedReason,\n    extensionsChanged: diffExtensions(props, oldProps),\n    transitionsChanged: diffTransitions(props, oldProps)\n  };\n}\nfunction diffTransitions(props, oldProps) {\n  if (!props.transitions) {\n    return null;\n  }\n  var result = {};\n  var propTypes = getPropTypes(props);\n  for (var key in props.transitions) {\n    var propType = propTypes[key];\n    var type = propType && propType.type;\n    var isTransitionable = type === 'number' || type === 'color' || type === 'array';\n    if (isTransitionable && comparePropValues(props[key], oldProps[key], propType)) {\n      result[key] = true;\n    }\n  }\n  return result;\n}\nexport function compareProps() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n    newProps = _ref.newProps,\n    oldProps = _ref.oldProps,\n    _ref$ignoreProps = _ref.ignoreProps,\n    ignoreProps = _ref$ignoreProps === void 0 ? {} : _ref$ignoreProps,\n    _ref$propTypes = _ref.propTypes,\n    propTypes = _ref$propTypes === void 0 ? {} : _ref$propTypes,\n    _ref$triggerName = _ref.triggerName,\n    triggerName = _ref$triggerName === void 0 ? 'props' : _ref$triggerName;\n  if (oldProps === newProps) {\n    return null;\n  }\n  if (_typeof(newProps) !== 'object' || newProps === null) {\n    return \"\".concat(triggerName, \" changed shallowly\");\n  }\n  if (_typeof(oldProps) !== 'object' || oldProps === null) {\n    return \"\".concat(triggerName, \" changed shallowly\");\n  }\n  for (var _i = 0, _Object$keys = Object.keys(newProps); _i < _Object$keys.length; _i++) {\n    var key = _Object$keys[_i];\n    if (!(key in ignoreProps)) {\n      if (!(key in oldProps)) {\n        return \"\".concat(triggerName, \".\").concat(key, \" added\");\n      }\n      var changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n      if (changed) {\n        return \"\".concat(triggerName, \".\").concat(key, \" \").concat(changed);\n      }\n    }\n  }\n  for (var _i2 = 0, _Object$keys2 = Object.keys(oldProps); _i2 < _Object$keys2.length; _i2++) {\n    var _key = _Object$keys2[_i2];\n    if (!(_key in ignoreProps)) {\n      if (!(_key in newProps)) {\n        return \"\".concat(triggerName, \".\").concat(_key, \" dropped\");\n      }\n      if (!Object.hasOwnProperty.call(newProps, _key)) {\n        var _changed = comparePropValues(newProps[_key], oldProps[_key], propTypes[_key]);\n        if (_changed) {\n          return \"\".concat(triggerName, \".\").concat(_key, \" \").concat(_changed);\n        }\n      }\n    }\n  }\n  return null;\n}\nfunction comparePropValues(newProp, oldProp, propType) {\n  var equal = propType && propType.equal;\n  if (equal && !equal(newProp, oldProp, propType)) {\n    return 'changed deeply';\n  }\n  if (!equal) {\n    equal = newProp && oldProp && newProp.equals;\n    if (equal && !equal.call(newProp, oldProp)) {\n      return 'changed deeply';\n    }\n  }\n  if (!equal && oldProp !== newProp) {\n    return 'changed shallowly';\n  }\n  return null;\n}\nfunction diffDataProps(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n  var dataChanged = null;\n  var dataComparator = props.dataComparator,\n    _dataDiff = props._dataDiff;\n  if (dataComparator) {\n    if (!dataComparator(props.data, oldProps.data)) {\n      dataChanged = 'Data comparator detected a change';\n    }\n  } else if (props.data !== oldProps.data) {\n    dataChanged = 'A new data container was supplied';\n  }\n  if (dataChanged && _dataDiff) {\n    dataChanged = _dataDiff(props.data, oldProps.data) || dataChanged;\n  }\n  return dataChanged;\n}\nfunction diffUpdateTriggers(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n  if ('all' in props.updateTriggers) {\n    var diffReason = diffUpdateTrigger(props, oldProps, 'all');\n    if (diffReason) {\n      return {\n        all: true\n      };\n    }\n  }\n  var triggerChanged = {};\n  var reason = false;\n  for (var triggerName in props.updateTriggers) {\n    if (triggerName !== 'all') {\n      var _diffReason = diffUpdateTrigger(props, oldProps, triggerName);\n      if (_diffReason) {\n        triggerChanged[triggerName] = true;\n        reason = triggerChanged;\n      }\n    }\n  }\n  return reason;\n}\nfunction diffExtensions(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n  var oldExtensions = oldProps.extensions;\n  var extensions = props.extensions;\n  if (extensions === oldExtensions) {\n    return false;\n  }\n  if (extensions.length !== oldExtensions.length) {\n    return true;\n  }\n  for (var i = 0; i < extensions.length; i++) {\n    if (!extensions[i].equals(oldExtensions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction diffUpdateTrigger(props, oldProps, triggerName) {\n  var newTriggers = props.updateTriggers[triggerName];\n  newTriggers = newTriggers === undefined || newTriggers === null ? {} : newTriggers;\n  var oldTriggers = oldProps.updateTriggers[triggerName];\n  oldTriggers = oldTriggers === undefined || oldTriggers === null ? {} : oldTriggers;\n  var diffReason = compareProps({\n    oldProps: oldTriggers,\n    newProps: newTriggers,\n    triggerName: triggerName\n  });\n  return diffReason;\n}\nfunction getPropTypes(props) {\n  var layer = props[COMPONENT];\n  var LayerType = layer && layer.constructor;\n  return LayerType ? LayerType._propTypes : {};\n}","map":{"version":3,"sources":["../../../src/lifecycle/props.js"],"names":["PROP_SYMBOLS","COMPONENT","validateProps","props","propTypes","getPropTypes","propName","propType","validate","Error","diffProps","oldProps","propsChangedReason","compareProps","newProps","ignoreProps","data","updateTriggers","extensions","transitions","dataChangedReason","diffDataProps","updateTriggersChangedReason","diffUpdateTriggers","dataChanged","propsChanged","updateTriggersChanged","extensionsChanged","diffExtensions","transitionsChanged","diffTransitions","result","key","type","isTransitionable","comparePropValues","triggerName","Object","keys","changed","hasOwnProperty","call","newProp","oldProp","equal","equals","dataComparator","_dataDiff","diffReason","diffUpdateTrigger","all","triggerChanged","reason","oldExtensions","length","i","newTriggers","undefined","oldTriggers","layer","LayerType","constructor","_propTypes"],"mappings":"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","sourcesContent":["import {PROP_SYMBOLS} from './constants';\n\nconst {COMPONENT} = PROP_SYMBOLS;\n\nexport function validateProps(props) {\n  const propTypes = getPropTypes(props);\n\n  for (const propName in propTypes) {\n    const propType = propTypes[propName];\n    const {validate} = propType;\n    if (validate && !validate(props[propName], propType)) {\n      throw new Error(`Invalid prop ${propName}: ${props[propName]}`);\n    }\n  }\n}\n\n// Returns an object with \"change flags\", either false or strings indicating reason for change\nexport function diffProps(props, oldProps) {\n  // First check if any props have changed (ignore props that will be examined separately)\n  const propsChangedReason = compareProps({\n    newProps: props,\n    oldProps,\n    propTypes: getPropTypes(props),\n    ignoreProps: {data: null, updateTriggers: null, extensions: null, transitions: null}\n  });\n\n  // Now check if any data related props have changed\n  const dataChangedReason = diffDataProps(props, oldProps);\n\n  // Check update triggers to determine if any attributes need regeneration\n  // Note - if data has changed, all attributes will need regeneration, so skip this step\n  let updateTriggersChangedReason = false;\n  if (!dataChangedReason) {\n    updateTriggersChangedReason = diffUpdateTriggers(props, oldProps);\n  }\n\n  return {\n    dataChanged: dataChangedReason,\n    propsChanged: propsChangedReason,\n    updateTriggersChanged: updateTriggersChangedReason,\n    extensionsChanged: diffExtensions(props, oldProps),\n    transitionsChanged: diffTransitions(props, oldProps)\n  };\n}\n\nfunction diffTransitions(props, oldProps) {\n  if (!props.transitions) {\n    return null;\n  }\n  const result = {};\n  const propTypes = getPropTypes(props);\n\n  for (const key in props.transitions) {\n    const propType = propTypes[key];\n    const type = propType && propType.type;\n    const isTransitionable = type === 'number' || type === 'color' || type === 'array';\n    if (isTransitionable && comparePropValues(props[key], oldProps[key], propType)) {\n      result[key] = true;\n    }\n  }\n  return result;\n}\n\n/**\n * Performs equality by iterating through keys on an object and returning false\n * when any key has values which are not strictly equal between the arguments.\n * @param {Object} opt.oldProps - object with old key/value pairs\n * @param {Object} opt.newProps - object with new key/value pairs\n * @param {Object} opt.ignoreProps={} - object, keys that should not be compared\n * @returns {null|String} - null when values of all keys are strictly equal.\n *   if unequal, returns a string explaining what changed.\n */\n/* eslint-disable max-statements, max-depth, complexity */\n/*\n * Note: for better performance, this function assumes that both oldProps and newProps\n   inherit the same prototype (defaultProps). That is, if neither object contains own\n   property <key>, assume `oldProps.<key>` and `newProps.<key>` are equal.\n */\nexport function compareProps({\n  newProps,\n  oldProps,\n  ignoreProps = {},\n  propTypes = {},\n  triggerName = 'props'\n} = {}) {\n  // shallow equality => deep equality\n  if (oldProps === newProps) {\n    return null;\n  }\n\n  // TODO - do we need these checks? Should never happen...\n  if (typeof newProps !== 'object' || newProps === null) {\n    return `${triggerName} changed shallowly`;\n  }\n\n  if (typeof oldProps !== 'object' || oldProps === null) {\n    return `${triggerName} changed shallowly`;\n  }\n\n  // Compare explicitly defined new props against old/default values\n  for (const key of Object.keys(newProps)) {\n    if (!(key in ignoreProps)) {\n      if (!(key in oldProps)) {\n        return `${triggerName}.${key} added`;\n      }\n      const changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n      if (changed) {\n        return `${triggerName}.${key} ${changed}`;\n      }\n    }\n  }\n\n  // Test if any old props have been dropped\n  for (const key of Object.keys(oldProps)) {\n    if (!(key in ignoreProps)) {\n      if (!(key in newProps)) {\n        return `${triggerName}.${key} dropped`;\n      }\n      if (!Object.hasOwnProperty.call(newProps, key)) {\n        // Compare dropped old prop against default value\n        const changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n        if (changed) {\n          return `${triggerName}.${key} ${changed}`;\n        }\n      }\n    }\n  }\n\n  return null;\n}\n/* eslint-enable max-statements, max-depth, complexity */\n\n// HELPERS\nfunction comparePropValues(newProp, oldProp, propType) {\n  // If prop type has an equal function, invoke it\n  let equal = propType && propType.equal;\n  if (equal && !equal(newProp, oldProp, propType)) {\n    return 'changed deeply';\n  }\n\n  if (!equal) {\n    // If object has an equals function, invoke it\n    equal = newProp && oldProp && newProp.equals;\n    if (equal && !equal.call(newProp, oldProp)) {\n      return 'changed deeply';\n    }\n  }\n\n  if (!equal && oldProp !== newProp) {\n    return 'changed shallowly';\n  }\n\n  return null;\n}\n\n// The comparison of the data prop requires special handling\n// the dataComparator should be used if supplied\nfunction diffDataProps(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  let dataChanged = null;\n  // Support optional app defined comparison of data\n  const {dataComparator, _dataDiff} = props;\n  if (dataComparator) {\n    if (!dataComparator(props.data, oldProps.data)) {\n      dataChanged = 'Data comparator detected a change';\n    }\n    // Otherwise, do a shallow equal on props\n  } else if (props.data !== oldProps.data) {\n    dataChanged = 'A new data container was supplied';\n  }\n  if (dataChanged && _dataDiff) {\n    dataChanged = _dataDiff(props.data, oldProps.data) || dataChanged;\n  }\n\n  return dataChanged;\n}\n\n// Checks if any update triggers have changed\n// also calls callback to invalidate attributes accordingly.\nfunction diffUpdateTriggers(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  // If the 'all' updateTrigger fires, ignore testing others\n  if ('all' in props.updateTriggers) {\n    const diffReason = diffUpdateTrigger(props, oldProps, 'all');\n    if (diffReason) {\n      return {all: true};\n    }\n  }\n\n  const triggerChanged = {};\n  let reason = false;\n  // If the 'all' updateTrigger didn't fire, need to check all others\n  for (const triggerName in props.updateTriggers) {\n    if (triggerName !== 'all') {\n      const diffReason = diffUpdateTrigger(props, oldProps, triggerName);\n      if (diffReason) {\n        triggerChanged[triggerName] = true;\n        reason = triggerChanged;\n      }\n    }\n  }\n\n  return reason;\n}\n\n// Returns true if any extensions have changed\nfunction diffExtensions(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  const oldExtensions = oldProps.extensions;\n  const {extensions} = props;\n\n  if (extensions === oldExtensions) {\n    return false;\n  }\n  if (extensions.length !== oldExtensions.length) {\n    return true;\n  }\n  for (let i = 0; i < extensions.length; i++) {\n    if (!extensions[i].equals(oldExtensions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction diffUpdateTrigger(props, oldProps, triggerName) {\n  let newTriggers = props.updateTriggers[triggerName];\n  newTriggers = newTriggers === undefined || newTriggers === null ? {} : newTriggers;\n  let oldTriggers = oldProps.updateTriggers[triggerName];\n  oldTriggers = oldTriggers === undefined || oldTriggers === null ? {} : oldTriggers;\n  const diffReason = compareProps({\n    oldProps: oldTriggers,\n    newProps: newTriggers,\n    triggerName\n  });\n  return diffReason;\n}\n\nfunction getPropTypes(props) {\n  const layer = props[COMPONENT];\n  const LayerType = layer && layer.constructor;\n  return LayerType ? LayerType._propTypes : {};\n}\n"]},"metadata":{},"sourceType":"module"}