{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\nvar _localization = require(\"../../localization\");\nvar _styledComponents = require(\"../common/styled-components\");\nvar _icons = require(\"../common/icons\");\nvar _sourceDataCatalog = _interopRequireDefault(require(\"./common/source-data-catalog\"));\nvar _filterPanel = _interopRequireDefault(require(\"./filter-panel/filter-panel\"));\n\n// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nFilterManagerFactory.deps = [_sourceDataCatalog[\"default\"], _filterPanel[\"default\"]];\nfunction FilterManagerFactory(SourceDataCatalog, FilterPanel) {\n  var FilterManager = function FilterManager(_ref) {\n    var _ref$filters = _ref.filters,\n      filters = _ref$filters === void 0 ? [] : _ref$filters,\n      datasets = _ref.datasets,\n      layers = _ref.layers,\n      showDatasetTable = _ref.showDatasetTable,\n      visStateActions = _ref.visStateActions;\n    var addFilter = visStateActions.addFilter,\n      _enlargeFilter = visStateActions.enlargeFilter,\n      _removeFilter = visStateActions.removeFilter,\n      setFilter = visStateActions.setFilter,\n      _toggleAnimation = visStateActions.toggleAnimation,\n      _toggleFilterFeature = visStateActions.toggleFilterFeature;\n    var isAnyFilterAnimating = filters.some(function (f) {\n      return f.isAnimating;\n    });\n    var hadEmptyFilter = filters.some(function (f) {\n      return !f.name;\n    });\n    var hadDataset = Object.keys(datasets).length;\n    var onClickAddFilter = (0, _react.useCallback)(function () {\n      var defaultDataset = Object.keys(datasets).length && Object.keys(datasets)[0] || null;\n      addFilter(defaultDataset);\n    }, [datasets, addFilter]); // render last added filter first\n\n    var reversedIndex = (0, _react.useMemo)(function () {\n      return new Array(filters.length).fill(0).map(function (d, i) {\n        return i;\n      }).reverse();\n    }, [filters.length]);\n    return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      className: \"filter-manager\"\n    }, /*#__PURE__*/_react[\"default\"].createElement(SourceDataCatalog, {\n      datasets: datasets,\n      showDatasetTable: showDatasetTable\n    }), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents.SidePanelDivider, null), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents.SidePanelSection, null, reversedIndex.map(function (idx) {\n      return /*#__PURE__*/_react[\"default\"].createElement(FilterPanel, {\n        key: \"\".concat(filters[idx].id, \"-\").concat(idx),\n        idx: idx,\n        filters: filters,\n        filter: filters[idx],\n        datasets: datasets,\n        layers: layers,\n        isAnyFilterAnimating: isAnyFilterAnimating,\n        removeFilter: function removeFilter() {\n          return _removeFilter(idx);\n        },\n        enlargeFilter: function enlargeFilter() {\n          return _enlargeFilter(idx);\n        },\n        toggleAnimation: function toggleAnimation() {\n          return _toggleAnimation(idx);\n        },\n        toggleFilterFeature: function toggleFilterFeature() {\n          return _toggleFilterFeature(idx);\n        },\n        setFilter: setFilter\n      });\n    })), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents.Button, {\n      className: \"add-filter-button\",\n      inactive: hadEmptyFilter || !hadDataset,\n      width: \"105px\",\n      onClick: onClickAddFilter\n    }, /*#__PURE__*/_react[\"default\"].createElement(_icons.Add, {\n      height: \"12px\"\n    }), /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n      id: 'filterManager.addFilter'\n    })));\n  };\n  FilterManager.propTypes = {\n    datasets: _propTypes[\"default\"].object,\n    layers: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].any).isRequired,\n    filters: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].any).isRequired,\n    showDatasetTable: _propTypes[\"default\"].func.isRequired,\n    visStateActions: _propTypes[\"default\"].object.isRequired,\n    // fields can be undefined when dataset is not selected\n    fields: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].any)\n  };\n  return FilterManager;\n}\nvar _default = FilterManagerFactory;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../../src/components/side-panel/filter-manager.js"],"names":["FilterManagerFactory","deps","SourceDataCatalogFactory","FilterPanelFactory","SourceDataCatalog","FilterPanel","FilterManager","filters","datasets","layers","showDatasetTable","visStateActions","addFilter","enlargeFilter","removeFilter","setFilter","toggleAnimation","toggleFilterFeature","isAnyFilterAnimating","some","f","isAnimating","hadEmptyFilter","name","hadDataset","Object","keys","length","onClickAddFilter","defaultDataset","reversedIndex","Array","fill","map","d","i","reverse","idx","id","propTypes","PropTypes","object","arrayOf","any","isRequired","func","fields"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {useCallback, useMemo} from 'react';\nimport PropTypes from 'prop-types';\nimport {FormattedMessage} from 'localization';\nimport {Button, SidePanelDivider, SidePanelSection} from 'components/common/styled-components';\nimport {Add} from 'components/common/icons';\nimport SourceDataCatalogFactory from './common/source-data-catalog';\nimport FilterPanelFactory from './filter-panel/filter-panel';\n\nFilterManagerFactory.deps = [SourceDataCatalogFactory, FilterPanelFactory];\n\nfunction FilterManagerFactory(SourceDataCatalog, FilterPanel) {\n  const FilterManager = ({filters = [], datasets, layers, showDatasetTable, visStateActions}) => {\n    const {\n      addFilter,\n      enlargeFilter,\n      removeFilter,\n      setFilter,\n      toggleAnimation,\n      toggleFilterFeature\n    } = visStateActions;\n    const isAnyFilterAnimating = filters.some(f => f.isAnimating);\n    const hadEmptyFilter = filters.some(f => !f.name);\n    const hadDataset = Object.keys(datasets).length;\n    const onClickAddFilter = useCallback(() => {\n      const defaultDataset = (Object.keys(datasets).length && Object.keys(datasets)[0]) || null;\n      addFilter(defaultDataset);\n    }, [datasets, addFilter]);\n    // render last added filter first\n    const reversedIndex = useMemo(() => {\n      return new Array(filters.length)\n        .fill(0)\n        .map((d, i) => i)\n        .reverse();\n    }, [filters.length]);\n\n    return (\n      <div className=\"filter-manager\">\n        <SourceDataCatalog datasets={datasets} showDatasetTable={showDatasetTable} />\n        <SidePanelDivider />\n        <SidePanelSection>\n          {reversedIndex.map(idx => (\n            <FilterPanel\n              key={`${filters[idx].id}-${idx}`}\n              idx={idx}\n              filters={filters}\n              filter={filters[idx]}\n              datasets={datasets}\n              layers={layers}\n              isAnyFilterAnimating={isAnyFilterAnimating}\n              removeFilter={() => removeFilter(idx)}\n              enlargeFilter={() => enlargeFilter(idx)}\n              toggleAnimation={() => toggleAnimation(idx)}\n              toggleFilterFeature={() => toggleFilterFeature(idx)}\n              setFilter={setFilter}\n            />\n          ))}\n        </SidePanelSection>\n        <Button\n          className=\"add-filter-button\"\n          inactive={hadEmptyFilter || !hadDataset}\n          width=\"105px\"\n          onClick={onClickAddFilter}\n        >\n          <Add height=\"12px\" />\n          <FormattedMessage id={'filterManager.addFilter'} />\n        </Button>\n      </div>\n    );\n  };\n\n  FilterManager.propTypes = {\n    datasets: PropTypes.object,\n    layers: PropTypes.arrayOf(PropTypes.any).isRequired,\n    filters: PropTypes.arrayOf(PropTypes.any).isRequired,\n    showDatasetTable: PropTypes.func.isRequired,\n    visStateActions: PropTypes.object.isRequired,\n\n    // fields can be undefined when dataset is not selected\n    fields: PropTypes.arrayOf(PropTypes.any)\n  };\n\n  return FilterManager;\n}\n\nexport default FilterManagerFactory;\n"]},"metadata":{},"sourceType":"script"}