{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = EditorFactory;\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\nvar _reactMapGlDraw = require(\"react-map-gl-draw\");\nvar _window = _interopRequireDefault(require(\"global/window\"));\nvar _classnames = _interopRequireDefault(require(\"classnames\"));\nvar _lodash = _interopRequireDefault(require(\"lodash.get\"));\nvar _reselect = require(\"reselect\");\nvar _featureActionPanel = _interopRequireDefault(require(\"./feature-action-panel\"));\nvar _defaultSettings = require(\"../../constants/default-settings\");\nvar _featureStyles = require(\"./feature-styles\");\nvar _handleStyle = require(\"./handle-style\");\nvar _keyevent = _interopRequireDefault(require(\"../../constants/keyevent\"));\nvar _templateObject;\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nvar StyledWrapper = _styledComponents[\"default\"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  cursor: \", \";\\n  position: relative;\\n\"])), function (props) {\n  return props.editor.mode === _defaultSettings.EDITOR_MODES.EDIT ? 'pointer' : 'crosshair';\n});\nvar editorLayerFilter = function editorLayerFilter(layer) {\n  return _defaultSettings.EDITOR_AVAILABLE_LAYERS.includes(layer.type);\n};\nEditorFactory.deps = [_featureActionPanel[\"default\"]];\nfunction EditorFactory(FeatureActionPanel) {\n  var Editor = /*#__PURE__*/function (_Component) {\n    (0, _inherits2[\"default\"])(Editor, _Component);\n    var _super = _createSuper(Editor);\n    function Editor() {\n      var _this;\n      (0, _classCallCheck2[\"default\"])(this, Editor);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"state\", {\n        showActions: false,\n        lastPosition: null\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"layerSelector\", function (props) {\n        return props.layers;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"layersToRenderSelector\", function (props) {\n        return props.layersToRender;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"filterSelector\", function (props) {\n        return props.filters;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"selectedFeatureIdSelector\", function (props) {\n        return (0, _lodash[\"default\"])(props, ['editor', 'selectedFeature', 'id']);\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"editorFeatureSelector\", function (props) {\n        return (0, _lodash[\"default\"])(props, ['editor', 'features']);\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"currentFilterSelector\", (0, _reselect.createSelector)(_this.filterSelector, _this.selectedFeatureIdSelector, function (filters, selectedFeatureId) {\n        return filters.find(function (f) {\n          return f.value && f.value.id === selectedFeatureId;\n        });\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"availableLayersSeletor\", (0, _reselect.createSelector)(_this.layerSelector, _this.layersToRenderSelector, function (layers, layersToRender) {\n        return layers.filter(editorLayerFilter).filter(function (layer) {\n          return layersToRender[layer.id];\n        });\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"allFeaturesSelector\", (0, _reselect.createSelector)(_this.filterSelector, _this.editorFeatureSelector, function (filters, editorFeatures) {\n        return filters.filter(function (f) {\n          return f.type === _defaultSettings.FILTER_TYPES.polygon;\n        }).map(function (f) {\n          return f.value;\n        }).concat(editorFeatures);\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_onKeyPressed\", function (event) {\n        var isEnabled = _this.props.isEnabled;\n        if (!isEnabled) {\n          return;\n        }\n        switch (event.keyCode) {\n          case _keyevent[\"default\"].DOM_VK_DELETE:\n          case _keyevent[\"default\"].DOM_VK_BACK_SPACE:\n            _this._onDeleteSelectedFeature();\n            break;\n          case _keyevent[\"default\"].DOM_VK_ESCAPE:\n            _this.props.onSelect(null);\n            break;\n          default:\n            break;\n        }\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_onSelect\", function (_ref) {\n        var selectedFeatureId = _ref.selectedFeatureId,\n          sourceEvent = _ref.sourceEvent;\n        var allFeatures = _this.allFeaturesSelector(_this.props);\n        _this.setState(_objectSpread({}, sourceEvent.rightButton ? {\n          showActions: true,\n          lastPosition: {\n            x: sourceEvent.changedPointers[0].offsetX,\n            y: sourceEvent.changedPointers[0].offsetY\n          }\n        } : null), function () {\n          _this.props.onSelect(allFeatures.find(function (f) {\n            return f.id === selectedFeatureId;\n          }));\n        });\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_onDeleteSelectedFeature\", function () {\n        if (_this.state.showActions) {\n          _this.setState({\n            showActions: false\n          });\n        }\n        var editor = _this.props.editor;\n        var _editor$selectedFeatu = editor.selectedFeature,\n          selectedFeature = _editor$selectedFeatu === void 0 ? {} : _editor$selectedFeatu;\n        _this.props.onDeleteFeature(selectedFeature);\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_closeFeatureAction\", function () {\n        _this.setState({\n          showActions: false\n        });\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_onToggleLayer\", function (layer) {\n        var selectedFeature = _this.props.editor.selectedFeature;\n        if (!selectedFeature) {\n          return;\n        }\n        _this.props.onTogglePolygonFilter(layer, selectedFeature);\n      });\n      return _this;\n    }\n    (0, _createClass2[\"default\"])(Editor, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        _window[\"default\"].addEventListener('keydown', this._onKeyPressed);\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        _window[\"default\"].removeEventListener('keydown', this._onKeyPressed);\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var _this$props = this.props,\n          className = _this$props.className,\n          clickRadius = _this$props.clickRadius,\n          datasets = _this$props.datasets,\n          editor = _this$props.editor,\n          onUpdate = _this$props.onUpdate,\n          style = _this$props.style;\n        var _this$state = this.state,\n          lastPosition = _this$state.lastPosition,\n          showActions = _this$state.showActions;\n        var selectedFeatureId = (0, _lodash[\"default\"])(editor, ['selectedFeature', 'id']);\n        var currentFilter = this.currentFilterSelector(this.props);\n        var availableLayers = this.availableLayersSeletor(this.props);\n        var allFeatures = this.allFeaturesSelector(this.props);\n        return /*#__PURE__*/_react[\"default\"].createElement(StyledWrapper, {\n          editor: editor,\n          className: (0, _classnames[\"default\"])('editor', className),\n          style: style\n        }, /*#__PURE__*/_react[\"default\"].createElement(_reactMapGlDraw.Editor, {\n          clickRadius: clickRadius,\n          mode: editor.mode,\n          features: allFeatures,\n          selectedFeatureId: selectedFeatureId,\n          onSelect: this._onSelect,\n          onUpdate: onUpdate,\n          getEditHandleShape: _handleStyle.getEditHandleShape,\n          getFeatureStyle: _featureStyles.getStyle,\n          getEditHandleStyle: _handleStyle.getStyle\n        }), showActions && Boolean(selectedFeatureId) ? /*#__PURE__*/_react[\"default\"].createElement(FeatureActionPanel, {\n          selectedFeature: (0, _lodash[\"default\"])(editor, ['selectedFeature']),\n          datasets: datasets,\n          layers: availableLayers,\n          currentFilter: currentFilter,\n          onClose: this._closeFeatureAction,\n          onDeleteFeature: this._onDeleteSelectedFeature,\n          onToggleLayer: this._onToggleLayer,\n          position: lastPosition\n        }) : null);\n      }\n    }]);\n    return Editor;\n  }(_react.Component);\n  (0, _defineProperty2[\"default\"])(Editor, \"propTypes\", {\n    filters: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].object).isRequired,\n    layers: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].object).isRequired,\n    datasets: _propTypes[\"default\"].object.isRequired,\n    editor: _propTypes[\"default\"].object.isRequired,\n    layersToRender: _propTypes[\"default\"].object.isRequired,\n    onSelect: _propTypes[\"default\"].func.isRequired,\n    onUpdate: _propTypes[\"default\"].func.isRequired,\n    onDeleteFeature: _propTypes[\"default\"].func.isRequired,\n    onTogglePolygonFilter: _propTypes[\"default\"].func.isRequired,\n    index: _propTypes[\"default\"].number,\n    classnames: _propTypes[\"default\"].string,\n    clickRadius: _propTypes[\"default\"].number,\n    isEnabled: _propTypes[\"default\"].bool\n  });\n  (0, _defineProperty2[\"default\"])(Editor, \"defaultProps\", {\n    clickRadius: _featureStyles.DEFAULT_RADIUS\n  });\n  Editor.displayName = 'Editor';\n  return Editor;\n}","map":{"version":3,"sources":["../../../src/components/editor/editor.js"],"names":["StyledWrapper","styled","div","props","editor","mode","EDITOR_MODES","EDIT","editorLayerFilter","EDITOR_AVAILABLE_LAYERS","includes","layer","type","EditorFactory","deps","FeatureActionPanelFactory","FeatureActionPanel","Editor","Component","filters","PropTypes","arrayOf","object","isRequired","layers","datasets","layersToRender","onSelect","func","onUpdate","onDeleteFeature","onTogglePolygonFilter","index","number","classnames","string","clickRadius","isEnabled","bool","DEFAULT_RADIUS","showActions","lastPosition","window","addEventListener","_onKeyPressed","removeEventListener","filterSelector","selectedFeatureIdSelector","selectedFeatureId","find","f","value","id","layerSelector","layersToRenderSelector","filter","editorFeatureSelector","editorFeatures","FILTER_TYPES","polygon","map","concat","event","keyCode","KeyEvent","DOM_VK_DELETE","DOM_VK_BACK_SPACE","_onDeleteSelectedFeature","DOM_VK_ESCAPE","sourceEvent","allFeatures","allFeaturesSelector","setState","rightButton","x","changedPointers","offsetX","y","offsetY","state","selectedFeature","className","style","currentFilter","currentFilterSelector","availableLayers","availableLayersSeletor","_onSelect","getEditHandleShape","getFeatureStyle","getEditHandleStyle","Boolean","_closeFeatureAction","_onToggleLayer","displayName"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport {Editor as Draw} from 'react-map-gl-draw';\nimport window from 'global/window';\nimport classnames from 'classnames';\nimport get from 'lodash.get';\nimport {createSelector} from 'reselect';\n\nimport FeatureActionPanelFactory from './feature-action-panel';\nimport {FILTER_TYPES, EDITOR_MODES, EDITOR_AVAILABLE_LAYERS} from 'constants/default-settings';\n\nimport {DEFAULT_RADIUS, getStyle as getFeatureStyle} from './feature-styles';\nimport {getStyle as getEditHandleStyle, getEditHandleShape} from './handle-style';\nimport KeyEvent from 'constants/keyevent';\n\nconst StyledWrapper = styled.div`\n  cursor: ${props => (props.editor.mode === EDITOR_MODES.EDIT ? 'pointer' : 'crosshair')};\n  position: relative;\n`;\n\nconst editorLayerFilter = layer => EDITOR_AVAILABLE_LAYERS.includes(layer.type);\n\nEditorFactory.deps = [FeatureActionPanelFactory];\n\nexport default function EditorFactory(FeatureActionPanel) {\n  class Editor extends Component {\n    static propTypes = {\n      filters: PropTypes.arrayOf(PropTypes.object).isRequired,\n      layers: PropTypes.arrayOf(PropTypes.object).isRequired,\n      datasets: PropTypes.object.isRequired,\n      editor: PropTypes.object.isRequired,\n      layersToRender: PropTypes.object.isRequired,\n      onSelect: PropTypes.func.isRequired,\n      onUpdate: PropTypes.func.isRequired,\n      onDeleteFeature: PropTypes.func.isRequired,\n      onTogglePolygonFilter: PropTypes.func.isRequired,\n\n      index: PropTypes.number,\n      classnames: PropTypes.string,\n      clickRadius: PropTypes.number,\n      isEnabled: PropTypes.bool\n    };\n\n    static defaultProps = {\n      clickRadius: DEFAULT_RADIUS\n    };\n\n    state = {\n      showActions: false,\n      lastPosition: null\n    };\n\n    componentDidMount() {\n      window.addEventListener('keydown', this._onKeyPressed);\n    }\n\n    componentWillUnmount() {\n      window.removeEventListener('keydown', this._onKeyPressed);\n    }\n\n    layerSelector = props => props.layers;\n    layersToRenderSelector = props => props.layersToRender;\n    filterSelector = props => props.filters;\n    selectedFeatureIdSelector = props => get(props, ['editor', 'selectedFeature', 'id']);\n    editorFeatureSelector = props => get(props, ['editor', 'features']);\n\n    currentFilterSelector = createSelector(\n      this.filterSelector,\n      this.selectedFeatureIdSelector,\n      (filters, selectedFeatureId) => filters.find(f => f.value && f.value.id === selectedFeatureId)\n    );\n\n    availableLayersSeletor = createSelector(\n      this.layerSelector,\n      this.layersToRenderSelector,\n      (layers, layersToRender) =>\n        layers.filter(editorLayerFilter).filter(layer => {\n          return layersToRender[layer.id];\n        })\n    );\n\n    allFeaturesSelector = createSelector(\n      this.filterSelector,\n      this.editorFeatureSelector,\n      (filters, editorFeatures) =>\n        filters\n          .filter(f => f.type === FILTER_TYPES.polygon)\n          .map(f => f.value)\n          .concat(editorFeatures)\n    );\n\n    _onKeyPressed = event => {\n      const {isEnabled} = this.props;\n\n      if (!isEnabled) {\n        return;\n      }\n\n      switch (event.keyCode) {\n        case KeyEvent.DOM_VK_DELETE:\n        case KeyEvent.DOM_VK_BACK_SPACE:\n          this._onDeleteSelectedFeature();\n          break;\n        case KeyEvent.DOM_VK_ESCAPE:\n          this.props.onSelect(null);\n          break;\n        default:\n          break;\n      }\n    };\n\n    _onSelect = ({selectedFeatureId, sourceEvent}) => {\n      const allFeatures = this.allFeaturesSelector(this.props);\n      this.setState(\n        {\n          ...(sourceEvent.rightButton\n            ? {\n                showActions: true,\n                lastPosition: {\n                  x: sourceEvent.changedPointers[0].offsetX,\n                  y: sourceEvent.changedPointers[0].offsetY\n                }\n              }\n            : null)\n        },\n        () => {\n          this.props.onSelect(allFeatures.find(f => f.id === selectedFeatureId));\n        }\n      );\n    };\n\n    _onDeleteSelectedFeature = () => {\n      if (this.state.showActions) {\n        this.setState({showActions: false});\n      }\n\n      const {editor} = this.props;\n      const {selectedFeature = {}} = editor;\n      this.props.onDeleteFeature(selectedFeature);\n    };\n\n    _closeFeatureAction = () => {\n      this.setState({showActions: false});\n    };\n\n    _onToggleLayer = layer => {\n      const {selectedFeature} = this.props.editor;\n      if (!selectedFeature) {\n        return;\n      }\n\n      this.props.onTogglePolygonFilter(layer, selectedFeature);\n    };\n\n    render() {\n      const {className, clickRadius, datasets, editor, onUpdate, style} = this.props;\n\n      const {lastPosition, showActions} = this.state;\n      const selectedFeatureId = get(editor, ['selectedFeature', 'id']);\n      const currentFilter = this.currentFilterSelector(this.props);\n      const availableLayers = this.availableLayersSeletor(this.props);\n      const allFeatures = this.allFeaturesSelector(this.props);\n\n      return (\n        <StyledWrapper editor={editor} className={classnames('editor', className)} style={style}>\n          <Draw\n            clickRadius={clickRadius}\n            mode={editor.mode}\n            features={allFeatures}\n            selectedFeatureId={selectedFeatureId}\n            onSelect={this._onSelect}\n            onUpdate={onUpdate}\n            getEditHandleShape={getEditHandleShape}\n            getFeatureStyle={getFeatureStyle}\n            getEditHandleStyle={getEditHandleStyle}\n          />\n          {showActions && Boolean(selectedFeatureId) ? (\n            <FeatureActionPanel\n              selectedFeature={get(editor, ['selectedFeature'])}\n              datasets={datasets}\n              layers={availableLayers}\n              currentFilter={currentFilter}\n              onClose={this._closeFeatureAction}\n              onDeleteFeature={this._onDeleteSelectedFeature}\n              onToggleLayer={this._onToggleLayer}\n              position={lastPosition}\n            />\n          ) : null}\n        </StyledWrapper>\n      );\n    }\n  }\n\n  Editor.displayName = 'Editor';\n\n  return Editor;\n}\n"]},"metadata":{},"sourceType":"script"}