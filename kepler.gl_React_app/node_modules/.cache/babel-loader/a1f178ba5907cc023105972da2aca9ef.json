{"ast":null,"code":"import { assertWebGL2Context, withParameters } from '@luma.gl/gltools';\nimport { assert } from '../utils/assert';\nconst GL_DEPTH_BUFFER_BIT = 0x00000100;\nconst GL_STENCIL_BUFFER_BIT = 0x00000400;\nconst GL_COLOR_BUFFER_BIT = 0x00004000;\nconst GL_COLOR = 0x1800;\nconst GL_DEPTH = 0x1801;\nconst GL_STENCIL = 0x1802;\nconst GL_DEPTH_STENCIL = 0x84f9;\nconst ERR_ARGUMENTS = 'clear: bad arguments';\nexport function clear(gl) {\n  let {\n    framebuffer = null,\n    color = null,\n    depth = null,\n    stencil = null\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const parameters = {};\n  if (framebuffer) {\n    parameters.framebuffer = framebuffer;\n  }\n  let clearFlags = 0;\n  if (color) {\n    clearFlags |= GL_COLOR_BUFFER_BIT;\n    if (color !== true) {\n      parameters.clearColor = color;\n    }\n  }\n  if (depth) {\n    clearFlags |= GL_DEPTH_BUFFER_BIT;\n    if (depth !== true) {\n      parameters.clearDepth = depth;\n    }\n  }\n  if (stencil) {\n    clearFlags |= GL_STENCIL_BUFFER_BIT;\n    if (depth !== true) {\n      parameters.clearStencil = depth;\n    }\n  }\n  assert(clearFlags !== 0, ERR_ARGUMENTS);\n  withParameters(gl, parameters, () => {\n    gl.clear(clearFlags);\n  });\n}\nexport function clearBuffer(gl) {\n  let {\n    framebuffer = null,\n    buffer = GL_COLOR,\n    drawBuffer = 0,\n    value = [0, 0, 0, 0]\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  assertWebGL2Context(gl);\n  withParameters(gl, {\n    framebuffer\n  }, () => {\n    switch (buffer) {\n      case GL_COLOR:\n        switch (value.constructor) {\n          case Int32Array:\n            gl.clearBufferiv(buffer, drawBuffer, value);\n            break;\n          case Uint32Array:\n            gl.clearBufferuiv(buffer, drawBuffer, value);\n            break;\n          case Float32Array:\n          default:\n            gl.clearBufferfv(buffer, drawBuffer, value);\n        }\n        break;\n      case GL_DEPTH:\n        gl.clearBufferfv(GL_DEPTH, 0, [value]);\n        break;\n      case GL_STENCIL:\n        gl.clearBufferiv(GL_STENCIL, 0, [value]);\n        break;\n      case GL_DEPTH_STENCIL:\n        const [depth, stencil] = value;\n        gl.clearBufferfi(GL_DEPTH_STENCIL, 0, depth, stencil);\n        break;\n      default:\n        assert(false, ERR_ARGUMENTS);\n    }\n  });\n}","map":{"version":3,"sources":["../../../src/classes/clear.js"],"names":["assertWebGL2Context","withParameters","assert","GL_DEPTH_BUFFER_BIT","GL_STENCIL_BUFFER_BIT","GL_COLOR_BUFFER_BIT","GL_COLOR","GL_DEPTH","GL_STENCIL","GL_DEPTH_STENCIL","ERR_ARGUMENTS","clear","gl","framebuffer","color","depth","stencil","parameters","clearFlags","clearColor","clearDepth","clearStencil","clearBuffer","buffer","drawBuffer","value","constructor","Int32Array","clearBufferiv","Uint32Array","clearBufferuiv","Float32Array","clearBufferfv","clearBufferfi"],"mappings":"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","sourcesContent":["import {assertWebGL2Context, withParameters} from '@luma.gl/gltools';\nimport {assert} from '../utils/assert';\n\n// Should collapse during minification\nconst GL_DEPTH_BUFFER_BIT = 0x00000100;\nconst GL_STENCIL_BUFFER_BIT = 0x00000400;\nconst GL_COLOR_BUFFER_BIT = 0x00004000;\n\nconst GL_COLOR = 0x1800;\nconst GL_DEPTH = 0x1801;\nconst GL_STENCIL = 0x1802;\nconst GL_DEPTH_STENCIL = 0x84f9;\n\n// Should disappear if asserts are removed\nconst ERR_ARGUMENTS = 'clear: bad arguments';\n\n// Optionally clears depth, color and stencil buffers\n/** @type {import('./clear').clear} */\nexport function clear(gl, {framebuffer = null, color = null, depth = null, stencil = null} = {}) {\n  const parameters = {};\n\n  if (framebuffer) {\n    parameters.framebuffer = framebuffer;\n  }\n\n  let clearFlags = 0;\n\n  if (color) {\n    clearFlags |= GL_COLOR_BUFFER_BIT;\n    if (color !== true) {\n      parameters.clearColor = color;\n    }\n  }\n\n  if (depth) {\n    clearFlags |= GL_DEPTH_BUFFER_BIT;\n    if (depth !== true) {\n      parameters.clearDepth = depth;\n    }\n  }\n\n  if (stencil) {\n    clearFlags |= GL_STENCIL_BUFFER_BIT;\n    if (depth !== true) {\n      parameters.clearStencil = depth;\n    }\n  }\n\n  assert(clearFlags !== 0, ERR_ARGUMENTS);\n\n  // Temporarily set any clear \"colors\" and call clear\n  withParameters(gl, parameters, () => {\n    gl.clear(clearFlags);\n  });\n}\n\n// WebGL2 - clear a specific drawing buffer\n/** @type {import('./clear').clearBuffer} */\nexport function clearBuffer(\n  gl,\n  {framebuffer = null, buffer = GL_COLOR, drawBuffer = 0, value = [0, 0, 0, 0]} = {}\n) {\n  assertWebGL2Context(gl);\n\n  withParameters(gl, {framebuffer}, () => {\n    // Method selection per OpenGL ES 3 docs\n    switch (buffer) {\n      case GL_COLOR:\n        switch (value.constructor) {\n          case Int32Array:\n            gl.clearBufferiv(buffer, drawBuffer, value);\n            break;\n          case Uint32Array:\n            gl.clearBufferuiv(buffer, drawBuffer, value);\n            break;\n          case Float32Array:\n          default:\n            gl.clearBufferfv(buffer, drawBuffer, value);\n        }\n        break;\n\n      case GL_DEPTH:\n        gl.clearBufferfv(GL_DEPTH, 0, [value]);\n        break;\n\n      case GL_STENCIL:\n        gl.clearBufferiv(GL_STENCIL, 0, [value]);\n        break;\n\n      case GL_DEPTH_STENCIL:\n        const [depth, stencil] = value;\n        gl.clearBufferfi(GL_DEPTH_STENCIL, 0, depth, stencil);\n        break;\n\n      default:\n        assert(false, ERR_ARGUMENTS);\n    }\n  });\n}\n"]},"metadata":{},"sourceType":"module"}