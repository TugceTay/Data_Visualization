{"ast":null,"code":"import { Vector3, Matrix4 } from '@math.gl/core';\nimport { assert, uid } from '@luma.gl/webgl';\nexport default class ScenegraphNode {\n  constructor() {\n    let props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const {\n      id\n    } = props;\n    this.id = id || uid(this.constructor.name);\n    this.display = true;\n    this.position = new Vector3();\n    this.rotation = new Vector3();\n    this.scale = new Vector3(1, 1, 1);\n    this.matrix = new Matrix4();\n    this.userData = {};\n    this.props = {};\n    this._setScenegraphNodeProps(props);\n  }\n  delete() {}\n  setProps(props) {\n    this._setScenegraphNodeProps(props);\n    return this;\n  }\n  toString() {\n    return \"{type: ScenegraphNode, id: \".concat(this.id, \")}\");\n  }\n  setPosition(position) {\n    assert(position.length === 3, 'setPosition requires vector argument');\n    this.position = position;\n    return this;\n  }\n  setRotation(rotation) {\n    assert(rotation.length === 3, 'setRotation requires vector argument');\n    this.rotation = rotation;\n    return this;\n  }\n  setScale(scale) {\n    assert(scale.length === 3, 'setScale requires vector argument');\n    this.scale = scale;\n    return this;\n  }\n  setMatrix(matrix) {\n    let copyMatrix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    if (copyMatrix) {\n      this.matrix.copy(matrix);\n    } else {\n      this.matrix = matrix;\n    }\n  }\n  setMatrixComponents(_ref) {\n    let {\n      position,\n      rotation,\n      scale,\n      update = true\n    } = _ref;\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    if (update) {\n      this.updateMatrix();\n    }\n    return this;\n  }\n  updateMatrix() {\n    const pos = this.position;\n    const rot = this.rotation;\n    const scale = this.scale;\n    this.matrix.identity();\n    this.matrix.translate(pos);\n    this.matrix.rotateXYZ(rot);\n    this.matrix.scale(scale);\n    return this;\n  }\n  update() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const {\n      position,\n      rotation,\n      scale\n    } = options;\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    this.updateMatrix();\n    return this;\n  }\n  getCoordinateUniforms(viewMatrix, modelMatrix) {\n    assert(viewMatrix);\n    modelMatrix = modelMatrix || this.matrix;\n    const worldMatrix = new Matrix4(viewMatrix).multiplyRight(modelMatrix);\n    const worldInverse = worldMatrix.invert();\n    const worldInverseTranspose = worldInverse.transpose();\n    return {\n      viewMatrix,\n      modelMatrix,\n      objectMatrix: modelMatrix,\n      worldMatrix,\n      worldInverseMatrix: worldInverse,\n      worldInverseTransposeMatrix: worldInverseTranspose\n    };\n  }\n  _setScenegraphNodeProps(props) {\n    if ('display' in props) {\n      this.display = props.display;\n    }\n    if ('position' in props) {\n      this.setPosition(props.position);\n    }\n    if ('rotation' in props) {\n      this.setRotation(props.rotation);\n    }\n    if ('scale' in props) {\n      this.setScale(props.scale);\n    }\n    if ('matrix' in props) {\n      this.setMatrix(props.matrix);\n    }\n    Object.assign(this.props, props);\n  }\n}","map":{"version":3,"sources":["../../../src/scenegraph/scenegraph-node.js"],"names":["Vector3","Matrix4","assert","uid","ScenegraphNode","constructor","props","id","name","display","position","rotation","scale","matrix","userData","_setScenegraphNodeProps","delete","setProps","toString","setPosition","length","setRotation","setScale","setMatrix","copyMatrix","copy","setMatrixComponents","update","updateMatrix","pos","rot","identity","translate","rotateXYZ","options","getCoordinateUniforms","viewMatrix","modelMatrix","worldMatrix","multiplyRight","worldInverse","invert","worldInverseTranspose","transpose","objectMatrix","worldInverseMatrix","worldInverseTransposeMatrix","Object","assign"],"mappings":"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","sourcesContent":["import {Vector3, Matrix4} from '@math.gl/core';\nimport {assert, uid} from '@luma.gl/webgl';\n\nexport default class ScenegraphNode {\n  constructor(props = {}) {\n    const {id} = props;\n\n    this.id = id || uid(this.constructor.name);\n\n    this.display = true; // whether to display the object at all\n    this.position = new Vector3();\n    this.rotation = new Vector3();\n    this.scale = new Vector3(1, 1, 1);\n    this.matrix = new Matrix4();\n    this.userData = {};\n\n    this.props = {};\n    this._setScenegraphNodeProps(props);\n  }\n\n  delete() {}\n\n  setProps(props) {\n    this._setScenegraphNodeProps(props);\n    return this;\n  }\n\n  toString() {\n    return `{type: ScenegraphNode, id: ${this.id})}`;\n  }\n\n  setPosition(position) {\n    assert(position.length === 3, 'setPosition requires vector argument');\n    this.position = position;\n    return this;\n  }\n\n  setRotation(rotation) {\n    assert(rotation.length === 3, 'setRotation requires vector argument');\n    this.rotation = rotation;\n    return this;\n  }\n\n  setScale(scale) {\n    assert(scale.length === 3, 'setScale requires vector argument');\n    this.scale = scale;\n    return this;\n  }\n\n  setMatrix(matrix, copyMatrix = true) {\n    if (copyMatrix) {\n      this.matrix.copy(matrix);\n    } else {\n      this.matrix = matrix;\n    }\n  }\n\n  setMatrixComponents({position, rotation, scale, update = true}) {\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    if (update) {\n      this.updateMatrix();\n    }\n    return this;\n  }\n\n  updateMatrix() {\n    const pos = this.position;\n    const rot = this.rotation;\n    const scale = this.scale;\n\n    this.matrix.identity();\n    this.matrix.translate(pos);\n    this.matrix.rotateXYZ(rot);\n    this.matrix.scale(scale);\n    return this;\n  }\n\n  update(options = {}) {\n    const {position, rotation, scale} = options;\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    this.updateMatrix();\n    return this;\n  }\n\n  getCoordinateUniforms(viewMatrix, modelMatrix) {\n    // TODO - solve multiple class problem\n    // assert(viewMatrix instanceof Matrix4);\n    assert(viewMatrix);\n    modelMatrix = modelMatrix || this.matrix;\n    const worldMatrix = new Matrix4(viewMatrix).multiplyRight(modelMatrix);\n    const worldInverse = worldMatrix.invert();\n    const worldInverseTranspose = worldInverse.transpose();\n\n    return {\n      viewMatrix,\n      modelMatrix,\n      objectMatrix: modelMatrix,\n      worldMatrix,\n      worldInverseMatrix: worldInverse,\n      worldInverseTransposeMatrix: worldInverseTranspose\n    };\n  }\n\n  // TODO - copied code, not yet vetted\n  /*\n  transform() {\n    if (!this.parent) {\n      this.endPosition.set(this.position);\n      this.endRotation.set(this.rotation);\n      this.endScale.set(this.scale);\n    } else {\n      const parent = this.parent;\n      this.endPosition.set(this.position.add(parent.endPosition));\n      this.endRotation.set(this.rotation.add(parent.endRotation));\n      this.endScale.set(this.scale.add(parent.endScale));\n    }\n\n    const ch = this.children;\n    for (let i = 0; i < ch.length; ++i) {\n      ch[i].transform();\n    }\n\n    return this;\n  }\n  */\n\n  _setScenegraphNodeProps(props) {\n    if ('display' in props) {\n      this.display = props.display;\n    }\n\n    if ('position' in props) {\n      this.setPosition(props.position);\n    }\n    if ('rotation' in props) {\n      this.setRotation(props.rotation);\n    }\n    if ('scale' in props) {\n      this.setScale(props.scale);\n    }\n\n    // Matrix overwrites other props\n    if ('matrix' in props) {\n      this.setMatrix(props.matrix);\n    }\n\n    Object.assign(this.props, props);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}