{"ast":null,"code":"import Resource from './resource';\nimport RENDERBUFFER_FORMATS from './renderbuffer-formats';\nimport { isWebGL2 } from '@luma.gl/gltools';\nimport { assert } from '../utils/assert';\nfunction isFormatSupported(gl, format, formats) {\n  const info = formats[format];\n  if (!info) {\n    return false;\n  }\n  const value = isWebGL2(gl) ? info.gl2 || info.gl1 : info.gl1;\n  if (typeof value === 'string') {\n    return gl.getExtension(value);\n  }\n  return value;\n}\nexport default class Renderbuffer extends Resource {\n  get [Symbol.toStringTag]() {\n    return 'Renderbuffer';\n  }\n  static isSupported(gl) {\n    let {\n      format\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      format: null\n    };\n    return !format || isFormatSupported(gl, format, RENDERBUFFER_FORMATS);\n  }\n  static getSamplesForFormat(gl, _ref) {\n    let {\n      format\n    } = _ref;\n    return gl.getInternalformatParameter(36161, format, 32937);\n  }\n  constructor(gl) {\n    let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(gl, opts);\n    this.initialize(opts);\n    Object.seal(this);\n  }\n  initialize(_ref2) {\n    let {\n      format,\n      width = 1,\n      height = 1,\n      samples = 0\n    } = _ref2;\n    assert(format, 'Needs format');\n    this._trackDeallocatedMemory();\n    this.gl.bindRenderbuffer(36161, this.handle);\n    if (samples !== 0 && isWebGL2(this.gl)) {\n      this.gl.renderbufferStorageMultisample(36161, samples, format, width, height);\n    } else {\n      this.gl.renderbufferStorage(36161, format, width, height);\n    }\n    this.format = format;\n    this.width = width;\n    this.height = height;\n    this.samples = samples;\n    this._trackAllocatedMemory(this.width * this.height * (this.samples || 1) * RENDERBUFFER_FORMATS[this.format].bpp);\n    return this;\n  }\n  resize(_ref3) {\n    let {\n      width,\n      height\n    } = _ref3;\n    if (width !== this.width || height !== this.height) {\n      return this.initialize({\n        width,\n        height,\n        format: this.format,\n        samples: this.samples\n      });\n    }\n    return this;\n  }\n  _createHandle() {\n    return this.gl.createRenderbuffer();\n  }\n  _deleteHandle() {\n    this.gl.deleteRenderbuffer(this.handle);\n    this._trackDeallocatedMemory();\n  }\n  _bindHandle(handle) {\n    this.gl.bindRenderbuffer(36161, handle);\n  }\n  _syncHandle(handle) {\n    this.format = this.getParameter(36164);\n    this.width = this.getParameter(36162);\n    this.height = this.getParameter(36163);\n    this.samples = this.getParameter(36011);\n  }\n  _getParameter(pname) {\n    this.gl.bindRenderbuffer(36161, this.handle);\n    const value = this.gl.getRenderbufferParameter(36161, pname);\n    return value;\n  }\n}","map":{"version":3,"sources":["../../../src/classes/renderbuffer.js"],"names":["Resource","RENDERBUFFER_FORMATS","isWebGL2","assert","isFormatSupported","gl","format","formats","info","value","gl2","gl1","getExtension","Renderbuffer","Symbol","toStringTag","isSupported","getSamplesForFormat","getInternalformatParameter","constructor","opts","initialize","Object","seal","width","height","samples","_trackDeallocatedMemory","bindRenderbuffer","handle","renderbufferStorageMultisample","renderbufferStorage","_trackAllocatedMemory","bpp","resize","_createHandle","createRenderbuffer","_deleteHandle","deleteRenderbuffer","_bindHandle","_syncHandle","getParameter","_getParameter","pname","getRenderbufferParameter"],"mappings":"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","sourcesContent":["/* eslint-disable no-inline-comments */\nimport GL from '@luma.gl/constants';\nimport Resource from './resource';\nimport RENDERBUFFER_FORMATS from './renderbuffer-formats';\nimport {isWebGL2} from '@luma.gl/gltools';\nimport {assert} from '../utils/assert';\n\nfunction isFormatSupported(gl, format, formats) {\n  const info = formats[format];\n  if (!info) {\n    return false;\n  }\n  const value = isWebGL2(gl) ? info.gl2 || info.gl1 : info.gl1;\n  if (typeof value === 'string') {\n    return gl.getExtension(value);\n  }\n  return value;\n}\n\nexport default class Renderbuffer extends Resource {\n  // eslint-disable-next-line accessor-pairs\n  get [Symbol.toStringTag]() {\n    return 'Renderbuffer';\n  }\n  static isSupported(gl, {format} = {format: null}) {\n    return !format || isFormatSupported(gl, format, RENDERBUFFER_FORMATS);\n  }\n\n  static getSamplesForFormat(gl, {format}) {\n    // Polyfilled to return [0] under WebGL1\n    return gl.getInternalformatParameter(GL.RENDERBUFFER, format, GL.SAMPLES);\n  }\n\n  constructor(gl, opts = {}) {\n    super(gl, opts);\n\n    // @ts-ignore\n    this.initialize(opts);\n\n    Object.seal(this);\n  }\n\n  // Creates and initializes a renderbuffer object's data store\n  initialize({format, width = 1, height = 1, samples = 0}) {\n    assert(format, 'Needs format');\n\n    this._trackDeallocatedMemory();\n\n    this.gl.bindRenderbuffer(GL.RENDERBUFFER, this.handle);\n\n    if (samples !== 0 && isWebGL2(this.gl)) {\n      // @ts-ignore\n      this.gl.renderbufferStorageMultisample(GL.RENDERBUFFER, samples, format, width, height);\n    } else {\n      this.gl.renderbufferStorage(GL.RENDERBUFFER, format, width, height);\n    }\n\n    // this.gl.bindRenderbuffer(GL.RENDERBUFFER, null);\n\n    this.format = format;\n    this.width = width;\n    this.height = height;\n    this.samples = samples;\n\n    this._trackAllocatedMemory(\n      this.width * this.height * (this.samples || 1) * RENDERBUFFER_FORMATS[this.format].bpp\n    );\n\n    return this;\n  }\n\n  resize({width, height}) {\n    // Don't resize if width/height haven't changed\n    if (width !== this.width || height !== this.height) {\n      return this.initialize({width, height, format: this.format, samples: this.samples});\n    }\n    return this;\n  }\n\n  // PRIVATE METHODS\n  _createHandle() {\n    return this.gl.createRenderbuffer();\n  }\n\n  _deleteHandle() {\n    this.gl.deleteRenderbuffer(this.handle);\n    this._trackDeallocatedMemory();\n  }\n\n  _bindHandle(handle) {\n    this.gl.bindRenderbuffer(GL.RENDERBUFFER, handle);\n  }\n\n  _syncHandle(handle) {\n    this.format = this.getParameter(GL.RENDERBUFFER_INTERNAL_FORMAT);\n    this.width = this.getParameter(GL.RENDERBUFFER_WIDTH);\n    this.height = this.getParameter(GL.RENDERBUFFER_HEIGHT);\n    this.samples = this.getParameter(GL.RENDERBUFFER_SAMPLES);\n  }\n\n  // @param {Boolean} opt.autobind=true - method call will bind/unbind object\n  // @returns {GLenum|GLint} - depends on pname\n  _getParameter(pname) {\n    this.gl.bindRenderbuffer(GL.RENDERBUFFER, this.handle);\n    const value = this.gl.getRenderbufferParameter(GL.RENDERBUFFER, pname);\n    // this.gl.bindRenderbuffer(GL.RENDERBUFFER, null);\n    return value;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}