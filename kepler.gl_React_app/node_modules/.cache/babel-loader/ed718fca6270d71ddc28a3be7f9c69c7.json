{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport * as PropTypes from 'prop-types';\nimport { document } from '../utils/globals';\nimport { normalizeStyle } from '../utils/style-utils';\nfunction noop() {}\nfunction defaultOnError(event) {\n  if (event) {\n    console.error(event.error);\n  }\n}\nvar propTypes = {\n  container: PropTypes.object,\n  gl: PropTypes.object,\n  mapboxApiAccessToken: PropTypes.string,\n  mapboxApiUrl: PropTypes.string,\n  attributionControl: PropTypes.bool,\n  preserveDrawingBuffer: PropTypes.bool,\n  reuseMaps: PropTypes.bool,\n  transformRequest: PropTypes.func,\n  mapOptions: PropTypes.object,\n  mapStyle: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  preventStyleDiffing: PropTypes.bool,\n  visible: PropTypes.bool,\n  asyncRender: PropTypes.bool,\n  onLoad: PropTypes.func,\n  onError: PropTypes.func,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  viewState: PropTypes.object,\n  longitude: PropTypes.number,\n  latitude: PropTypes.number,\n  zoom: PropTypes.number,\n  bearing: PropTypes.number,\n  pitch: PropTypes.number,\n  altitude: PropTypes.number\n};\nvar defaultProps = {\n  container: document.body,\n  mapboxApiAccessToken: getAccessToken(),\n  mapboxApiUrl: 'https://api.mapbox.com',\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  reuseMaps: false,\n  mapOptions: {},\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n  preventStyleDiffing: false,\n  visible: true,\n  asyncRender: false,\n  onLoad: noop,\n  onError: defaultOnError,\n  width: 0,\n  height: 0,\n  longitude: 0,\n  latitude: 0,\n  zoom: 0,\n  bearing: 0,\n  pitch: 0,\n  altitude: 1.5\n};\nexport function getAccessToken() {\n  var accessToken = null;\n  if (typeof window !== 'undefined' && window.location) {\n    var match = window.location.search.match(/access_token=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n  if (!accessToken && typeof process !== 'undefined') {\n    accessToken = accessToken || process.env.MapboxAccessToken || process.env.REACT_APP_MAPBOX_ACCESS_TOKEN;\n  }\n  return accessToken || 'no-token';\n}\nfunction checkPropTypes(props) {\n  var component = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'component';\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\nvar Mapbox = function () {\n  function Mapbox(props) {\n    var _this = this;\n    _classCallCheck(this, Mapbox);\n    _defineProperty(this, \"props\", defaultProps);\n    _defineProperty(this, \"width\", 0);\n    _defineProperty(this, \"height\", 0);\n    _defineProperty(this, \"_fireLoadEvent\", function () {\n      _this.props.onLoad({\n        type: 'load',\n        target: _this._map\n      });\n    });\n    _defineProperty(this, \"_handleError\", function (event) {\n      _this.props.onError(event);\n    });\n    if (!props.mapboxgl) {\n      throw new Error('Mapbox not available');\n    }\n    this.mapboxgl = props.mapboxgl;\n    if (!Mapbox.initialized) {\n      Mapbox.initialized = true;\n      this._checkStyleSheet(this.mapboxgl.version);\n    }\n    this._initialize(props);\n  }\n  _createClass(Mapbox, [{\n    key: \"finalize\",\n    value: function finalize() {\n      this._destroy();\n      return this;\n    }\n  }, {\n    key: \"setProps\",\n    value: function setProps(props) {\n      this._update(this.props, props);\n      return this;\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var map = this._map;\n      if (map.style) {\n        if (map._frame) {\n          map._frame.cancel();\n          map._frame = null;\n        }\n        map._render();\n      }\n    }\n  }, {\n    key: \"getMap\",\n    value: function getMap() {\n      return this._map;\n    }\n  }, {\n    key: \"_reuse\",\n    value: function _reuse(props) {\n      this._map = Mapbox.savedMap;\n      var oldContainer = this._map.getContainer();\n      var newContainer = props.container;\n      newContainer.classList.add('mapboxgl-map');\n      while (oldContainer.childNodes.length > 0) {\n        newContainer.appendChild(oldContainer.childNodes[0]);\n      }\n      this._map._container = newContainer;\n      Mapbox.savedMap = null;\n      if (props.mapStyle) {\n        this._map.setStyle(normalizeStyle(props.mapStyle), {\n          diff: false\n        });\n      }\n      if (this._map.isStyleLoaded()) {\n        this._fireLoadEvent();\n      } else {\n        this._map.once('styledata', this._fireLoadEvent);\n      }\n    }\n  }, {\n    key: \"_create\",\n    value: function _create(props) {\n      if (props.reuseMaps && Mapbox.savedMap) {\n        this._reuse(props);\n      } else {\n        if (props.gl) {\n          var getContext = HTMLCanvasElement.prototype.getContext;\n          HTMLCanvasElement.prototype.getContext = function () {\n            HTMLCanvasElement.prototype.getContext = getContext;\n            return props.gl;\n          };\n        }\n        var mapOptions = {\n          container: props.container,\n          center: [0, 0],\n          zoom: 8,\n          pitch: 0,\n          bearing: 0,\n          maxZoom: 24,\n          style: normalizeStyle(props.mapStyle),\n          interactive: false,\n          trackResize: false,\n          attributionControl: props.attributionControl,\n          preserveDrawingBuffer: props.preserveDrawingBuffer\n        };\n        if (props.transformRequest) {\n          mapOptions.transformRequest = props.transformRequest;\n        }\n        this._map = new this.mapboxgl.Map(Object.assign({}, mapOptions, props.mapOptions));\n        this._map.once('load', this._fireLoadEvent);\n        this._map.on('error', this._handleError);\n      }\n      return this;\n    }\n  }, {\n    key: \"_destroy\",\n    value: function _destroy() {\n      if (!this._map) {\n        return;\n      }\n      if (this.props.reuseMaps && !Mapbox.savedMap) {\n        Mapbox.savedMap = this._map;\n        this._map.off('load', this._fireLoadEvent);\n        this._map.off('error', this._handleError);\n        this._map.off('styledata', this._fireLoadEvent);\n      } else {\n        this._map.remove();\n      }\n      this._map = null;\n    }\n  }, {\n    key: \"_initialize\",\n    value: function _initialize(props) {\n      var _this2 = this;\n      props = Object.assign({}, defaultProps, props);\n      checkPropTypes(props, 'Mapbox');\n      this.mapboxgl.accessToken = props.mapboxApiAccessToken || defaultProps.mapboxApiAccessToken;\n      this.mapboxgl.baseApiUrl = props.mapboxApiUrl;\n      this._create(props);\n      var _props = props,\n        container = _props.container;\n      Object.defineProperty(container, 'offsetWidth', {\n        configurable: true,\n        get: function get() {\n          return _this2.width;\n        }\n      });\n      Object.defineProperty(container, 'clientWidth', {\n        configurable: true,\n        get: function get() {\n          return _this2.width;\n        }\n      });\n      Object.defineProperty(container, 'offsetHeight', {\n        configurable: true,\n        get: function get() {\n          return _this2.height;\n        }\n      });\n      Object.defineProperty(container, 'clientHeight', {\n        configurable: true,\n        get: function get() {\n          return _this2.height;\n        }\n      });\n      var canvas = this._map.getCanvas();\n      if (canvas) {\n        canvas.style.outline = 'none';\n      }\n      this._updateMapViewport({}, props);\n      this._updateMapSize({}, props);\n      this.props = props;\n    }\n  }, {\n    key: \"_update\",\n    value: function _update(oldProps, newProps) {\n      if (!this._map) {\n        return;\n      }\n      newProps = Object.assign({}, this.props, newProps);\n      checkPropTypes(newProps, 'Mapbox');\n      var viewportChanged = this._updateMapViewport(oldProps, newProps);\n      var sizeChanged = this._updateMapSize(oldProps, newProps);\n      this._updateMapStyle(oldProps, newProps);\n      if (!newProps.asyncRender && (viewportChanged || sizeChanged)) {\n        this.redraw();\n      }\n      this.props = newProps;\n    }\n  }, {\n    key: \"_updateMapStyle\",\n    value: function _updateMapStyle(oldProps, newProps) {\n      var styleChanged = oldProps.mapStyle !== newProps.mapStyle;\n      if (styleChanged) {\n        this._map.setStyle(normalizeStyle(newProps.mapStyle), {\n          diff: !newProps.preventStyleDiffing\n        });\n      }\n    }\n  }, {\n    key: \"_updateMapSize\",\n    value: function _updateMapSize(oldProps, newProps) {\n      var sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n      if (sizeChanged) {\n        this.width = newProps.width;\n        this.height = newProps.height;\n        this._map.resize();\n      }\n      return sizeChanged;\n    }\n  }, {\n    key: \"_updateMapViewport\",\n    value: function _updateMapViewport(oldProps, newProps) {\n      var oldViewState = this._getViewState(oldProps);\n      var newViewState = this._getViewState(newProps);\n      var viewportChanged = newViewState.latitude !== oldViewState.latitude || newViewState.longitude !== oldViewState.longitude || newViewState.zoom !== oldViewState.zoom || newViewState.pitch !== oldViewState.pitch || newViewState.bearing !== oldViewState.bearing || newViewState.altitude !== oldViewState.altitude;\n      if (viewportChanged) {\n        this._map.jumpTo(this._viewStateToMapboxProps(newViewState));\n        if (newViewState.altitude !== oldViewState.altitude) {\n          this._map.transform.altitude = newViewState.altitude;\n        }\n      }\n      return viewportChanged;\n    }\n  }, {\n    key: \"_getViewState\",\n    value: function _getViewState(props) {\n      var _ref = props.viewState || props,\n        longitude = _ref.longitude,\n        latitude = _ref.latitude,\n        zoom = _ref.zoom,\n        _ref$pitch = _ref.pitch,\n        pitch = _ref$pitch === void 0 ? 0 : _ref$pitch,\n        _ref$bearing = _ref.bearing,\n        bearing = _ref$bearing === void 0 ? 0 : _ref$bearing,\n        _ref$altitude = _ref.altitude,\n        altitude = _ref$altitude === void 0 ? 1.5 : _ref$altitude;\n      return {\n        longitude: longitude,\n        latitude: latitude,\n        zoom: zoom,\n        pitch: pitch,\n        bearing: bearing,\n        altitude: altitude\n      };\n    }\n  }, {\n    key: \"_checkStyleSheet\",\n    value: function _checkStyleSheet() {\n      var mapboxVersion = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '0.47.0';\n      if (typeof document === 'undefined') {\n        return;\n      }\n      try {\n        var testElement = document.createElement('div');\n        testElement.className = 'mapboxgl-map';\n        testElement.style.display = 'none';\n        document.body.appendChild(testElement);\n        var isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n        if (!isCssLoaded) {\n          var link = document.createElement('link');\n          link.setAttribute('rel', 'stylesheet');\n          link.setAttribute('type', 'text/css');\n          link.setAttribute('href', \"https://api.tiles.mapbox.com/mapbox-gl-js/v\".concat(mapboxVersion, \"/mapbox-gl.css\"));\n          document.head.appendChild(link);\n        }\n      } catch (error) {}\n    }\n  }, {\n    key: \"_viewStateToMapboxProps\",\n    value: function _viewStateToMapboxProps(viewState) {\n      return {\n        center: [viewState.longitude, viewState.latitude],\n        zoom: viewState.zoom,\n        bearing: viewState.bearing,\n        pitch: viewState.pitch\n      };\n    }\n  }]);\n  return Mapbox;\n}();\n_defineProperty(Mapbox, \"initialized\", false);\n_defineProperty(Mapbox, \"propTypes\", propTypes);\n_defineProperty(Mapbox, \"defaultProps\", defaultProps);\n_defineProperty(Mapbox, \"savedMap\", null);\nexport { Mapbox as default };","map":{"version":3,"sources":["../../../src/mapbox/mapbox.js"],"names":["PropTypes","document","normalizeStyle","noop","defaultOnError","event","console","error","propTypes","container","object","gl","mapboxApiAccessToken","string","mapboxApiUrl","attributionControl","bool","preserveDrawingBuffer","reuseMaps","transformRequest","func","mapOptions","mapStyle","oneOfType","preventStyleDiffing","visible","asyncRender","onLoad","onError","width","number","height","viewState","longitude","latitude","zoom","bearing","pitch","altitude","defaultProps","body","getAccessToken","accessToken","window","location","match","search","process","env","MapboxAccessToken","REACT_APP_MAPBOX_ACCESS_TOKEN","checkPropTypes","props","component","debug","Mapbox","mapboxgl","Error","initialized","_checkStyleSheet","version","_initialize","_destroy","_update","map","_map","style","_frame","cancel","_render","type","target","savedMap","oldContainer","getContainer","newContainer","classList","add","childNodes","length","appendChild","_container","setStyle","diff","isStyleLoaded","_fireLoadEvent","once","_reuse","getContext","HTMLCanvasElement","prototype","center","maxZoom","interactive","trackResize","Map","Object","assign","on","_handleError","off","remove","baseApiUrl","_create","defineProperty","configurable","get","canvas","getCanvas","outline","_updateMapViewport","_updateMapSize","oldProps","newProps","viewportChanged","sizeChanged","_updateMapStyle","redraw","styleChanged","resize","oldViewState","_getViewState","newViewState","jumpTo","_viewStateToMapboxProps","transform","mapboxVersion","testElement","createElement","className","display","isCssLoaded","getComputedStyle","position","link","setAttribute","head"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* global window, process, HTMLCanvasElement */\nimport * as PropTypes from 'prop-types';\nimport {document} from '../utils/globals';\nimport {normalizeStyle} from '../utils/style-utils';\n\nfunction noop() {}\n\nfunction defaultOnError(event) {\n  if (event) {\n    console.error(event.error); // eslint-disable-line\n  }\n}\n\nconst propTypes = {\n  // Creation parameters\n  container: PropTypes.object /** The container to have the map. */,\n  gl: PropTypes.object /** External WebGLContext to use */,\n\n  mapboxApiAccessToken: PropTypes.string /** Mapbox API access token for Mapbox tiles/styles. */,\n  mapboxApiUrl: PropTypes.string,\n  attributionControl: PropTypes.bool /** Show attribution control or not. */,\n  preserveDrawingBuffer: PropTypes.bool /** Useful when you want to export the canvas as a PNG. */,\n  reuseMaps: PropTypes.bool,\n  transformRequest: PropTypes.func /** The transformRequest callback for the map */,\n  mapOptions: PropTypes.object /** Extra options to pass to Mapbox constructor. See #545. **/,\n  mapStyle: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.object\n  ]) /** The Mapbox style. A string url to a MapboxGL style */,\n  preventStyleDiffing:\n    PropTypes.bool /** There are known issues with style diffing. As stopgap, add option to prevent style diffing. */,\n\n  visible: PropTypes.bool /** Whether the map is visible */,\n  asyncRender: PropTypes.bool /** Whether mapbox should manage its own render cycle */,\n\n  onLoad: PropTypes.func /** The onLoad callback for the map */,\n  onError: PropTypes.func /** The onError callback for the map */,\n\n  // Map view state\n  width: PropTypes.number /** The width of the map. */,\n  height: PropTypes.number /** The height of the map. */,\n\n  viewState: PropTypes.object /** object containing lng/lat/zoom/bearing/pitch */,\n\n  longitude: PropTypes.number /** The longitude of the center of the map. */,\n  latitude: PropTypes.number /** The latitude of the center of the map. */,\n  zoom: PropTypes.number /** The tile zoom level of the map. */,\n  bearing: PropTypes.number /** Specify the bearing of the viewport */,\n  pitch: PropTypes.number /** Specify the pitch of the viewport */,\n  // Note: Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n  altitude: PropTypes.number /** Altitude of the viewport camera. Default 1.5 \"screen heights\" */\n};\n\nconst defaultProps = {\n  container: document.body,\n  mapboxApiAccessToken: getAccessToken(),\n  mapboxApiUrl: 'https://api.mapbox.com',\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  reuseMaps: false,\n  mapOptions: {},\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n  preventStyleDiffing: false,\n\n  visible: true,\n  asyncRender: false,\n\n  onLoad: noop,\n  onError: defaultOnError,\n\n  width: 0,\n  height: 0,\n  longitude: 0,\n  latitude: 0,\n  zoom: 0,\n  bearing: 0,\n  pitch: 0,\n  altitude: 1.5\n};\n\n// Try to get access token from URL, env, local storage or config\nexport function getAccessToken() {\n  let accessToken = null;\n\n  if (typeof window !== 'undefined' && window.location) {\n    const match = window.location.search.match(/access_token=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n\n  if (!accessToken && typeof process !== 'undefined') {\n    // Note: This depends on bundler plugins (e.g. webpack) importing environment correctly\n    accessToken =\n      accessToken || process.env.MapboxAccessToken || process.env.REACT_APP_MAPBOX_ACCESS_TOKEN; // eslint-disable-line\n  }\n\n  // Prevents mapbox from throwing\n  return accessToken || 'no-token';\n}\n\n// Helper function to merge defaultProps and check prop types\nfunction checkPropTypes(props, component = 'component') {\n  // TODO - check for production (unless done by prop types package?)\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\n\n// A small wrapper class for mapbox-gl\n// - Provides a prop style interface (that can be trivially used by a React wrapper)\n// - Makes sure mapbox doesn't crash under Node\n// - Handles map reuse (to work around Mapbox resource leak issues)\n// - Provides support for specifying tokens during development\n\nexport default class Mapbox {\n  static initialized = false;\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n  static savedMap = null;\n\n  constructor(props) {\n    if (!props.mapboxgl) {\n      throw new Error('Mapbox not available');\n    }\n\n    this.mapboxgl = props.mapboxgl;\n\n    if (!Mapbox.initialized) {\n      Mapbox.initialized = true;\n\n      // Version detection using babel plugin\n      // const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'untranspiled source';\n      // TODO - expose version for debug\n\n      this._checkStyleSheet(this.mapboxgl.version);\n    }\n\n    this._initialize(props);\n  }\n\n  props = defaultProps;\n  width = 0;\n  height = 0;\n\n  finalize() {\n    this._destroy();\n    return this;\n  }\n\n  setProps(props) {\n    this._update(this.props, props);\n    return this;\n  }\n\n  // Force redraw the map now. Typically resize() and jumpTo() is reflected in the next\n  // render cycle, which is managed by Mapbox's animation loop.\n  // This removes the synchronization issue caused by requestAnimationFrame.\n  redraw() {\n    const map = this._map;\n    // map._render will throw error if style does not exist\n    // https://github.com/mapbox/mapbox-gl-js/blob/fb9fc316da14e99ff4368f3e4faa3888fb43c513\n    //   /src/ui/map.js#L1834\n    if (map.style) {\n      // cancel the scheduled update\n      if (map._frame) {\n        map._frame.cancel();\n        map._frame = null;\n      }\n      // the order is important - render() may schedule another update\n      map._render();\n    }\n  }\n\n  // External apps can access map this way\n  getMap() {\n    return this._map;\n  }\n\n  // PRIVATE API\n  _fireLoadEvent = () => {\n    // @ts-ignore\n    this.props.onLoad({\n      type: 'load',\n      target: this._map\n    });\n  };\n\n  _handleError = event => {\n    // @ts-ignore\n    this.props.onError(event);\n  };\n\n  _reuse(props) {\n    this._map = Mapbox.savedMap;\n    // When reusing the saved map, we need to reparent the map(canvas) and other child nodes\n    // intoto the new container from the props.\n    // Step1: reparenting child nodes from old container to new container\n    const oldContainer = this._map.getContainer();\n    const newContainer = props.container;\n    newContainer.classList.add('mapboxgl-map');\n    while (oldContainer.childNodes.length > 0) {\n      newContainer.appendChild(oldContainer.childNodes[0]);\n    }\n    // Step2: replace the internal container with new container from the react component\n    this._map._container = newContainer;\n    Mapbox.savedMap = null;\n\n    // Step3: update style and call onload again\n    if (props.mapStyle) {\n      this._map.setStyle(normalizeStyle(props.mapStyle), {\n        // From the user's perspective, there's no \"diffing\" on initialization\n        // We always rebuild the style from scratch when creating a new Mapbox instance\n        diff: false\n      });\n    }\n\n    // call onload event handler after style fully loaded when style needs update\n    if (this._map.isStyleLoaded()) {\n      this._fireLoadEvent();\n    } else {\n      this._map.once('styledata', this._fireLoadEvent);\n    }\n  }\n\n  _create(props) {\n    // Reuse a saved map, if available\n    if (props.reuseMaps && Mapbox.savedMap) {\n      this._reuse(props);\n    } else {\n      if (props.gl) {\n        const getContext = HTMLCanvasElement.prototype.getContext;\n        // Hijack canvas.getContext to return our own WebGLContext\n        // This will be called inside the mapboxgl.Map constructor\n        HTMLCanvasElement.prototype.getContext = () => {\n          // Unhijack immediately\n          HTMLCanvasElement.prototype.getContext = getContext;\n          return props.gl;\n        };\n      }\n\n      const mapOptions = {\n        container: props.container,\n        center: [0, 0],\n        zoom: 8,\n        pitch: 0,\n        bearing: 0,\n        maxZoom: 24,\n        style: normalizeStyle(props.mapStyle),\n        interactive: false,\n        trackResize: false,\n        attributionControl: props.attributionControl,\n        preserveDrawingBuffer: props.preserveDrawingBuffer\n      };\n      // We don't want to pass a null or no-op transformRequest function.\n      if (props.transformRequest) {\n        mapOptions.transformRequest = props.transformRequest;\n      }\n      this._map = new this.mapboxgl.Map(Object.assign({}, mapOptions, props.mapOptions));\n\n      // Attach optional onLoad function\n      this._map.once('load', this._fireLoadEvent);\n      this._map.on('error', this._handleError);\n    }\n\n    return this;\n  }\n\n  _destroy() {\n    if (!this._map) {\n      return;\n    }\n\n    if (this.props.reuseMaps && !Mapbox.savedMap) {\n      Mapbox.savedMap = this._map;\n\n      // deregister the mapbox event listeners\n      this._map.off('load', this._fireLoadEvent);\n      this._map.off('error', this._handleError);\n      this._map.off('styledata', this._fireLoadEvent);\n    } else {\n      this._map.remove();\n    }\n\n    this._map = null;\n  }\n\n  _initialize(props) {\n    props = Object.assign({}, defaultProps, props);\n    checkPropTypes(props, 'Mapbox');\n\n    // Creation only props\n    this.mapboxgl.accessToken = props.mapboxApiAccessToken || defaultProps.mapboxApiAccessToken;\n    this.mapboxgl.baseApiUrl = props.mapboxApiUrl;\n\n    this._create(props);\n\n    // Hijack dimension properties\n    // This eliminates the timing issue between calling resize() and DOM update\n    /* eslint-disable accessor-pairs */\n    const {container} = props;\n    Object.defineProperty(container, 'offsetWidth', {\n      configurable: true,\n      get: () => this.width\n    });\n    Object.defineProperty(container, 'clientWidth', {\n      configurable: true,\n      get: () => this.width\n    });\n    Object.defineProperty(container, 'offsetHeight', {\n      configurable: true,\n      get: () => this.height\n    });\n    Object.defineProperty(container, 'clientHeight', {\n      configurable: true,\n      get: () => this.height\n    });\n\n    // Disable outline style\n    const canvas = this._map.getCanvas();\n    if (canvas) {\n      canvas.style.outline = 'none';\n    }\n\n    this._updateMapViewport({}, props);\n    this._updateMapSize({}, props);\n\n    this.props = props;\n  }\n\n  _update(oldProps, newProps) {\n    if (!this._map) {\n      return;\n    }\n\n    newProps = Object.assign({}, this.props, newProps);\n    checkPropTypes(newProps, 'Mapbox');\n\n    const viewportChanged = this._updateMapViewport(oldProps, newProps);\n    const sizeChanged = this._updateMapSize(oldProps, newProps);\n    this._updateMapStyle(oldProps, newProps);\n\n    if (!newProps.asyncRender && (viewportChanged || sizeChanged)) {\n      this.redraw();\n    }\n\n    this.props = newProps;\n  }\n\n  _updateMapStyle(oldProps, newProps) {\n    const styleChanged = oldProps.mapStyle !== newProps.mapStyle;\n    if (styleChanged) {\n      this._map.setStyle(normalizeStyle(newProps.mapStyle), {\n        diff: !newProps.preventStyleDiffing\n      });\n    }\n  }\n\n  // Note: needs to be called after render (e.g. in componentDidUpdate)\n  _updateMapSize(oldProps, newProps) {\n    const sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n    if (sizeChanged) {\n      this.width = newProps.width;\n      this.height = newProps.height;\n      this._map.resize();\n    }\n    return sizeChanged;\n  }\n\n  _updateMapViewport(oldProps, newProps) {\n    const oldViewState = this._getViewState(oldProps);\n    const newViewState = this._getViewState(newProps);\n\n    const viewportChanged =\n      newViewState.latitude !== oldViewState.latitude ||\n      newViewState.longitude !== oldViewState.longitude ||\n      newViewState.zoom !== oldViewState.zoom ||\n      newViewState.pitch !== oldViewState.pitch ||\n      newViewState.bearing !== oldViewState.bearing ||\n      newViewState.altitude !== oldViewState.altitude;\n\n    if (viewportChanged) {\n      this._map.jumpTo(this._viewStateToMapboxProps(newViewState));\n\n      // TODO - jumpTo doesn't handle altitude\n      if (newViewState.altitude !== oldViewState.altitude) {\n        this._map.transform.altitude = newViewState.altitude;\n      }\n    }\n    return viewportChanged;\n  }\n\n  _getViewState(props) {\n    const {longitude, latitude, zoom, pitch = 0, bearing = 0, altitude = 1.5} =\n      props.viewState || props;\n    return {longitude, latitude, zoom, pitch, bearing, altitude};\n  }\n\n  _checkStyleSheet(mapboxVersion = '0.47.0') {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // check mapbox styles\n    try {\n      const testElement = document.createElement('div');\n      testElement.className = 'mapboxgl-map';\n      testElement.style.display = 'none';\n      document.body.appendChild(testElement);\n      const isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n\n      if (!isCssLoaded) {\n        // attempt to insert mapbox stylesheet\n        const link = document.createElement('link');\n        link.setAttribute('rel', 'stylesheet');\n        link.setAttribute('type', 'text/css');\n        link.setAttribute(\n          'href',\n          `https://api.tiles.mapbox.com/mapbox-gl-js/v${mapboxVersion}/mapbox-gl.css`\n        );\n        document.head.appendChild(link);\n      }\n    } catch (error) {\n      // do nothing\n    }\n  }\n\n  _viewStateToMapboxProps(viewState) {\n    return {\n      center: [viewState.longitude, viewState.latitude],\n      zoom: viewState.zoom,\n      bearing: viewState.bearing,\n      pitch: viewState.pitch\n    };\n  }\n}\n"]},"metadata":{},"sourceType":"module"}