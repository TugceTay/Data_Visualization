{"ast":null,"code":"var SVG_DATA_URL_PATTERN = /^data:image\\/svg\\+xml/;\nvar SVG_URL_PATTERN = /\\.svg((\\?|#).*)?$/;\nexport function isSVG(url) {\n  return url && (SVG_DATA_URL_PATTERN.test(url) || SVG_URL_PATTERN.test(url));\n}\nexport function getBlobOrSVGDataUrl(arrayBuffer, url) {\n  if (isSVG(url)) {\n    var textDecoder = new TextDecoder();\n    var xmlText = textDecoder.decode(arrayBuffer);\n    var src = \"data:image/svg+xml;base64,\".concat(btoa(xmlText));\n    return src;\n  }\n  return getBlob(arrayBuffer, url);\n}\nexport function getBlob(arrayBuffer, url) {\n  if (isSVG(url)) {\n    throw new Error('SVG cannot be parsed directly to imagebitmap');\n  }\n  return new Blob([new Uint8Array(arrayBuffer)]);\n}","map":{"version":3,"sources":["../../../../src/lib/parsers/svg-utils.js"],"names":["SVG_DATA_URL_PATTERN","SVG_URL_PATTERN","isSVG","url","test","getBlobOrSVGDataUrl","arrayBuffer","textDecoder","TextDecoder","xmlText","decode","src","btoa","getBlob","Error","Blob","Uint8Array"],"mappings":"AAIA,IAAMA,oBAAoB,GAAG,uBAA7B;AACA,IAAMC,eAAe,GAAG,mBAAxB;AAEA,OAAO,SAASC,KAAT,CAAeC,GAAf,EAAoB;EACzB,OAAOA,GAAG,KAAKH,oBAAoB,CAACI,IAArBJ,CAA0BG,GAA1BH,CAAAA,IAAkCC,eAAe,CAACG,IAAhBH,CAAqBE,GAArBF,CAAvC,CAAV;AACD;AAED,OAAO,SAASI,mBAAT,CAA6BC,WAA7B,EAA0CH,GAA1C,EAA+C;EACpD,IAAID,KAAK,CAACC,GAAD,CAAT,EAAgB;IAEd,IAAMI,WAAW,GAAG,IAAIC,WAAJ,EAApB;IACA,IAAMC,OAAO,GAAGF,WAAW,CAACG,MAAZH,CAAmBD,WAAnBC,CAAhB;IAMA,IAAMI,GAAG,GAAA,4BAAA,CAAA,MAAA,CAAgCC,IAAI,CAACH,OAAD,CAApC,CAAT;IACA,OAAOE,GAAP;EACD;EACD,OAAOE,OAAO,CAACP,WAAD,EAAcH,GAAd,CAAd;AACD;AAED,OAAO,SAASU,OAAT,CAAiBP,WAAjB,EAA8BH,GAA9B,EAAmC;EACxC,IAAID,KAAK,CAACC,GAAD,CAAT,EAAgB;IAGd,MAAM,IAAIW,KAAJ,CAAU,8CAAV,CAAN;EACD;EAED,OAAO,IAAIC,IAAJ,CAAS,CAAC,IAAIC,UAAJ,CAAeV,WAAf,CAAD,CAAT,CAAP;AACD","sourcesContent":["/* global TextDecoder, Blob, btoa */\n// SVG parsing has limitations, e.g:\n// https://bugs.chromium.org/p/chromium/issues/detail?id=606319\n\nconst SVG_DATA_URL_PATTERN = /^data:image\\/svg\\+xml/;\nconst SVG_URL_PATTERN = /\\.svg((\\?|#).*)?$/;\n\nexport function isSVG(url) {\n  return url && (SVG_DATA_URL_PATTERN.test(url) || SVG_URL_PATTERN.test(url));\n}\n\nexport function getBlobOrSVGDataUrl(arrayBuffer, url) {\n  if (isSVG(url)) {\n    // Prepare a properly tagged data URL, and load using normal mechanism\n    const textDecoder = new TextDecoder();\n    const xmlText = textDecoder.decode(arrayBuffer);\n    // TODO Escape in browser to support e.g. Chinese characters\n    // if (typeof unescape === 'function' && typeof encodeURLComponent === 'function') {\n    //   xmlText = unescape(encodeURLComponent(xmlText));\n    // }\n    // base64 encoding is safer. utf-8 fails in some browsers\n    const src = `data:image/svg+xml;base64,${btoa(xmlText)}`;\n    return src;\n  }\n  return getBlob(arrayBuffer, url);\n}\n\nexport function getBlob(arrayBuffer, url) {\n  if (isSVG(url)) {\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=606319\n    // return new Blob([new Uint8Array(arrayBuffer)], {type: 'image/svg+xml'});\n    throw new Error('SVG cannot be parsed directly to imagebitmap');\n  }\n  // TODO - how to determine mime type? Param? Sniff here?\n  return new Blob([new Uint8Array(arrayBuffer)]); // MIME type not needed?\n}\n"]},"metadata":{},"sourceType":"module"}