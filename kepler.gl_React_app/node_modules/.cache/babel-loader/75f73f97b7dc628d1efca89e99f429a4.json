{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\nvar _styledComponents = _interopRequireWildcard(require(\"styled-components\"));\nvar _d3Selection = require(\"d3-selection\");\nvar _d3Brush = require(\"d3-brush\");\nvar _dataUtils = require(\"../../utils/data-utils\");\nvar _templateObject;\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nvar StyledG = _styledComponents[\"default\"].g(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  .selection {\\n    stroke: none;\\n    fill: \", \";\\n    fill-opacity: \", \";\\n  }\\n  .handle {\\n    fill: \", \";\\n    fill-opacity: 0.3;\\n  }\\n\"])), function (props) {\n  return props.isRanged ? props.theme.rangeBrushBgd : props.theme.BLUE2;\n}, function (props) {\n  return props.isRanged ? 0.3 : 1;\n}, function (props) {\n  return props.theme.BLUE2;\n});\nfunction moveRight(startSel, selection) {\n  var _startSel = (0, _slicedToArray2[\"default\"])(startSel, 1),\n    startSel0 = _startSel[0];\n  var _selection = (0, _slicedToArray2[\"default\"])(selection, 1),\n    sel0 = _selection[0];\n  return Boolean(startSel0 === sel0);\n} // style brush resize handle\n// https://github.com/crossfilter/crossfilter/blob/gh-pages/index.html#L466\n\nvar getHandlePath = function getHandlePath(props) {\n  return function brushResizePath(d) {\n    var e = Number(d.type === 'e');\n    var x = e ? 1 : -1;\n    var h = 39;\n    var w = 4.5;\n    var y = (props.height - h) / 2;\n    return \"M\".concat(0.5 * x, \",\").concat(y, \"c\").concat(2.5 * x, \",0,\").concat(w * x, \",2,\").concat(w * x, \",\").concat(w, \"v\").concat(h - w * 2, \"c0,2.5,\").concat(-2 * x, \",\").concat(w, \",\").concat(-w * x, \",\").concat(w, \"V\").concat(y, \"z\");\n  };\n};\nfunction RangeBrushFactory() {\n  var RangeBrush = /*#__PURE__*/function (_Component) {\n    (0, _inherits2[\"default\"])(RangeBrush, _Component);\n    var _super = _createSuper(RangeBrush);\n    function RangeBrush() {\n      var _this;\n      (0, _classCallCheck2[\"default\"])(this, RangeBrush);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"rootContainer\", /*#__PURE__*/(0, _react.createRef)());\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_brushed\", function (evt) {\n        var _this2;\n\n        // Ignore brush events which don't have an underlying sourceEvent\n        if (!evt.sourceEvent) return;\n        var _evt$selection = (0, _slicedToArray2[\"default\"])(evt.selection, 2),\n          sel0 = _evt$selection[0],\n          sel1 = _evt$selection[1];\n        var right = moveRight(_this._startSel, evt.selection);\n        var _this$props = _this.props,\n          _this$props$range = (0, _slicedToArray2[\"default\"])(_this$props.range, 2),\n          min = _this$props$range[0],\n          max = _this$props$range[1],\n          step = _this$props.step,\n          width = _this$props.width,\n          marks = _this$props.marks,\n          isRanged = _this$props.isRanged;\n        var invert = function invert(x) {\n          return x * (max - min) / width + min;\n        };\n        var d0 = invert(sel0);\n        var d1 = invert(sel1);\n        d0 = (0, _dataUtils.normalizeSliderValue)(d0, min, step, marks);\n        d1 = (0, _dataUtils.normalizeSliderValue)(d1, min, step, marks);\n        if (isRanged) _this._move(d0, d1);else (_this2 = _this)._move.apply(_this2, (0, _toConsumableArray2[\"default\"])(right ? [d1, d1] : [d0, d0]));\n        if (isRanged) _this._onBrush(d0, d1);else _this._onBrush(right ? d1 : d0);\n      });\n      return _this;\n    }\n    (0, _createClass2[\"default\"])(RangeBrush, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        var _this3 = this;\n\n        // We want the React app to respond to brush state and vice-versa\n        // but d3-brush fires the same events for both user-initiated brushing\n        // and programmatic brushing (brush.move). We need these flags to\n        // distinguish between the uses.\n        //\n        // We don't use state because that would trigger another `componentDidUpdate`\n        var _this$props2 = this.props,\n          theme = _this$props2.theme,\n          isRanged = _this$props2.isRanged,\n          onMouseoverHandle = _this$props2.onMouseoverHandle,\n          onMouseoutHandle = _this$props2.onMouseoutHandle;\n        this.brushing = false;\n        this.moving = false;\n        this.root = (0, _d3Selection.select)(this.rootContainer.current);\n        this.brush = (0, _d3Brush.brushX)().handleSize(3).on('start', function (event) {\n          if (typeof _this3.props.onBrushStart === 'function') _this3.props.onBrushStart();\n          _this3._startSel = event.selection;\n        }).on('brush', function (event) {\n          if (_this3.moving) {\n            return;\n          }\n          if (event.selection) {\n            _this3._lastSel = event.selection;\n            _this3.brushing = true;\n            _this3._brushed(event);\n          }\n        }).on('end', function (event) {\n          if (!event.selection) {\n            if (_this3.brushing) {\n              // handle null selection\n              _this3._click(_this3._lastSel);\n            } else if (_this3._startSel) {\n              // handle click\n              _this3._click(_this3._startSel);\n            }\n          }\n          if (typeof _this3.props.onBrushEnd === 'function') _this3.props.onBrushEnd();\n          _this3.brushing = false;\n          _this3.moving = false;\n        });\n        this.root.call(this.brush);\n        var brushResizePath = getHandlePath(this.props);\n        this.handle = this.root.selectAll('.handle--custom').data([{\n          type: 'w'\n        }, {\n          type: 'e'\n        }]).enter().append('path').attr('class', 'handle--custom').attr('display', isRanged ? null : 'none').attr('fill', theme ? theme.sliderHandleColor : '#D3D8E0').attr('cursor', 'ew-resize').attr('d', brushResizePath).on('mouseover', function () {\n          if (onMouseoverHandle) onMouseoverHandle();\n        }).on('mouseout', function () {\n          if (onMouseoutHandle) onMouseoutHandle();\n        });\n        var _this$props$value = (0, _slicedToArray2[\"default\"])(this.props.value, 2),\n          val0 = _this$props$value[0],\n          val1 = _this$props$value[1];\n        this.moving = true;\n        this._move(val0, val1);\n      }\n    }, {\n      key: \"componentDidUpdate\",\n      value: function componentDidUpdate(prevProps) {\n        var _this$props3 = this.props,\n          _this$props3$value = (0, _slicedToArray2[\"default\"])(_this$props3.value, 2),\n          val0 = _this$props3$value[0],\n          val1 = _this$props3$value[1],\n          width = _this$props3.width;\n        var _prevProps$value = (0, _slicedToArray2[\"default\"])(prevProps.value, 2),\n          prevVal0 = _prevProps$value[0],\n          prevVal1 = _prevProps$value[1];\n        if (prevProps.width !== width) {\n          // width change should not trigger this._brushed\n          this.moving = true;\n          this.root.call(this.brush);\n          this._move(val0, val1);\n        }\n        if (!this.brushing && !this.moving) {\n          if (prevVal0 !== val0 || prevVal1 !== val1) {\n            this.moving = true;\n            this._move(val0, val1);\n          }\n        }\n        if (!this.props.isRanged) {\n          this.handle.attr('display', 'none');\n        }\n      }\n    }, {\n      key: \"_click\",\n      value: function _click(selection) {\n        // fake brush\n        this.brushing = true;\n        this._brushed({\n          sourceEvent: {},\n          selection: selection\n        });\n      }\n    }, {\n      key: \"_move\",\n      value: function _move(val0, val1) {\n        var _this$props4 = this.props,\n          _this$props4$range = (0, _slicedToArray2[\"default\"])(_this$props4.range, 2),\n          min = _this$props4$range[0],\n          max = _this$props4$range[1],\n          width = _this$props4.width,\n          isRanged = _this$props4.isRanged;\n        if (width && max - min) {\n          var scale = function scale(x) {\n            return (x - min) * width / (max - min);\n          };\n          if (!isRanged) {\n            // only draw a 1 pixel line\n            this.brush.move(this.root, [scale(val0), scale(val0) + 1]);\n          } else {\n            this.brush.move(this.root, [scale(val0), scale(val1)]);\n            this.handle.attr('display', null).attr('transform', function (d, i) {\n              return \"translate(\".concat([i === 0 ? scale(val0) : scale(val1), 0], \")\");\n            });\n          }\n        }\n      }\n    }, {\n      key: \"_onBrush\",\n      value: function _onBrush(val0, val1) {\n        var _this$props5 = this.props,\n          isRanged = _this$props5.isRanged,\n          _this$props5$value = (0, _slicedToArray2[\"default\"])(_this$props5.value, 2),\n          currentVal0 = _this$props5$value[0],\n          currentVal1 = _this$props5$value[1];\n        if (currentVal0 === val0 && currentVal1 === val1) {\n          return;\n        }\n        if (isRanged) {\n          this.props.onBrush(val0, val1);\n        } else {\n          this.props.onBrush(val0, val0);\n        }\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var isRanged = this.props.isRanged;\n        return /*#__PURE__*/_react[\"default\"].createElement(StyledG, {\n          className: \"kg-range-slider__brush\",\n          isRanged: isRanged,\n          ref: this.rootContainer\n        });\n      }\n    }]);\n    return RangeBrush;\n  }(_react.Component);\n  (0, _defineProperty2[\"default\"])(RangeBrush, \"propTypes\", {\n    onBrush: _propTypes[\"default\"].func.isRequired,\n    range: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].number).isRequired,\n    value: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].number).isRequired,\n    width: _propTypes[\"default\"].number.isRequired,\n    isRanged: _propTypes[\"default\"].bool\n  });\n  (0, _defineProperty2[\"default\"])(RangeBrush, \"defaultProps\", {\n    isRanged: true\n  });\n  return (0, _styledComponents.withTheme)(RangeBrush);\n}\nvar _default = RangeBrushFactory;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../../src/components/common/range-brush.js"],"names":["StyledG","styled","g","props","isRanged","theme","rangeBrushBgd","BLUE2","moveRight","startSel","selection","startSel0","sel0","Boolean","getHandlePath","brushResizePath","d","e","Number","type","x","h","w","y","height","RangeBrushFactory","RangeBrush","Component","onBrush","PropTypes","func","isRequired","range","arrayOf","number","value","width","bool","onMouseoverHandle","onMouseoutHandle","brushing","moving","root","rootContainer","current","brush","handleSize","on","onBrushStart","_startSel","event","_lastSel","_brushed","_click","onBrushEnd","call","handle","selectAll","data","enter","append","attr","sliderHandleColor","val0","val1","_move","prevProps","prevVal0","prevVal1","sourceEvent","min","max","scale","move","i","evt","sel1","right","step","marks","invert","d0","d1","_onBrush","currentVal0","currentVal1"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {Component, createRef} from 'react';\nimport PropTypes from 'prop-types';\nimport styled, {withTheme} from 'styled-components';\nimport {select} from 'd3-selection';\nimport {brushX} from 'd3-brush';\nimport {normalizeSliderValue} from 'utils/data-utils';\n\nconst StyledG = styled.g`\n  .selection {\n    stroke: none;\n    fill: ${props => (props.isRanged ? props.theme.rangeBrushBgd : props.theme.BLUE2)};\n    fill-opacity: ${props => (props.isRanged ? 0.3 : 1)};\n  }\n  .handle {\n    fill: ${props => props.theme.BLUE2};\n    fill-opacity: 0.3;\n  }\n`;\n\nfunction moveRight(startSel, selection) {\n  const [startSel0] = startSel;\n  const [sel0] = selection;\n\n  return Boolean(startSel0 === sel0);\n}\n// style brush resize handle\n// https://github.com/crossfilter/crossfilter/blob/gh-pages/index.html#L466\nconst getHandlePath = props => {\n  return function brushResizePath(d) {\n    const e = Number(d.type === 'e');\n    const x = e ? 1 : -1;\n    const h = 39;\n    const w = 4.5;\n    const y = (props.height - h) / 2;\n    return `M${0.5 * x},${y}c${2.5 * x},0,${w * x},2,${w * x},${w}v${h - w * 2}c0,2.5,${-2 *\n      x},${w},${-w * x},${w}V${y}z`;\n  };\n};\n\nfunction RangeBrushFactory() {\n  class RangeBrush extends Component {\n    static propTypes = {\n      onBrush: PropTypes.func.isRequired,\n      range: PropTypes.arrayOf(PropTypes.number).isRequired,\n      value: PropTypes.arrayOf(PropTypes.number).isRequired,\n      width: PropTypes.number.isRequired,\n      isRanged: PropTypes.bool\n    };\n\n    static defaultProps = {\n      isRanged: true\n    };\n\n    componentDidMount() {\n      // We want the React app to respond to brush state and vice-versa\n      // but d3-brush fires the same events for both user-initiated brushing\n      // and programmatic brushing (brush.move). We need these flags to\n      // distinguish between the uses.\n      //\n      // We don't use state because that would trigger another `componentDidUpdate`\n      const {theme, isRanged, onMouseoverHandle, onMouseoutHandle} = this.props;\n\n      this.brushing = false;\n      this.moving = false;\n\n      this.root = select(this.rootContainer.current);\n      this.brush = brushX()\n        .handleSize(3)\n        .on('start', event => {\n          if (typeof this.props.onBrushStart === 'function') this.props.onBrushStart();\n          this._startSel = event.selection;\n        })\n        .on('brush', event => {\n          if (this.moving) {\n            return;\n          }\n          if (event.selection) {\n            this._lastSel = event.selection;\n            this.brushing = true;\n            this._brushed(event);\n          }\n        })\n        .on('end', event => {\n          if (!event.selection) {\n            if (this.brushing) {\n              // handle null selection\n              this._click(this._lastSel);\n            } else if (this._startSel) {\n              // handle click\n              this._click(this._startSel);\n            }\n          }\n\n          if (typeof this.props.onBrushEnd === 'function') this.props.onBrushEnd();\n\n          this.brushing = false;\n          this.moving = false;\n        });\n\n      this.root.call(this.brush);\n      const brushResizePath = getHandlePath(this.props);\n      this.handle = this.root\n        .selectAll('.handle--custom')\n        .data([{type: 'w'}, {type: 'e'}])\n        .enter()\n        .append('path')\n        .attr('class', 'handle--custom')\n        .attr('display', isRanged ? null : 'none')\n        .attr('fill', theme ? theme.sliderHandleColor : '#D3D8E0')\n        .attr('cursor', 'ew-resize')\n        .attr('d', brushResizePath)\n        .on('mouseover', () => {\n          if (onMouseoverHandle) onMouseoverHandle();\n        })\n        .on('mouseout', () => {\n          if (onMouseoutHandle) onMouseoutHandle();\n        });\n\n      const {\n        value: [val0, val1]\n      } = this.props;\n      this.moving = true;\n      this._move(val0, val1);\n    }\n\n    componentDidUpdate(prevProps) {\n      const {\n        value: [val0, val1],\n        width\n      } = this.props;\n      const [prevVal0, prevVal1] = prevProps.value;\n\n      if (prevProps.width !== width) {\n        // width change should not trigger this._brushed\n        this.moving = true;\n        this.root.call(this.brush);\n        this._move(val0, val1);\n      }\n\n      if (!this.brushing && !this.moving) {\n        if (prevVal0 !== val0 || prevVal1 !== val1) {\n          this.moving = true;\n          this._move(val0, val1);\n        }\n      }\n\n      if (!this.props.isRanged) {\n        this.handle.attr('display', 'none');\n      }\n    }\n\n    rootContainer = createRef();\n\n    _click(selection) {\n      // fake brush\n      this.brushing = true;\n      this._brushed({sourceEvent: {}, selection});\n    }\n\n    _move(val0, val1) {\n      const {\n        range: [min, max],\n        width,\n        isRanged\n      } = this.props;\n\n      if (width && max - min) {\n        const scale = x => ((x - min) * width) / (max - min);\n        if (!isRanged) {\n          // only draw a 1 pixel line\n          this.brush.move(this.root, [scale(val0), scale(val0) + 1]);\n        } else {\n          this.brush.move(this.root, [scale(val0), scale(val1)]);\n\n          this.handle\n            .attr('display', null)\n            .attr('transform', (d, i) => `translate(${[i === 0 ? scale(val0) : scale(val1), 0]})`);\n        }\n      }\n    }\n\n    _brushed = evt => {\n      // Ignore brush events which don't have an underlying sourceEvent\n      if (!evt.sourceEvent) return;\n      const [sel0, sel1] = evt.selection;\n      const right = moveRight(this._startSel, evt.selection);\n\n      const {\n        range: [min, max],\n        step,\n        width,\n        marks,\n        isRanged\n      } = this.props;\n      const invert = x => (x * (max - min)) / width + min;\n      let d0 = invert(sel0);\n      let d1 = invert(sel1);\n\n      d0 = normalizeSliderValue(d0, min, step, marks);\n      d1 = normalizeSliderValue(d1, min, step, marks);\n\n      if (isRanged) this._move(d0, d1);\n      else this._move(...(right ? [d1, d1] : [d0, d0]));\n\n      if (isRanged) this._onBrush(d0, d1);\n      else this._onBrush(right ? d1 : d0);\n    };\n\n    _onBrush(val0, val1) {\n      const {\n        isRanged,\n        value: [currentVal0, currentVal1]\n      } = this.props;\n\n      if (currentVal0 === val0 && currentVal1 === val1) {\n        return;\n      }\n\n      if (isRanged) {\n        this.props.onBrush(val0, val1);\n      } else {\n        this.props.onBrush(val0, val0);\n      }\n    }\n\n    render() {\n      const {isRanged} = this.props;\n      return (\n        <StyledG className=\"kg-range-slider__brush\" isRanged={isRanged} ref={this.rootContainer} />\n      );\n    }\n  }\n  return withTheme(RangeBrush);\n}\n\nexport default RangeBrushFactory;\n"]},"metadata":{},"sourceType":"script"}