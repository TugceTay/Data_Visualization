{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.getChildPos = void 0;\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _lodash = _interopRequireDefault(require(\"lodash.debounce\"));\nvar _lodash2 = _interopRequireDefault(require(\"lodash.isequal\"));\nvar _exenv = require(\"exenv\");\nvar _styledComponents = require(\"styled-components\");\nvar _context = require(\"../context\");\nvar _reactModal = _interopRequireDefault(require(\"react-modal\"));\nvar _window = _interopRequireDefault(require(\"global/window\"));\nvar _base = require(\"../../styles/base\");\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nvar listeners = {};\nvar startListening = function startListening() {\n  return Object.keys(listeners).forEach(function (key) {\n    return listeners[key]();\n  });\n};\nvar getPageOffset = function getPageOffset() {\n  return {\n    x: _window[\"default\"].pageXOffset !== undefined ? _window[\"default\"].pageXOffset : (document.documentElement || document.body.parentNode || document.body).scrollLeft,\n    y: _window[\"default\"].pageYOffset !== undefined ? _window[\"default\"].pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop\n  };\n};\nvar addEventListeners = function addEventListeners() {\n  if (document && document.body) document.body.addEventListener('mousewheel', (0, _lodash[\"default\"])(startListening, 100, true));\n  _window[\"default\"].addEventListener('resize', (0, _lodash[\"default\"])(startListening, 50, true));\n};\nvar getChildPos = function getChildPos(_ref) {\n  var offsets = _ref.offsets,\n    rect = _ref.rect,\n    childRect = _ref.childRect,\n    pageOffset = _ref.pageOffset,\n    padding = _ref.padding;\n  var topOffset = offsets.topOffset,\n    leftOffset = offsets.leftOffset,\n    rightOffset = offsets.rightOffset;\n  var anchorLeft = leftOffset !== undefined;\n  var pos = _objectSpread({\n    top: pageOffset.y + rect.top + (topOffset || 0)\n  }, anchorLeft ? {\n    left: pageOffset.x + rect.left + leftOffset\n  } : {\n    right: _window[\"default\"].innerWidth - rect.right - pageOffset.x + (rightOffset || 0)\n  });\n  var leftOrRight = anchorLeft ? 'left' : 'right';\n  if (pos[leftOrRight] && pos[leftOrRight] < 0) {\n    pos[leftOrRight] = padding;\n  } else if (pos[leftOrRight] && pos[leftOrRight] + childRect.width > _window[\"default\"].innerWidth) {\n    pos[leftOrRight] = _window[\"default\"].innerWidth - childRect.width - padding;\n  }\n  if (pos.top < 0) {\n    pos.top = padding;\n  } else if (pos.top + childRect.height > _window[\"default\"].innerHeight) {\n    pos.top = _window[\"default\"].innerHeight - childRect.height - padding;\n  }\n  return pos;\n};\nexports.getChildPos = getChildPos;\nif (_exenv.canUseDOM) {\n  if (document.body) {\n    addEventListeners();\n  } else {\n    document.addEventListener('DOMContentLoaded', addEventListeners);\n  }\n}\nvar listenerIdCounter = 0;\nfunction subscribe(fn) {\n  listenerIdCounter += 1;\n  var id = listenerIdCounter;\n  listeners[id] = fn;\n  return function () {\n    return delete listeners[id];\n  };\n}\nvar defaultModalStyle = {\n  content: {\n    top: 0,\n    left: 0,\n    border: 0,\n    right: 'auto',\n    bottom: 'auto',\n    padding: '0px 0px 0px 0px'\n  },\n  overlay: {\n    right: 'auto',\n    bottom: 'auto',\n    width: '100vw',\n    height: '100vh',\n    backgroundColor: 'rgba(0, 0, 0, 0)'\n  }\n};\nvar WINDOW_PAD = 40;\nvar noop = function noop() {};\nvar Portaled = /*#__PURE__*/function (_Component) {\n  (0, _inherits2[\"default\"])(Portaled, _Component);\n  var _super = _createSuper(Portaled);\n  function Portaled() {\n    var _this;\n    (0, _classCallCheck2[\"default\"])(this, Portaled);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(args));\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"state\", {\n      pos: null,\n      isVisible: false\n    });\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"element\", /*#__PURE__*/(0, _react.createRef)());\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"child\", /*#__PURE__*/(0, _react.createRef)());\n    (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"handleScroll\", function () {\n      if (_this.child.current) {\n        var rect = _this.element.current.getBoundingClientRect();\n        var childRect = _this.child.current && _this.child.current.getBoundingClientRect();\n        var pageOffset = getPageOffset();\n        var _this$props = _this.props,\n          topOffset = _this$props.top,\n          leftOffset = _this$props.left,\n          rightOffset = _this$props.right;\n        var pos = getChildPos({\n          offsets: {\n            topOffset: topOffset,\n            leftOffset: leftOffset,\n            rightOffset: rightOffset\n          },\n          rect: rect,\n          childRect: childRect,\n          pageOffset: pageOffset,\n          padding: WINDOW_PAD\n        });\n        if (!(0, _lodash2[\"default\"])(pos, _this.state.pos)) {\n          _this.setState({\n            pos: pos\n          });\n        }\n      }\n    });\n    return _this;\n  }\n  (0, _createClass2[\"default\"])(Portaled, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // relative\n      this.unsubscribe = subscribe(this.handleScroll);\n      this.handleScroll();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this2 = this;\n      var didOpen = this.props.isOpened && !prevProps.isOpened;\n      var didClose = !this.props.isOpened && prevProps.isOpened;\n      if (didOpen || didClose) {\n        _window[\"default\"].requestAnimationFrame(function () {\n          if (_this2._unmounted) return;\n          _this2.setState({\n            isVisible: didOpen\n          });\n        });\n      }\n      this.handleScroll();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._unmounted = true; // @ts-ignore\n\n      this.unsubscribe();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n      var _this$props2 = this.props,\n        Comp = _this$props2.component,\n        overlayZIndex = _this$props2.overlayZIndex,\n        isOpened = _this$props2.isOpened,\n        onClose = _this$props2.onClose,\n        children = _this$props2.children,\n        modalProps = _this$props2.modalProps,\n        _this$props2$modalSty = _this$props2.modalStyle,\n        modalStyle = _this$props2$modalSty === void 0 ? {} : _this$props2$modalSty;\n      var _this$state = this.state,\n        isVisible = _this$state.isVisible,\n        pos = _this$state.pos;\n      var newModalStyle = _objectSpread(_objectSpread({}, defaultModalStyle), {}, {\n        content: _objectSpread({}, modalStyle.content || {}),\n        overlay: _objectSpread(_objectSpread(_objectSpread({}, defaultModalStyle.overlay), modalStyle.overlay || {}), {}, {\n          // needs to be on top of existing modal\n          zIndex: overlayZIndex || 9999\n        })\n      });\n      return /*#__PURE__*/_react[\"default\"].createElement(_context.RootContext.Consumer, null, function (context) {\n        return /*#__PURE__*/_react[\"default\"].createElement(Comp, {\n          ref: _this3.element\n        }, isOpened ? /*#__PURE__*/_react[\"default\"].createElement(_reactModal[\"default\"], (0, _extends2[\"default\"])({\n          className: \"modal-portal\"\n        }, modalProps, {\n          ariaHideApp: false,\n          isOpen: true,\n          style: newModalStyle,\n          parentSelector: function parentSelector() {\n            // React modal issue: https://github.com/reactjs/react-modal/issues/769\n            // failed to execute removeChild on parent node when it is already unmounted\n            return (\n              // @ts-ignore\n              context && context.current || {\n                removeChild: function removeChild() {},\n                appendChild: function appendChild() {}\n              }\n            );\n          },\n          onRequestClose: onClose\n        }), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n          className: \"portaled-content\",\n          key: \"item\",\n          style: _objectSpread({\n            position: 'fixed',\n            opacity: isVisible ? 1 : 0,\n            top: _this3.state.top,\n            transition: _this3.props.theme.transition,\n            marginTop: isVisible ? '0px' : '14px'\n          }, pos)\n        }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n          ref: _this3.child,\n          style: {\n            position: 'absolute',\n            zIndex: overlayZIndex ? overlayZIndex + 1 : 10000\n          }\n        }, children))) : null);\n      });\n    }\n  }]);\n  return Portaled;\n}(_react.Component);\n(0, _defineProperty2[\"default\"])(Portaled, \"defaultProps\", {\n  component: 'div',\n  onClose: noop,\n  theme: _base.theme\n});\nvar _default = (0, _styledComponents.withTheme)(Portaled);\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../../src/components/common/portaled.js"],"names":["listeners","startListening","keys","forEach","key","getPageOffset","x","window","pageXOffset","undefined","document","documentElement","body","parentNode","scrollLeft","y","pageYOffset","scrollTop","addEventListeners","addEventListener","getChildPos","offsets","rect","childRect","pageOffset","padding","topOffset","leftOffset","rightOffset","anchorLeft","pos","top","left","right","innerWidth","leftOrRight","width","height","innerHeight","canUseDOM","listenerIdCounter","subscribe","fn","id","defaultModalStyle","content","border","bottom","overlay","backgroundColor","WINDOW_PAD","noop","Portaled","Component","component","onClose","theme","isVisible","unsubscribe","handleScroll","prevProps","didOpen","props","isOpened","didClose","requestAnimationFrame","_unmounted","setState","child","current","element","getBoundingClientRect","state","Comp","overlayZIndex","children","modalProps","modalStyle","newModalStyle","zIndex","context","removeChild","appendChild","position","opacity","transition","marginTop"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {Component, createRef} from 'react';\nimport debounce from 'lodash.debounce';\nimport isEqual from 'lodash.isequal';\n\nimport {canUseDOM} from 'exenv';\nimport {withTheme} from 'styled-components';\nimport {RootContext} from 'components/context';\nimport Modal from 'react-modal';\nimport window from 'global/window';\nimport {theme} from 'styles/base';\n\nconst listeners = {};\n\nconst startListening = () => Object.keys(listeners).forEach(key => listeners[key]());\n\nconst getPageOffset = () => ({\n  x:\n    window.pageXOffset !== undefined\n      ? window.pageXOffset\n      : (document.documentElement || document.body.parentNode || document.body).scrollLeft,\n  y:\n    window.pageYOffset !== undefined\n      ? window.pageYOffset\n      : (document.documentElement || document.body.parentNode || document.body).scrollTop\n});\n\nconst addEventListeners = () => {\n  if (document && document.body)\n    document.body.addEventListener('mousewheel', debounce(startListening, 100, true));\n  window.addEventListener('resize', debounce(startListening, 50, true));\n};\n\nexport const getChildPos = ({offsets, rect, childRect, pageOffset, padding}) => {\n  const {topOffset, leftOffset, rightOffset} = offsets;\n\n  const anchorLeft = leftOffset !== undefined;\n  const pos = {\n    top: pageOffset.y + rect.top + (topOffset || 0),\n    ...(anchorLeft\n      ? {left: pageOffset.x + rect.left + leftOffset}\n      : {right: window.innerWidth - rect.right - pageOffset.x + (rightOffset || 0)})\n  };\n\n  const leftOrRight = anchorLeft ? 'left' : 'right';\n\n  if (pos[leftOrRight] && pos[leftOrRight] < 0) {\n    pos[leftOrRight] = padding;\n  } else if (pos[leftOrRight] && pos[leftOrRight] + childRect.width > window.innerWidth) {\n    pos[leftOrRight] = window.innerWidth - childRect.width - padding;\n  }\n\n  if (pos.top < 0) {\n    pos.top = padding;\n  } else if (pos.top + childRect.height > window.innerHeight) {\n    pos.top = window.innerHeight - childRect.height - padding;\n  }\n\n  return pos;\n};\n\nif (canUseDOM) {\n  if (document.body) {\n    addEventListeners();\n  } else {\n    document.addEventListener('DOMContentLoaded', addEventListeners);\n  }\n}\n\nlet listenerIdCounter = 0;\nfunction subscribe(fn) {\n  listenerIdCounter += 1;\n  const id = listenerIdCounter;\n  listeners[id] = fn;\n  return () => delete listeners[id];\n}\n\nconst defaultModalStyle = {\n  content: {\n    top: 0,\n    left: 0,\n    border: 0,\n    right: 'auto',\n    bottom: 'auto',\n    padding: '0px 0px 0px 0px'\n  },\n  overlay: {\n    right: 'auto',\n    bottom: 'auto',\n    width: '100vw',\n    height: '100vh',\n    backgroundColor: 'rgba(0, 0, 0, 0)'\n  }\n};\n\nconst WINDOW_PAD = 40;\n\nconst noop = () => {};\n\nclass Portaled extends Component {\n  static defaultProps = {\n    component: 'div',\n    onClose: noop,\n    theme\n  };\n\n  state = {\n    pos: null,\n    isVisible: false\n  };\n\n  componentDidMount() {\n    // relative\n    this.unsubscribe = subscribe(this.handleScroll);\n    this.handleScroll();\n  }\n\n  componentDidUpdate(prevProps) {\n    const didOpen = this.props.isOpened && !prevProps.isOpened;\n    const didClose = !this.props.isOpened && prevProps.isOpened;\n    if (didOpen || didClose) {\n      window.requestAnimationFrame(() => {\n        if (this._unmounted) return;\n        this.setState({isVisible: didOpen});\n      });\n    }\n\n    this.handleScroll();\n  }\n\n  componentWillUnmount() {\n    this._unmounted = true;\n    // @ts-ignore\n    this.unsubscribe();\n  }\n\n  element = createRef();\n  child = createRef();\n\n  // eslint-disable-next-line complexity\n  handleScroll = () => {\n    if (this.child.current) {\n      const rect = this.element.current.getBoundingClientRect();\n      const childRect = this.child.current && this.child.current.getBoundingClientRect();\n      const pageOffset = getPageOffset();\n      const {top: topOffset, left: leftOffset, right: rightOffset} = this.props;\n\n      const pos = getChildPos({\n        offsets: {topOffset, leftOffset, rightOffset},\n        rect,\n        childRect,\n        pageOffset,\n        padding: WINDOW_PAD\n      });\n\n      if (!isEqual(pos, this.state.pos)) {\n        this.setState({pos});\n      }\n    }\n  };\n\n  render() {\n    const {\n      // relative\n      component: Comp,\n      overlayZIndex,\n      isOpened,\n      onClose,\n\n      // Modal\n      children,\n      modalProps,\n      modalStyle = {}\n    } = this.props;\n\n    const {isVisible, pos} = this.state;\n\n    const newModalStyle = {\n      ...defaultModalStyle,\n      content: {\n        ...(modalStyle.content || {})\n      },\n      overlay: {\n        ...defaultModalStyle.overlay,\n        ...(modalStyle.overlay || {}),\n        // needs to be on top of existing modal\n        zIndex: overlayZIndex || 9999\n      }\n    };\n\n    return (\n      <RootContext.Consumer>\n        {context => (\n          <Comp ref={this.element}>\n            {isOpened ? (\n              <Modal\n                className=\"modal-portal\"\n                {...modalProps}\n                ariaHideApp={false}\n                isOpen\n                style={newModalStyle}\n                parentSelector={() => {\n                  // React modal issue: https://github.com/reactjs/react-modal/issues/769\n                  // failed to execute removeChild on parent node when it is already unmounted\n                  return (\n                    // @ts-ignore\n                    (context && context.current) || {\n                      removeChild: () => {},\n                      appendChild: () => {}\n                    }\n                  );\n                }}\n                onRequestClose={onClose}\n              >\n                <div\n                  className=\"portaled-content\"\n                  key=\"item\"\n                  style={{\n                    position: 'fixed',\n                    opacity: isVisible ? 1 : 0,\n                    top: this.state.top,\n                    transition: this.props.theme.transition,\n                    marginTop: isVisible ? '0px' : '14px',\n                    // @ts-ignore\n                    ...pos\n                  }}\n                >\n                  <div\n                    ref={this.child}\n                    style={{\n                      position: 'absolute',\n                      zIndex: overlayZIndex ? overlayZIndex + 1 : 10000\n                    }}\n                  >\n                    {children}\n                  </div>\n                </div>\n              </Modal>\n            ) : null}\n          </Comp>\n        )}\n      </RootContext.Consumer>\n    );\n  }\n}\n\nexport default withTheme(Portaled);\n"]},"metadata":{},"sourceType":"script"}