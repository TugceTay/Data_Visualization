{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.injector = injector;\nexports.flattenDeps = flattenDeps;\nexports.provideRecipesToInjector = provideRecipesToInjector;\nexports.typeCheckRecipe = typeCheckRecipe;\nexports.withState = withState;\nexports.ERROR_MSG = void 0;\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\nvar _react = _interopRequireDefault(require(\"react\"));\nvar _reactRedux = require(\"react-redux\");\nvar _redux = require(\"redux\");\nvar _window = require(\"global/window\");\nvar _context = _interopRequireDefault(require(\"./context\"));\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nvar MissingComp = function MissingComp() {\n  return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null);\n};\nvar ERROR_MSG = {\n  wrongRecipeType: \"injectComponents takes an array of factories replacement pairs as input, \" + \"each pair be a array as [originalFactory, replacement].\",\n  noDep: function noDep(fac, parent) {\n    return \"\".concat(fac.name, \" is required as a dependency of \").concat(parent.name, \", \") + \"but is not provided to injectComponents. It will not be rendered.\";\n  },\n  notFunc: 'factory and its replacement should be a function'\n};\nexports.ERROR_MSG = ERROR_MSG;\nfunction injector() {\n  var map = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Map();\n  var cache = new Map(); // map<factory, factory -> ?>\n\n  var get = function get(fac, parent) {\n    var factory = map.get(fac); // factory is not injected\n\n    if (!factory) {\n      _window.console.error(ERROR_MSG.noDep(fac, parent));\n      return MissingComp;\n    } // check if custom factory deps is declared\n\n    var instances = cache.get(factory) || factory.apply(void 0, (0, _toConsumableArray2[\"default\"])(factory.deps ? factory.deps.map(function (dep) {\n      return get(dep, factory);\n    }) : []));\n    cache.set(fac, instances);\n    return instances;\n  }; // if you have two functions that happen to have the exactly same text\n  // it will be override: 2018-02-05\n\n  return {\n    provide: function provide(factory, replacement) {\n      if (!typeCheckRecipe([factory, replacement])) {\n        return injector(map);\n      }\n      return injector(new Map(map).set(factory, replacement));\n    },\n    get: get\n  };\n} // entryPoint\n\nfunction flattenDeps(allDeps, factory) {\n  var addToDeps = allDeps.concat([factory]);\n  return Array.isArray(factory.deps) && factory.deps.length ? factory.deps.reduce(function (accu, dep) {\n    return flattenDeps(accu, dep);\n  }, addToDeps) : addToDeps;\n}\nfunction provideRecipesToInjector(recipes, appInjector) {\n  var provided = new Map();\n  return recipes.reduce(function (inj, recipe) {\n    var _inj;\n    if (!typeCheckRecipe(recipe)) {\n      return inj;\n    } // collect dependencies of custom factories, if there is any.\n    // Add them to the appInjector\n\n    var customDependencies = flattenDeps([], recipe[1]);\n    inj = customDependencies.reduce(function (ij, factory) {\n      if (provided.get(factory)) {\n        _window.console.warn(\"\".concat(factory.name, \" already injected from \").concat(provided.get(factory).name, \", injecting \").concat(recipe[0].name, \" after \").concat(provided.get(factory).name, \" will override it\"));\n      }\n      return ij.provide(factory, factory);\n    }, inj);\n    provided.set(recipe[0], recipe[1]);\n    return (_inj = inj).provide.apply(_inj, (0, _toConsumableArray2[\"default\"])(recipe));\n  }, appInjector);\n}\nfunction typeCheckRecipe(recipe) {\n  if (!Array.isArray(recipe) || recipe.length < 2) {\n    _window.console.error('Error injecting [factory, replacement]', recipe);\n    _window.console.error(ERROR_MSG.wrongRecipeType);\n    return false;\n  }\n  var _recipe = (0, _slicedToArray2[\"default\"])(recipe, 2),\n    factory = _recipe[0],\n    replacement = _recipe[1];\n  if (typeof factory !== 'function') {\n    _window.console.error('Error injecting factory: ', factory);\n    _window.console.error(ERROR_MSG.notFunc);\n    return false;\n  } else if (typeof replacement !== 'function') {\n    _window.console.error('Error injecting replacement for: ', factory);\n    _window.console.error(ERROR_MSG.notFunc);\n    return false;\n  }\n  return true;\n}\nvar identity = function identity(state) {\n  return state;\n}; // Helper to add reducer state to custom component\n\nfunction withState() {\n  var lenses = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var mapStateToProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : identity;\n  var actions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return function (Component) {\n    var WrappedComponent = function WrappedComponent(_ref) {\n      var state = _ref.state,\n        props = (0, _objectWithoutProperties2[\"default\"])(_ref, [\"state\"]);\n      return /*#__PURE__*/_react[\"default\"].createElement(_context[\"default\"].Consumer, null, function (context) {\n        return /*#__PURE__*/_react[\"default\"].createElement(Component, lenses.reduce(function (totalState, lens) {\n          return _objectSpread(_objectSpread({}, totalState), lens(context.selector(state)));\n        }, props));\n      });\n    };\n    return (0, _reactRedux.connect)(function (state) {\n      return _objectSpread(_objectSpread({}, mapStateToProps(state)), {}, {\n        state: state\n      });\n    }, function (dispatch) {\n      return Object.keys(actions).reduce(function (accu, key) {\n        return _objectSpread(_objectSpread({}, accu), {}, (0, _defineProperty2[\"default\"])({}, key, (0, _redux.bindActionCreators)(actions[key], dispatch)));\n      }, {});\n    })(WrappedComponent);\n  };\n}","map":{"version":3,"sources":["../../src/components/injector.js"],"names":["MissingComp","ERROR_MSG","wrongRecipeType","noDep","fac","parent","name","notFunc","injector","map","Map","cache","get","factory","Console","error","instances","deps","dep","set","provide","replacement","typeCheckRecipe","flattenDeps","allDeps","addToDeps","concat","Array","isArray","length","reduce","accu","provideRecipesToInjector","recipes","appInjector","provided","inj","recipe","customDependencies","ij","warn","identity","state","withState","lenses","mapStateToProps","actions","WrappedComponent","props","totalState","lens","context","selector","keys","key","dispatch"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\nimport {console as Console} from 'global/window';\nimport KeplerGlContext from 'components/context';\n\nconst MissingComp = () => <div />;\n\nexport const ERROR_MSG = {\n  wrongRecipeType:\n    `injectComponents takes an array of factories replacement pairs as input, ` +\n    `each pair be a array as [originalFactory, replacement].`,\n\n  noDep: (fac, parent) =>\n    `${fac.name} is required as a dependency of ${parent.name}, ` +\n    `but is not provided to injectComponents. It will not be rendered.`,\n\n  notFunc: 'factory and its replacement should be a function'\n};\n\nexport function injector(map = new Map()) {\n  const cache = new Map(); // map<factory, factory -> ?>\n  const get = (fac, parent) => {\n    const factory = map.get(fac);\n    // factory is not injected\n    if (!factory) {\n      Console.error(ERROR_MSG.noDep(fac, parent));\n      return MissingComp;\n    }\n\n    // check if custom factory deps is declared\n    const instances =\n      cache.get(factory) ||\n      factory(...(factory.deps ? factory.deps.map(dep => get(dep, factory)) : []));\n\n    cache.set(fac, instances);\n    return instances;\n  };\n\n  // if you have two functions that happen to have the exactly same text\n  // it will be override: 2018-02-05\n  return {\n    provide: (factory, replacement) => {\n      if (!typeCheckRecipe([factory, replacement])) {\n        return injector(map);\n      }\n      return injector(new Map(map).set(factory, replacement));\n    },\n    get\n  };\n}\n\n// entryPoint\nexport function flattenDeps(allDeps, factory) {\n  const addToDeps = allDeps.concat([factory]);\n  return Array.isArray(factory.deps) && factory.deps.length\n    ? factory.deps.reduce((accu, dep) => flattenDeps(accu, dep), addToDeps)\n    : addToDeps;\n}\n\nexport function provideRecipesToInjector(recipes, appInjector) {\n  const provided = new Map();\n\n  return recipes.reduce((inj, recipe) => {\n    if (!typeCheckRecipe(recipe)) {\n      return inj;\n    }\n\n    // collect dependencies of custom factories, if there is any.\n    // Add them to the appInjector\n    const customDependencies = flattenDeps([], recipe[1]);\n    inj = customDependencies.reduce((ij, factory) => {\n      if (provided.get(factory)) {\n        Console.warn(\n          `${factory.name} already injected from ${provided.get(factory).name}, injecting ${\n            recipe[0].name\n          } after ${provided.get(factory).name} will override it`\n        );\n      }\n      return ij.provide(factory, factory);\n    }, inj);\n\n    provided.set(recipe[0], recipe[1]);\n    return inj.provide(...recipe);\n  }, appInjector);\n}\n\nexport function typeCheckRecipe(recipe) {\n  if (!Array.isArray(recipe) || recipe.length < 2) {\n    Console.error('Error injecting [factory, replacement]', recipe);\n    Console.error(ERROR_MSG.wrongRecipeType);\n    return false;\n  }\n\n  const [factory, replacement] = recipe;\n  if (typeof factory !== 'function') {\n    Console.error('Error injecting factory: ', factory);\n    Console.error(ERROR_MSG.notFunc);\n    return false;\n  } else if (typeof replacement !== 'function') {\n    Console.error('Error injecting replacement for: ', factory);\n    Console.error(ERROR_MSG.notFunc);\n    return false;\n  }\n\n  return true;\n}\n\nconst identity = state => state;\n// Helper to add reducer state to custom component\nexport function withState(lenses = [], mapStateToProps = identity, actions = {}) {\n  return Component => {\n    const WrappedComponent = ({state, ...props}) => (\n      <KeplerGlContext.Consumer>\n        {context => (\n          <Component\n            {...lenses.reduce(\n              (totalState, lens) => ({\n                ...totalState,\n                ...lens(context.selector(state))\n              }),\n              props\n            )}\n          />\n        )}\n      </KeplerGlContext.Consumer>\n    );\n\n    return connect(\n      state => ({...mapStateToProps(state), state}),\n      dispatch =>\n        Object.keys(actions).reduce(\n          (accu, key) => ({\n            ...accu,\n            [key]: bindActionCreators(actions[key], dispatch)\n          }),\n          {}\n        )\n    )(WrappedComponent);\n  };\n}\n"]},"metadata":{},"sourceType":"script"}