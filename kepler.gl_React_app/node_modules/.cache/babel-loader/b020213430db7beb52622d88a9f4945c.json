{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FileUpload = exports[\"default\"] = exports.WarningMsg = void 0;\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\nvar _reactIntl = require(\"react-intl\");\nvar _uploadButton = _interopRequireDefault(require(\"./upload-button\"));\nvar _icons = require(\"../icons\");\nvar _fileUploadProgress = _interopRequireDefault(require(\"./file-upload-progress\"));\nvar _fileDrop = _interopRequireDefault(require(\"./file-drop\"));\nvar _utils = require(\"../../../utils/utils\");\nvar _userGuides = require(\"../../../constants/user-guides\");\nvar _reactMarkdown = _interopRequireDefault(require(\"react-markdown\"));\nvar _mediaBreakpoints = require(\"../../../styles/media-breakpoints\");\nvar _localization = require(\"../../../localization\");\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5, _templateObject6, _templateObject7, _templateObject8, _templateObject9, _templateObject10, _templateObject11, _templateObject12, _templateObject13, _templateObject14, _templateObject15, _templateObject16, _templateObject17, _templateObject18;\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n  return arr2;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/** @typedef {import('./file-upload').FileUploadProps} FileUploadProps */\nvar fileIconColor = '#D3D8E0';\nvar LinkRenderer = function LinkRenderer(props) {\n  return /*#__PURE__*/_react[\"default\"].createElement(\"a\", {\n    href: props.href,\n    target: \"_blank\",\n    rel: \"noopener noreferrer\"\n  }, props.children);\n};\nvar StyledUploadMessage = _styledComponents[\"default\"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  color: \", \";\\n  font-size: 14px;\\n  margin-bottom: 12px;\\n\\n  \", \";\\n\"])), function (props) {\n  return props.theme.textColorLT;\n}, _mediaBreakpoints.media.portable(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    font-size: 12px;\\n  \"]))));\nvar WarningMsg = _styledComponents[\"default\"].span(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  margin-top: 10px;\\n  color: \", \";\\n  font-weight: 500;\\n\"])), function (props) {\n  return props.theme.errorColor;\n});\nexports.WarningMsg = WarningMsg;\nvar StyledFileDrop = _styledComponents[\"default\"].div(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  background-color: white;\\n  border-radius: 4px;\\n  border-style: \", \";\\n  border-width: 1px;\\n  border-color: \", \";\\n  text-align: center;\\n  width: 100%;\\n  padding: 48px 8px 0;\\n  height: 360px;\\n\\n  .file-upload-or {\\n    color: \", \";\\n    padding-right: 4px;\\n  }\\n\\n  .file-type-row {\\n    opacity: 0.5;\\n  }\\n  \", \";\\n\"])), function (props) {\n  return props.dragOver ? 'solid' : 'dashed';\n}, function (props) {\n  return props.dragOver ? props.theme.textColorLT : props.theme.subtextColorLT;\n}, function (props) {\n  return props.theme.linkBtnColor;\n}, _mediaBreakpoints.media.portable(_templateObject5 || (_templateObject5 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    padding: 16px 4px 0;\\n  \"]))));\nvar MsgWrapper = _styledComponents[\"default\"].div(_templateObject6 || (_templateObject6 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  color: \", \";\\n  font-size: 20px;\\n  height: 36px;\\n\"])), function (props) {\n  return props.theme.modalTitleColor;\n});\nvar StyledDragNDropIcon = _styledComponents[\"default\"].div(_templateObject7 || (_templateObject7 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  color: \", \";\\n  margin-bottom: 48px;\\n\\n  \", \";\\n  \", \";\\n\"])), fileIconColor, _mediaBreakpoints.media.portable(_templateObject8 || (_templateObject8 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    margin-bottom: 16px;\\n  \"]))), _mediaBreakpoints.media.palm(_templateObject9 || (_templateObject9 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    margin-bottom: 8px;\\n  \"]))));\nvar StyledFileTypeFow = _styledComponents[\"default\"].div(_templateObject10 || (_templateObject10 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  margin-bottom: 24px;\\n  \", \";\\n  \", \";\\n\"])), _mediaBreakpoints.media.portable(_templateObject11 || (_templateObject11 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    margin-bottom: 16px;\\n  \"]))), _mediaBreakpoints.media.palm(_templateObject12 || (_templateObject12 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    margin-bottom: 8px;\\n  \"]))));\nvar StyledFileUpload = _styledComponents[\"default\"].div(_templateObject13 || (_templateObject13 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  .file-drop {\\n    position: relative;\\n  }\\n\"])));\nvar StyledMessage = _styledComponents[\"default\"].div(_templateObject14 || (_templateObject14 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  margin-bottom: 32px;\\n\\n  .loading-action {\\n    margin-right: 10px;\\n  }\\n  .loading-spinner {\\n    margin-left: 10px;\\n  }\\n\"])));\nvar StyledDragFileWrapper = _styledComponents[\"default\"].div(_templateObject15 || (_templateObject15 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  margin-bottom: 32px;\\n  \", \";\\n  \", \";\\n\"])), _mediaBreakpoints.media.portable(_templateObject16 || (_templateObject16 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    margin-bottom: 24px;\\n  \"]))), _mediaBreakpoints.media.portable(_templateObject17 || (_templateObject17 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n    margin-bottom: 16px;\\n  \"]))));\nvar StyledDisclaimer = (0, _styledComponents[\"default\"])(StyledMessage)(_templateObject18 || (_templateObject18 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  margin: 0 auto;\\n\"])));\nfunction FileUploadFactory() {\n  /** @augments {Component<FileUploadProps>} */\n  var FileUpload = /*#__PURE__*/function (_Component) {\n    (0, _inherits2[\"default\"])(FileUpload, _Component);\n    var _super = _createSuper(FileUpload);\n    function FileUpload() {\n      var _this;\n      (0, _classCallCheck2[\"default\"])(this, FileUpload);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"state\", {\n        dragOver: false,\n        fileLoading: false,\n        files: [],\n        errorFiles: []\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"frame\", /*#__PURE__*/(0, _react.createRef)());\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_isValidFileType\", function (filename) {\n        var _this$props$fileExten = _this.props.fileExtensions,\n          fileExtensions = _this$props$fileExten === void 0 ? [] : _this$props$fileExten;\n        var fileExt = fileExtensions.find(function (ext) {\n          return filename.endsWith(ext);\n        });\n        return Boolean(fileExt);\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_handleFileInput\", function (fileList, event) {\n        if (event) {\n          event.stopPropagation();\n        }\n        var files = (0, _toConsumableArray2[\"default\"])(fileList).filter(Boolean);\n        var _this$props$disableEx = _this.props.disableExtensionFilter,\n          disableExtensionFilter = _this$props$disableEx === void 0 ? false : _this$props$disableEx; // TODO - move this code out of the component\n\n        var filesToLoad = [];\n        var errorFiles = [];\n        var _iterator = _createForOfIteratorHelper(files),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var file = _step.value;\n            if (disableExtensionFilter || _this._isValidFileType(file.name)) {\n              filesToLoad.push(file);\n            } else {\n              errorFiles.push(file.name);\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n        var nextState = {\n          files: filesToLoad,\n          errorFiles: errorFiles,\n          dragOver: false\n        };\n        _this.setState(nextState, function () {\n          return nextState.files.length ? _this.props.onFileUpload(nextState.files) : null;\n        });\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_toggleDragState\", function (newState) {\n        _this.setState({\n          dragOver: newState\n        });\n      });\n      return _this;\n    }\n    (0, _createClass2[\"default\"])(FileUpload, [{\n      key: \"render\",\n      value: function render() {\n        var _this2 = this;\n        var _this$state = this.state,\n          dragOver = _this$state.dragOver,\n          files = _this$state.files,\n          errorFiles = _this$state.errorFiles;\n        var _this$props = this.props,\n          fileLoading = _this$props.fileLoading,\n          fileLoadingProgress = _this$props.fileLoadingProgress,\n          theme = _this$props.theme,\n          intl = _this$props.intl;\n        var _this$props2 = this.props,\n          _this$props2$fileExte = _this$props2.fileExtensions,\n          fileExtensions = _this$props2$fileExte === void 0 ? [] : _this$props2$fileExte,\n          _this$props2$fileForm = _this$props2.fileFormatNames,\n          fileFormatNames = _this$props2$fileForm === void 0 ? [] : _this$props2$fileForm;\n        return /*#__PURE__*/_react[\"default\"].createElement(StyledFileUpload, {\n          className: \"file-uploader\",\n          ref: this.frame\n        }, _fileDrop[\"default\"] ? /*#__PURE__*/_react[\"default\"].createElement(_fileDrop[\"default\"], {\n          frame: this.frame.current || document,\n          onDragOver: function onDragOver() {\n            return _this2._toggleDragState(true);\n          },\n          onDragLeave: function onDragLeave() {\n            return _this2._toggleDragState(false);\n          },\n          onDrop: this._handleFileInput,\n          className: \"file-uploader__file-drop\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(StyledUploadMessage, {\n          className: \"file-upload__message\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(_reactMarkdown[\"default\"], {\n          source: \"\".concat(intl.formatMessage({\n            id: 'fileUploader.configUploadMessage'\n          }, {\n            fileFormatNames: fileFormatNames.map(function (format) {\n              return \"**\".concat(format, \"**\");\n            }).join(', ')\n          }), \"(\").concat(_userGuides.GUIDES_FILE_FORMAT_DOC, \").\"),\n          renderers: {\n            link: LinkRenderer\n          }\n        })), /*#__PURE__*/_react[\"default\"].createElement(StyledFileDrop, {\n          dragOver: dragOver\n        }, /*#__PURE__*/_react[\"default\"].createElement(StyledFileTypeFow, {\n          className: \"file-type-row\"\n        }, fileExtensions.map(function (ext) {\n          return /*#__PURE__*/_react[\"default\"].createElement(_icons.FileType, {\n            key: ext,\n            ext: ext,\n            height: \"50px\",\n            fontSize: \"9px\"\n          });\n        })), fileLoading ? /*#__PURE__*/_react[\"default\"].createElement(_fileUploadProgress[\"default\"], {\n          fileLoadingProgress: fileLoadingProgress,\n          theme: theme\n        }) : /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n          style: {\n            opacity: dragOver ? 0.5 : 1\n          },\n          className: \"file-upload-display-message\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(StyledDragNDropIcon, null, /*#__PURE__*/_react[\"default\"].createElement(_icons.DragNDrop, {\n          height: \"44px\"\n        })), errorFiles.length ? /*#__PURE__*/_react[\"default\"].createElement(WarningMsg, null, /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n          id: 'fileUploader.fileNotSupported',\n          values: {\n            errorFiles: errorFiles.join(', ')\n          }\n        })) : null), !files.length ? /*#__PURE__*/_react[\"default\"].createElement(StyledDragFileWrapper, null, /*#__PURE__*/_react[\"default\"].createElement(MsgWrapper, null, /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n          id: 'fileUploader.message'\n        })), /*#__PURE__*/_react[\"default\"].createElement(\"span\", {\n          className: \"file-upload-or\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n          id: 'fileUploader.or'\n        })), /*#__PURE__*/_react[\"default\"].createElement(_uploadButton[\"default\"], {\n          onUpload: this._handleFileInput\n        }, /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n          id: 'fileUploader.browseFiles'\n        }))) : null, /*#__PURE__*/_react[\"default\"].createElement(StyledDisclaimer, null, /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n          id: 'fileUploader.disclaimer'\n        }))))) : null, /*#__PURE__*/_react[\"default\"].createElement(WarningMsg, null, (0, _utils.isChrome)() ? /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n          id: 'fileUploader.chromeMessage'\n        }) : ''));\n      }\n    }], [{\n      key: \"getDerivedStateFromProps\",\n      value: function getDerivedStateFromProps(props, state) {\n        if (state.fileLoading && props.fileLoading === false && state.files.length) {\n          return {\n            files: [],\n            fileLoading: props.fileLoading\n          };\n        }\n        return {\n          fileLoading: props.fileLoading\n        };\n      }\n    }]);\n    return FileUpload;\n  }(_react.Component);\n  return (0, _reactIntl.injectIntl)(FileUpload);\n}\nvar _default = FileUploadFactory;\nexports[\"default\"] = _default;\nvar FileUpload = FileUploadFactory();\nexports.FileUpload = FileUpload;","map":{"version":3,"sources":["../../../../src/components/common/file-uploader/file-upload.js"],"names":["fileIconColor","LinkRenderer","props","href","children","StyledUploadMessage","styled","div","theme","textColorLT","media","portable","WarningMsg","span","errorColor","StyledFileDrop","dragOver","subtextColorLT","linkBtnColor","MsgWrapper","modalTitleColor","StyledDragNDropIcon","palm","StyledFileTypeFow","StyledFileUpload","StyledMessage","StyledDragFileWrapper","StyledDisclaimer","FileUploadFactory","FileUpload","Component","fileLoading","files","errorFiles","state","length","fileExtensions","fileExt","find","filename","endsWith","ext","Boolean","fileList","event","stopPropagation","filter","disableExtensionFilter","filesToLoad","file","_isValidFileType","name","push","nextState","setState","onFileUpload","newState","fileLoadingProgress","intl","fileFormatNames","frame","FileDrop","current","document","_toggleDragState","_handleFileInput","formatMessage","id","map","format","join","GUIDES_FILE_FORMAT_DOC","link","opacity"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {Component, createRef} from 'react';\nimport styled from 'styled-components';\nimport {injectIntl} from 'react-intl';\nimport UploadButton from './upload-button';\nimport {DragNDrop, FileType} from 'components/common/icons';\nimport FileUploadProgress from 'components/common/file-uploader/file-upload-progress';\nimport FileDrop from './file-drop';\n\nimport {isChrome} from 'utils/utils';\nimport {GUIDES_FILE_FORMAT_DOC} from 'constants/user-guides';\nimport ReactMarkdown from 'react-markdown';\n// Breakpoints\nimport {media} from 'styles/media-breakpoints';\nimport {FormattedMessage} from 'localization';\n\n/** @typedef {import('./file-upload').FileUploadProps} FileUploadProps */\n\nconst fileIconColor = '#D3D8E0';\n\nconst LinkRenderer = props => {\n  return (\n    <a href={props.href} target=\"_blank\" rel=\"noopener noreferrer\">\n      {props.children}\n    </a>\n  );\n};\nconst StyledUploadMessage = styled.div`\n  color: ${props => props.theme.textColorLT};\n  font-size: 14px;\n  margin-bottom: 12px;\n\n  ${media.portable`\n    font-size: 12px;\n  `};\n`;\n\nexport const WarningMsg = styled.span`\n  margin-top: 10px;\n  color: ${props => props.theme.errorColor};\n  font-weight: 500;\n`;\n\nconst StyledFileDrop = styled.div`\n  background-color: white;\n  border-radius: 4px;\n  border-style: ${props => (props.dragOver ? 'solid' : 'dashed')};\n  border-width: 1px;\n  border-color: ${props => (props.dragOver ? props.theme.textColorLT : props.theme.subtextColorLT)};\n  text-align: center;\n  width: 100%;\n  padding: 48px 8px 0;\n  height: 360px;\n\n  .file-upload-or {\n    color: ${props => props.theme.linkBtnColor};\n    padding-right: 4px;\n  }\n\n  .file-type-row {\n    opacity: 0.5;\n  }\n  ${media.portable`\n    padding: 16px 4px 0;\n  `};\n`;\n\nconst MsgWrapper = styled.div`\n  color: ${props => props.theme.modalTitleColor};\n  font-size: 20px;\n  height: 36px;\n`;\n\nconst StyledDragNDropIcon = styled.div`\n  color: ${fileIconColor};\n  margin-bottom: 48px;\n\n  ${media.portable`\n    margin-bottom: 16px;\n  `};\n  ${media.palm`\n    margin-bottom: 8px;\n  `};\n`;\n\nconst StyledFileTypeFow = styled.div`\n  margin-bottom: 24px;\n  ${media.portable`\n    margin-bottom: 16px;\n  `};\n  ${media.palm`\n    margin-bottom: 8px;\n  `};\n`;\n\nconst StyledFileUpload = styled.div`\n  .file-drop {\n    position: relative;\n  }\n`;\n\nconst StyledMessage = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-bottom: 32px;\n\n  .loading-action {\n    margin-right: 10px;\n  }\n  .loading-spinner {\n    margin-left: 10px;\n  }\n`;\n\nconst StyledDragFileWrapper = styled.div`\n  margin-bottom: 32px;\n  ${media.portable`\n    margin-bottom: 24px;\n  `};\n  ${media.portable`\n    margin-bottom: 16px;\n  `};\n`;\n\nconst StyledDisclaimer = styled(StyledMessage)`\n  margin: 0 auto;\n`;\n\nfunction FileUploadFactory() {\n  /** @augments {Component<FileUploadProps>} */\n  class FileUpload extends Component {\n    state = {\n      dragOver: false,\n      fileLoading: false,\n      files: [],\n      errorFiles: []\n    };\n\n    static getDerivedStateFromProps(props, state) {\n      if (state.fileLoading && props.fileLoading === false && state.files.length) {\n        return {\n          files: [],\n          fileLoading: props.fileLoading\n        };\n      }\n      return {\n        fileLoading: props.fileLoading\n      };\n    }\n\n    frame = createRef();\n\n    _isValidFileType = filename => {\n      const {fileExtensions = []} = this.props;\n      const fileExt = fileExtensions.find(ext => filename.endsWith(ext));\n\n      return Boolean(fileExt);\n    };\n\n    /** @param {FileList} fileList */\n    _handleFileInput = (fileList, event) => {\n      if (event) {\n        event.stopPropagation();\n      }\n\n      const files = [...fileList].filter(Boolean);\n\n      const {disableExtensionFilter = false} = this.props;\n\n      // TODO - move this code out of the component\n      const filesToLoad = [];\n      const errorFiles = [];\n      for (const file of files) {\n        if (disableExtensionFilter || this._isValidFileType(file.name)) {\n          filesToLoad.push(file);\n        } else {\n          errorFiles.push(file.name);\n        }\n      }\n\n      const nextState = {files: filesToLoad, errorFiles, dragOver: false};\n\n      this.setState(nextState, () =>\n        nextState.files.length ? this.props.onFileUpload(nextState.files) : null\n      );\n    };\n\n    _toggleDragState = newState => {\n      this.setState({dragOver: newState});\n    };\n\n    render() {\n      const {dragOver, files, errorFiles} = this.state;\n      const {fileLoading, fileLoadingProgress, theme, intl} = this.props;\n      const {fileExtensions = [], fileFormatNames = []} = this.props;\n      return (\n        <StyledFileUpload className=\"file-uploader\" ref={this.frame}>\n          {FileDrop ? (\n            <FileDrop\n              frame={this.frame.current || document}\n              onDragOver={() => this._toggleDragState(true)}\n              onDragLeave={() => this._toggleDragState(false)}\n              onDrop={this._handleFileInput}\n              className=\"file-uploader__file-drop\"\n            >\n              <StyledUploadMessage className=\"file-upload__message\">\n                <ReactMarkdown\n                  source={`${intl.formatMessage(\n                    {\n                      id: 'fileUploader.configUploadMessage'\n                    },\n                    {\n                      fileFormatNames: fileFormatNames.map(format => `**${format}**`).join(', ')\n                    }\n                  )}(${GUIDES_FILE_FORMAT_DOC}).`}\n                  renderers={{link: LinkRenderer}}\n                />\n              </StyledUploadMessage>\n              <StyledFileDrop dragOver={dragOver}>\n                <StyledFileTypeFow className=\"file-type-row\">\n                  {fileExtensions.map(ext => (\n                    <FileType key={ext} ext={ext} height=\"50px\" fontSize=\"9px\" />\n                  ))}\n                </StyledFileTypeFow>\n                {fileLoading ? (\n                  <FileUploadProgress fileLoadingProgress={fileLoadingProgress} theme={theme} />\n                ) : (\n                  <>\n                    <div\n                      style={{opacity: dragOver ? 0.5 : 1}}\n                      className=\"file-upload-display-message\"\n                    >\n                      <StyledDragNDropIcon>\n                        <DragNDrop height=\"44px\" />\n                      </StyledDragNDropIcon>\n\n                      {errorFiles.length ? (\n                        <WarningMsg>\n                          <FormattedMessage\n                            id={'fileUploader.fileNotSupported'}\n                            values={{errorFiles: errorFiles.join(', ')}}\n                          />\n                        </WarningMsg>\n                      ) : null}\n                    </div>\n                    {!files.length ? (\n                      <StyledDragFileWrapper>\n                        <MsgWrapper>\n                          <FormattedMessage id={'fileUploader.message'} />\n                        </MsgWrapper>\n                        <span className=\"file-upload-or\">\n                          <FormattedMessage id={'fileUploader.or'} />\n                        </span>\n                        <UploadButton onUpload={this._handleFileInput}>\n                          <FormattedMessage id={'fileUploader.browseFiles'} />\n                        </UploadButton>\n                      </StyledDragFileWrapper>\n                    ) : null}\n\n                    <StyledDisclaimer>\n                      <FormattedMessage id={'fileUploader.disclaimer'} />\n                    </StyledDisclaimer>\n                  </>\n                )}\n              </StyledFileDrop>\n            </FileDrop>\n          ) : null}\n\n          <WarningMsg>\n            {isChrome() ? <FormattedMessage id={'fileUploader.chromeMessage'} /> : ''}\n          </WarningMsg>\n        </StyledFileUpload>\n      );\n    }\n  }\n\n  return injectIntl(FileUpload);\n}\n\nexport default FileUploadFactory;\nexport const FileUpload = FileUploadFactory();\n"]},"metadata":{},"sourceType":"script"}