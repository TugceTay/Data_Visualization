{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.testForCoordinates = void 0;\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\nvar _classnames = _interopRequireDefault(require(\"classnames\"));\nvar _mapbox = _interopRequireDefault(require(\"mapbox\"));\nvar _reactIntl = require(\"react-intl\");\nvar _viewportMercatorProject = require(\"viewport-mercator-project\");\nvar _keyevent = _interopRequireDefault(require(\"../../constants/keyevent\"));\nvar _styledComponents2 = require(\"../common/styled-components\");\nvar _icons = require(\"../common/icons\");\nvar _templateObject;\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\n\n// matches only valid coordinates\nvar COORDINATE_REGEX_STRING = '^[-+]?([1-8]?\\\\d(\\\\.\\\\d+)?|90(\\\\.0+)?),\\\\s*[-+]?(180(\\\\.0+)?|((1[0-7]\\\\d)|([1-9]?\\\\d))(\\\\.\\\\d+)?)';\nvar COORDINATE_REGEX = RegExp(COORDINATE_REGEX_STRING);\nvar PLACEHOLDER = 'Enter an address or coordinates, ex 37.79,-122.40';\nvar debounceTimeout = null;\nvar testForCoordinates = function testForCoordinates(query) {\n  var isValid = COORDINATE_REGEX.test(query.trim());\n  if (!isValid) {\n    return [isValid, query];\n  }\n  var tokens = query.trim().split(',');\n  return [isValid, Number(tokens[0]), Number(tokens[1])];\n};\nexports.testForCoordinates = testForCoordinates;\nvar StyledContainer = _styledComponents[\"default\"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  position: relative;\\n  color: \", \";\\n\\n  .geocoder-input {\\n    box-shadow: \", \";\\n\\n    .geocoder-input__search {\\n      position: absolute;\\n      height: \", \"px;\\n      width: 30px;\\n      padding-left: 6px;\\n      display: flex;\\n      align-items: center;\\n      justify-content: center;\\n      color: \", \";\\n    }\\n\\n    input {\\n      padding: 4px 36px;\\n      height: \", \"px;\\n      caret-color: unset;\\n    }\\n  }\\n\\n  .geocoder-results {\\n    box-shadow: \", \";\\n    background-color: \", \";\\n    position: absolute;\\n    width: \", \"px;\\n    margin-top: \", \"px;\\n  }\\n\\n  .geocoder-item {\\n    \", \";\\n    \", \";\\n\\n    &.active {\\n      background-color: \", \";\\n    }\\n  }\\n\\n  .remove-result {\\n    position: absolute;\\n    right: 16px;\\n    top: 0px;\\n    height: \", \"px;\\n    display: flex;\\n    align-items: center;\\n\\n    :hover {\\n      cursor: pointer;\\n      color: \", \";\\n    }\\n  }\\n\"])), function (props) {\n  return props.theme.textColor;\n}, function (props) {\n  return props.theme.boxShadow;\n}, function (props) {\n  return props.theme.geocoderInputHeight;\n}, function (props) {\n  return props.theme.subtextColor;\n}, function (props) {\n  return props.theme.geocoderInputHeight;\n}, function (props) {\n  return props.theme.boxShadow;\n}, function (props) {\n  return props.theme.panelBackground;\n}, function (props) {\n  return Number.isFinite(props.width) ? props.width : props.theme.geocoderWidth;\n}, function (props) {\n  return props.theme.dropdownWapperMargin;\n}, function (props) {\n  return props.theme.dropdownListItem;\n}, function (props) {\n  return props.theme.textTruncate;\n}, function (props) {\n  return props.theme.dropdownListHighlightBg;\n}, function (props) {\n  return props.theme.geocoderInputHeight;\n}, function (props) {\n  return props.theme.textColorHl;\n});\n/** @type {import('./geocoder').GeocoderComponent} */\n\nvar GeoCoder = function GeoCoder(_ref) {\n  var mapboxApiAccessToken = _ref.mapboxApiAccessToken,\n    _ref$className = _ref.className,\n    className = _ref$className === void 0 ? '' : _ref$className,\n    _ref$limit = _ref.limit,\n    limit = _ref$limit === void 0 ? 5 : _ref$limit,\n    _ref$timeout = _ref.timeout,\n    timeout = _ref$timeout === void 0 ? 300 : _ref$timeout,\n    _ref$formatItem = _ref.formatItem,\n    formatItem = _ref$formatItem === void 0 ? function (item) {\n      return item.place_name;\n    } : _ref$formatItem,\n    viewport = _ref.viewport,\n    onSelected = _ref.onSelected,\n    onDeleteMarker = _ref.onDeleteMarker,\n    transitionDuration = _ref.transitionDuration,\n    pointZoom = _ref.pointZoom,\n    width = _ref.width,\n    intl = _ref.intl;\n  var _useState = (0, _react.useState)(''),\n    _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n    inputValue = _useState2[0],\n    setInputValue = _useState2[1];\n  var _useState3 = (0, _react.useState)(false),\n    _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n    showResults = _useState4[0],\n    setShowResults = _useState4[1];\n  var _useState5 = (0, _react.useState)(false),\n    _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n    showDelete = _useState6[0],\n    setShowDelete = _useState6[1];\n  /** @type {import('./geocoder').Results} */\n\n  var initialResults = [];\n  var _useState7 = (0, _react.useState)(initialResults),\n    _useState8 = (0, _slicedToArray2[\"default\"])(_useState7, 2),\n    results = _useState8[0],\n    setResults = _useState8[1];\n  var _useState9 = (0, _react.useState)(0),\n    _useState10 = (0, _slicedToArray2[\"default\"])(_useState9, 2),\n    selectedIndex = _useState10[0],\n    setSelectedIndex = _useState10[1];\n  var client = (0, _react.useMemo)(function () {\n    return new _mapbox[\"default\"](mapboxApiAccessToken);\n  }, [mapboxApiAccessToken]);\n  var onChange = (0, _react.useCallback)(function (event) {\n    var queryString = event.target.value;\n    setInputValue(queryString);\n    var _testForCoordinates = testForCoordinates(queryString),\n      _testForCoordinates2 = (0, _slicedToArray2[\"default\"])(_testForCoordinates, 3),\n      hasValidCoordinates = _testForCoordinates2[0],\n      longitude = _testForCoordinates2[1],\n      latitude = _testForCoordinates2[2];\n    if (hasValidCoordinates) {\n      setResults([{\n        center: [latitude, longitude],\n        place_name: queryString\n      }]);\n    } else {\n      clearTimeout(debounceTimeout);\n      debounceTimeout = setTimeout( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n        var response;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(limit > 0 && Boolean(queryString))) {\n                  _context.next = 11;\n                  break;\n                }\n                _context.prev = 1;\n                _context.next = 4;\n                return client.geocodeForward(queryString, {\n                  limit: limit\n                });\n              case 4:\n                response = _context.sent;\n                if (response.entity.features) {\n                  setShowResults(true);\n                  setResults(response.entity.features);\n                }\n                _context.next = 11;\n                break;\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](1);\n                // TODO: show geocode error\n                // eslint-disable-next-line no-console\n                console.log(_context.t0);\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[1, 8]]);\n      })), timeout);\n    }\n  }, [client, limit, timeout, setResults, setShowResults]);\n  var onBlur = (0, _react.useCallback)(function () {\n    setTimeout(function () {\n      setShowResults(false);\n    }, timeout);\n  }, [setShowResults, timeout]);\n  var onFocus = (0, _react.useCallback)(function () {\n    return setShowResults(true);\n  }, [setShowResults]);\n  var onItemSelected = (0, _react.useCallback)(function (item) {\n    var newViewport = new _viewportMercatorProject.WebMercatorViewport(viewport);\n    var bbox = item.bbox,\n      center = item.center;\n    newViewport = bbox ? newViewport.fitBounds([[bbox[0], bbox[1]], [bbox[2], bbox[3]]]) : {\n      longitude: center[0],\n      latitude: center[1],\n      zoom: pointZoom\n    };\n    var _newViewport = newViewport,\n      longitude = _newViewport.longitude,\n      latitude = _newViewport.latitude,\n      zoom = _newViewport.zoom;\n    onSelected(_objectSpread(_objectSpread({}, viewport), {\n      longitude: longitude,\n      latitude: latitude,\n      zoom: zoom,\n      transitionDuration: transitionDuration\n    }), item);\n    setShowResults(false);\n    setInputValue(formatItem(item));\n    setShowDelete(true);\n  }, [viewport, onSelected, transitionDuration, pointZoom, formatItem]);\n  var onMarkDeleted = (0, _react.useCallback)(function () {\n    setShowDelete(false);\n    setInputValue('');\n    onDeleteMarker();\n  }, [onDeleteMarker]);\n  var onKeyDown = (0, _react.useCallback)(function (e) {\n    if (!results || results.length === 0) {\n      return;\n    }\n    switch (e.keyCode) {\n      case _keyevent[\"default\"].DOM_VK_UP:\n        setSelectedIndex(selectedIndex > 0 ? selectedIndex - 1 : selectedIndex);\n        break;\n      case _keyevent[\"default\"].DOM_VK_DOWN:\n        setSelectedIndex(selectedIndex < results.length - 1 ? selectedIndex + 1 : selectedIndex);\n        break;\n      case _keyevent[\"default\"].DOM_VK_ENTER:\n      case _keyevent[\"default\"].DOM_VK_RETURN:\n        if (results[selectedIndex]) {\n          onItemSelected(results[selectedIndex]);\n        }\n        break;\n      default:\n        break;\n    }\n  }, [results, selectedIndex, setSelectedIndex, onItemSelected]);\n  return /*#__PURE__*/_react[\"default\"].createElement(StyledContainer, {\n    className: className,\n    width: width\n  }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"geocoder-input\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"geocoder-input__search\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_icons.Search, {\n    height: \"20px\"\n  })), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.Input, {\n    type: \"text\",\n    onChange: onChange,\n    onBlur: onBlur,\n    onFocus: onFocus,\n    onKeyDown: onKeyDown,\n    value: inputValue,\n    placeholder: intl ? intl.formatMessage({\n      id: 'geocoder.title',\n      defaultMessage: PLACEHOLDER\n    }) : PLACEHOLDER\n  }), showDelete ? /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"remove-result\"\n  }, /*#__PURE__*/_react[\"default\"].createElement(_icons.Delete, {\n    height: \"12px\",\n    onClick: onMarkDeleted\n  })) : null), showResults ? /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n    className: \"geocoder-results\"\n  }, results.map(function (item, index) {\n    return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n      key: index,\n      className: (0, _classnames[\"default\"])('geocoder-item', {\n        active: selectedIndex === index\n      }),\n      onClick: function onClick() {\n        return onItemSelected(item);\n      }\n    }, formatItem(item));\n  })) : null);\n};\nvar _default = (0, _reactIntl.injectIntl)(GeoCoder);\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../../src/components/geocoder/geocoder.js"],"names":["COORDINATE_REGEX_STRING","COORDINATE_REGEX","RegExp","PLACEHOLDER","debounceTimeout","testForCoordinates","isValid","test","query","trim","tokens","split","Number","StyledContainer","styled","div","props","theme","textColor","boxShadow","geocoderInputHeight","subtextColor","panelBackground","isFinite","width","geocoderWidth","dropdownWapperMargin","dropdownListItem","textTruncate","dropdownListHighlightBg","textColorHl","GeoCoder","mapboxApiAccessToken","className","limit","timeout","formatItem","item","place_name","viewport","onSelected","onDeleteMarker","transitionDuration","pointZoom","intl","inputValue","setInputValue","showResults","setShowResults","showDelete","setShowDelete","initialResults","results","setResults","selectedIndex","setSelectedIndex","client","MapboxClient","onChange","queryString","event","target","value","hasValidCoordinates","longitude","latitude","center","clearTimeout","setTimeout","Boolean","response","geocodeForward","entity","features","console","log","onBlur","onFocus","onItemSelected","newViewport","WebMercatorViewport","bbox","fitBounds","zoom","onMarkDeleted","onKeyDown","length","e","keyCode","KeyEvent","DOM_VK_UP","DOM_VK_DOWN","DOM_VK_ENTER","DOM_VK_RETURN","formatMessage","id","defaultMessage","map","index","active"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {useCallback, useMemo, useState} from 'react';\nimport styled from 'styled-components';\nimport classnames from 'classnames';\nimport MapboxClient from 'mapbox';\nimport {injectIntl} from 'react-intl';\nimport {WebMercatorViewport} from 'viewport-mercator-project';\nimport KeyEvent from 'constants/keyevent';\nimport {Input} from 'components/common/styled-components';\nimport {Search, Delete} from 'components/common/icons';\n\n// matches only valid coordinates\nconst COORDINATE_REGEX_STRING =\n  '^[-+]?([1-8]?\\\\d(\\\\.\\\\d+)?|90(\\\\.0+)?),\\\\s*[-+]?(180(\\\\.0+)?|((1[0-7]\\\\d)|([1-9]?\\\\d))(\\\\.\\\\d+)?)';\nconst COORDINATE_REGEX = RegExp(COORDINATE_REGEX_STRING);\n\nconst PLACEHOLDER = 'Enter an address or coordinates, ex 37.79,-122.40';\n\nlet debounceTimeout = null;\n\nexport const testForCoordinates = query => {\n  const isValid = COORDINATE_REGEX.test(query.trim());\n\n  if (!isValid) {\n    return [isValid, query];\n  }\n\n  const tokens = query.trim().split(',');\n\n  return [isValid, Number(tokens[0]), Number(tokens[1])];\n};\n\nconst StyledContainer = styled.div`\n  position: relative;\n  color: ${props => props.theme.textColor};\n\n  .geocoder-input {\n    box-shadow: ${props => props.theme.boxShadow};\n\n    .geocoder-input__search {\n      position: absolute;\n      height: ${props => props.theme.geocoderInputHeight}px;\n      width: 30px;\n      padding-left: 6px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: ${props => props.theme.subtextColor};\n    }\n\n    input {\n      padding: 4px 36px;\n      height: ${props => props.theme.geocoderInputHeight}px;\n      caret-color: unset;\n    }\n  }\n\n  .geocoder-results {\n    box-shadow: ${props => props.theme.boxShadow};\n    background-color: ${props => props.theme.panelBackground};\n    position: absolute;\n    width: ${props => (Number.isFinite(props.width) ? props.width : props.theme.geocoderWidth)}px;\n    margin-top: ${props => props.theme.dropdownWapperMargin}px;\n  }\n\n  .geocoder-item {\n    ${props => props.theme.dropdownListItem};\n    ${props => props.theme.textTruncate};\n\n    &.active {\n      background-color: ${props => props.theme.dropdownListHighlightBg};\n    }\n  }\n\n  .remove-result {\n    position: absolute;\n    right: 16px;\n    top: 0px;\n    height: ${props => props.theme.geocoderInputHeight}px;\n    display: flex;\n    align-items: center;\n\n    :hover {\n      cursor: pointer;\n      color: ${props => props.theme.textColorHl};\n    }\n  }\n`;\n\n/** @type {import('./geocoder').GeocoderComponent} */\nconst GeoCoder = ({\n  mapboxApiAccessToken,\n  className = '',\n  limit = 5,\n  timeout = 300,\n  formatItem = item => item.place_name,\n  viewport,\n  onSelected,\n  onDeleteMarker,\n  transitionDuration,\n  pointZoom,\n  width,\n  intl\n}) => {\n  const [inputValue, setInputValue] = useState('');\n  const [showResults, setShowResults] = useState(false);\n  const [showDelete, setShowDelete] = useState(false);\n  /** @type {import('./geocoder').Results} */\n  const initialResults = [];\n  const [results, setResults] = useState(initialResults);\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  const client = useMemo(() => new MapboxClient(mapboxApiAccessToken), [mapboxApiAccessToken]);\n\n  const onChange = useCallback(\n    event => {\n      const queryString = event.target.value;\n      setInputValue(queryString);\n      const [hasValidCoordinates, longitude, latitude] = testForCoordinates(queryString);\n      if (hasValidCoordinates) {\n        setResults([{center: [latitude, longitude], place_name: queryString}]);\n      } else {\n        clearTimeout(debounceTimeout);\n        debounceTimeout = setTimeout(async () => {\n          if (limit > 0 && Boolean(queryString)) {\n            try {\n              const response = await client.geocodeForward(queryString, {limit});\n              if (response.entity.features) {\n                setShowResults(true);\n                setResults(response.entity.features);\n              }\n            } catch (e) {\n              // TODO: show geocode error\n              // eslint-disable-next-line no-console\n              console.log(e);\n            }\n          }\n        }, timeout);\n      }\n    },\n    [client, limit, timeout, setResults, setShowResults]\n  );\n\n  const onBlur = useCallback(() => {\n    setTimeout(() => {\n      setShowResults(false);\n    }, timeout);\n  }, [setShowResults, timeout]);\n\n  const onFocus = useCallback(() => setShowResults(true), [setShowResults]);\n\n  const onItemSelected = useCallback(\n    item => {\n      let newViewport = new WebMercatorViewport(viewport);\n      const {bbox, center} = item;\n\n      newViewport = bbox\n        ? newViewport.fitBounds([\n            [bbox[0], bbox[1]],\n            [bbox[2], bbox[3]]\n          ])\n        : {\n            longitude: center[0],\n            latitude: center[1],\n            zoom: pointZoom\n          };\n\n      const {longitude, latitude, zoom} = newViewport;\n\n      onSelected({...viewport, ...{longitude, latitude, zoom, transitionDuration}}, item);\n\n      setShowResults(false);\n      setInputValue(formatItem(item));\n      setShowDelete(true);\n    },\n    [viewport, onSelected, transitionDuration, pointZoom, formatItem]\n  );\n\n  const onMarkDeleted = useCallback(() => {\n    setShowDelete(false);\n    setInputValue('');\n    onDeleteMarker();\n  }, [onDeleteMarker]);\n\n  const onKeyDown = useCallback(\n    e => {\n      if (!results || results.length === 0) {\n        return;\n      }\n      switch (e.keyCode) {\n        case KeyEvent.DOM_VK_UP:\n          setSelectedIndex(selectedIndex > 0 ? selectedIndex - 1 : selectedIndex);\n          break;\n        case KeyEvent.DOM_VK_DOWN:\n          setSelectedIndex(selectedIndex < results.length - 1 ? selectedIndex + 1 : selectedIndex);\n          break;\n        case KeyEvent.DOM_VK_ENTER:\n        case KeyEvent.DOM_VK_RETURN:\n          if (results[selectedIndex]) {\n            onItemSelected(results[selectedIndex]);\n          }\n          break;\n        default:\n          break;\n      }\n    },\n    [results, selectedIndex, setSelectedIndex, onItemSelected]\n  );\n\n  return (\n    <StyledContainer className={className} width={width}>\n      <div className=\"geocoder-input\">\n        <div className=\"geocoder-input__search\">\n          <Search height=\"20px\" />\n        </div>\n        <Input\n          type=\"text\"\n          onChange={onChange}\n          onBlur={onBlur}\n          onFocus={onFocus}\n          onKeyDown={onKeyDown}\n          value={inputValue}\n          placeholder={\n            intl\n              ? intl.formatMessage({id: 'geocoder.title', defaultMessage: PLACEHOLDER})\n              : PLACEHOLDER\n          }\n        />\n        {showDelete ? (\n          <div className=\"remove-result\">\n            <Delete height=\"12px\" onClick={onMarkDeleted} />\n          </div>\n        ) : null}\n      </div>\n\n      {showResults ? (\n        <div className=\"geocoder-results\">\n          {results.map((item, index) => (\n            <div\n              key={index}\n              className={classnames('geocoder-item', {active: selectedIndex === index})}\n              onClick={() => onItemSelected(item)}\n            >\n              {formatItem(item)}\n            </div>\n          ))}\n        </div>\n      ) : null}\n    </StyledContainer>\n  );\n};\n\nexport default injectIntl(GeoCoder);\n"]},"metadata":{},"sourceType":"script"}