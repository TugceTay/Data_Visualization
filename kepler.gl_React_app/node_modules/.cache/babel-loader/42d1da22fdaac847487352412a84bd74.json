{"ast":null,"code":"var DEGREES_TO_RADIANS = Math.PI / 180;\nvar DAY_IN_MS = 1000 * 60 * 60 * 24;\nvar JD1970 = 2440588;\nvar JD2000 = 2451545;\nvar e = DEGREES_TO_RADIANS * 23.4397;\nvar M0 = 357.5291;\nvar M1 = 0.98560028;\nvar THETA0 = 280.147;\nvar THETA1 = 360.9856235;\nexport function getSolarPosition(timestamp, latitude, longitude) {\n  var longitudeWestInRadians = DEGREES_TO_RADIANS * -longitude;\n  var phi = DEGREES_TO_RADIANS * latitude;\n  var d = toDays(timestamp);\n  var c = getSunCoords(d);\n  var H = getSiderealTime(d, longitudeWestInRadians) - c.rightAscension;\n  return {\n    azimuth: getAzimuth(H, phi, c.declination),\n    altitude: getAltitude(H, phi, c.declination)\n  };\n}\nexport function getSunlightDirection(timestamp, latitude, longitude) {\n  var _getSolarPosition = getSolarPosition(timestamp, latitude, longitude),\n    azimuth = _getSolarPosition.azimuth,\n    altitude = _getSolarPosition.altitude;\n  var azimuthN = azimuth + Math.PI;\n  return [-Math.sin(azimuthN), -Math.cos(azimuthN), -Math.sin(altitude)];\n}\nfunction toJulianDay(timestamp) {\n  return timestamp / DAY_IN_MS - 0.5 + JD1970;\n}\nfunction toDays(timestamp) {\n  return toJulianDay(timestamp) - JD2000;\n}\nfunction getRightAscension(eclipticLongitude, b) {\n  var lambda = eclipticLongitude;\n  return Math.atan2(Math.sin(lambda) * Math.cos(e) - Math.tan(b) * Math.sin(e), Math.cos(lambda));\n}\nfunction getDeclination(eclipticLongitude, b) {\n  var lambda = eclipticLongitude;\n  return Math.asin(Math.sin(b) * Math.cos(e) + Math.cos(b) * Math.sin(e) * Math.sin(lambda));\n}\nfunction getAzimuth(hourAngle, latitudeInRadians, declination) {\n  var H = hourAngle;\n  var phi = latitudeInRadians;\n  var delta = declination;\n  return Math.atan2(Math.sin(H), Math.cos(H) * Math.sin(phi) - Math.tan(delta) * Math.cos(phi));\n}\nfunction getAltitude(hourAngle, latitudeInRadians, declination) {\n  var H = hourAngle;\n  var phi = latitudeInRadians;\n  var delta = declination;\n  return Math.asin(Math.sin(phi) * Math.sin(delta) + Math.cos(phi) * Math.cos(delta) * Math.cos(H));\n}\nfunction getSiderealTime(dates, longitudeWestInRadians) {\n  return DEGREES_TO_RADIANS * (THETA0 + THETA1 * dates) - longitudeWestInRadians;\n}\nfunction getSolarMeanAnomaly(days) {\n  return DEGREES_TO_RADIANS * (M0 + M1 * days);\n}\nfunction getEclipticLongitude(meanAnomaly) {\n  var M = meanAnomaly;\n  var C = DEGREES_TO_RADIANS * (1.9148 * Math.sin(M) + 0.02 * Math.sin(2 * M) + 0.0003 * Math.sin(3 * M));\n  var P = DEGREES_TO_RADIANS * 102.9372;\n  return M + C + P + Math.PI;\n}\nfunction getSunCoords(dates) {\n  var M = getSolarMeanAnomaly(dates);\n  var L = getEclipticLongitude(M);\n  return {\n    declination: getDeclination(L, 0),\n    rightAscension: getRightAscension(L, 0)\n  };\n}","map":{"version":3,"sources":["../../../../src/effects/lighting/suncalc.js"],"names":["DEGREES_TO_RADIANS","Math","PI","DAY_IN_MS","JD1970","JD2000","e","M0","M1","THETA0","THETA1","getSolarPosition","timestamp","latitude","longitude","longitudeWestInRadians","phi","d","toDays","c","getSunCoords","H","getSiderealTime","rightAscension","azimuth","getAzimuth","declination","altitude","getAltitude","getSunlightDirection","azimuthN","sin","cos","toJulianDay","getRightAscension","eclipticLongitude","b","lambda","atan2","tan","getDeclination","asin","hourAngle","latitudeInRadians","delta","dates","getSolarMeanAnomaly","days","getEclipticLongitude","meanAnomaly","M","C","P","L"],"mappings":"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","sourcesContent":["// sun position calculations are based on http://aa.quae.nl/en/reken/zonpositie.html formulas\n// and inspired by https://github.com/mourner/suncalc/blob/master/suncalc.js\nconst DEGREES_TO_RADIANS = Math.PI / 180;\n\nconst DAY_IN_MS = 1000 * 60 * 60 * 24;\nconst JD1970 = 2440588; // Julian Day year 1970\nconst JD2000 = 2451545; // Julian Day year 2000\n\n// This angle ε [epsilon] is called the obliquity of the ecliptic and its value at the beginning of 2000 was 23.4397°\nconst e = DEGREES_TO_RADIANS * 23.4397; // obliquity of the Earth\n\n// Refer https://www.aa.quae.nl/en/reken/zonpositie.html\n// \"The Mean Anomaly\" section for explanation\nconst M0 = 357.5291; // Earth mean anomaly on start day\nconst M1 = 0.98560028; // Earth angle traverses on average per day seen from the sun\n\nconst THETA0 = 280.147; // The sidereal time (in degrees) at longitude 0° at the instant defined by JD2000\nconst THETA1 = 360.9856235; // The rate of change of the sidereal time, in degrees per day.\n\nexport function getSolarPosition(timestamp, latitude, longitude) {\n  const longitudeWestInRadians = DEGREES_TO_RADIANS * -longitude;\n  const phi = DEGREES_TO_RADIANS * latitude;\n  const d = toDays(timestamp);\n\n  const c = getSunCoords(d);\n  // hour angle\n  const H = getSiderealTime(d, longitudeWestInRadians) - c.rightAscension;\n\n  // https://www.aa.quae.nl/en/reken/zonpositie.html\n  // The altitude is 0° at the horizon, +90° in the zenith (straight over your head), and −90° in the nadir (straight down).\n  // The azimuth is the direction along the horizon, which we measure from south to west.\n  // South has azimuth 0°, west +90°, north +180°, and east +270° (or −90°, that's the same thing).\n  return {\n    azimuth: getAzimuth(H, phi, c.declination),\n    altitude: getAltitude(H, phi, c.declination)\n  };\n}\n\nexport function getSunlightDirection(timestamp, latitude, longitude) {\n  const {azimuth, altitude} = getSolarPosition(timestamp, latitude, longitude);\n  // convert azimuth from 0 at south to be 0 at north\n  const azimuthN = azimuth + Math.PI;\n\n  // solar position to light direction\n  return [-Math.sin(azimuthN), -Math.cos(azimuthN), -Math.sin(altitude)];\n}\n\nfunction toJulianDay(timestamp) {\n  return timestamp / DAY_IN_MS - 0.5 + JD1970;\n}\n\nfunction toDays(timestamp) {\n  return toJulianDay(timestamp) - JD2000;\n}\n\nfunction getRightAscension(eclipticLongitude, b) {\n  const lambda = eclipticLongitude;\n  return Math.atan2(Math.sin(lambda) * Math.cos(e) - Math.tan(b) * Math.sin(e), Math.cos(lambda));\n}\n\nfunction getDeclination(eclipticLongitude, b) {\n  const lambda = eclipticLongitude;\n  return Math.asin(Math.sin(b) * Math.cos(e) + Math.cos(b) * Math.sin(e) * Math.sin(lambda));\n}\n\nfunction getAzimuth(hourAngle, latitudeInRadians, declination) {\n  const H = hourAngle;\n  const phi = latitudeInRadians;\n  const delta = declination;\n  return Math.atan2(Math.sin(H), Math.cos(H) * Math.sin(phi) - Math.tan(delta) * Math.cos(phi));\n}\n\nfunction getAltitude(hourAngle, latitudeInRadians, declination) {\n  const H = hourAngle;\n  const phi = latitudeInRadians;\n  const delta = declination;\n  return Math.asin(Math.sin(phi) * Math.sin(delta) + Math.cos(phi) * Math.cos(delta) * Math.cos(H));\n}\n\n// https://www.aa.quae.nl/en/reken/zonpositie.html\n// \"The Observer section\"\nfunction getSiderealTime(dates, longitudeWestInRadians) {\n  return DEGREES_TO_RADIANS * (THETA0 + THETA1 * dates) - longitudeWestInRadians;\n}\n\nfunction getSolarMeanAnomaly(days) {\n  return DEGREES_TO_RADIANS * (M0 + M1 * days);\n}\n\nfunction getEclipticLongitude(meanAnomaly) {\n  const M = meanAnomaly;\n  // equation of center\n  const C =\n    DEGREES_TO_RADIANS * (1.9148 * Math.sin(M) + 0.02 * Math.sin(2 * M) + 0.0003 * Math.sin(3 * M));\n  // perihelion of the Earth\n  const P = DEGREES_TO_RADIANS * 102.9372;\n\n  return M + C + P + Math.PI;\n}\n\nfunction getSunCoords(dates) {\n  const M = getSolarMeanAnomaly(dates);\n  const L = getEclipticLongitude(M);\n\n  return {\n    declination: getDeclination(L, 0),\n    rightAscension: getRightAscension(L, 0)\n  };\n}\n"]},"metadata":{},"sourceType":"module"}