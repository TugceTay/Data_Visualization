{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = RangeSliderFactory;\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _reactLifecyclesCompat = require(\"react-lifecycles-compat\");\nvar _reselect = require(\"reselect\");\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\nvar _rangePlot = _interopRequireDefault(require(\"./range-plot\"));\nvar _slider = _interopRequireDefault(require(\"./slider/slider\"));\nvar _styledComponents2 = require(\"./styled-components\");\nvar _dataUtils = require(\"../../utils/data-utils\");\nvar _observeDimensions = require(\"../../utils/observe-dimensions\");\nvar _templateObject, _templateObject2, _templateObject3;\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nvar SliderInput = (0, _styledComponents[\"default\"])(_styledComponents2.Input)(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  width: \", \"px;\\n  margin-left: \", \"px;\\n  font-size: \", \"; // 10px // 12px;\\n  padding: \", \"; // 4px 6px; // 6px 12px;\\n\"])), function (props) {\n  return props.theme.sliderInputWidth;\n}, function (props) {\n  return props.flush ? 0 : props.size === 'tiny' ? 12 : 18;\n}, function (props) {\n  return props.theme.sliderInputFontSize;\n}, function (props) {\n  return props.theme.sliderInputPadding;\n});\nvar SliderWrapper = _styledComponents[\"default\"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  display: flex;\\n  position: relative;\\n  align-items: \", \";\\n\"])), function (props) {\n  return !props.isRanged && props.showInput ? 'center' : 'flex-start';\n});\nvar RangeInputWrapper = _styledComponents[\"default\"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  margin-top: 12px;\\n  display: flex;\\n  justify-content: space-between;\\n\"])));\nRangeSliderFactory.deps = [_rangePlot[\"default\"]];\nfunction RangeSliderFactory(RangePlot) {\n  var RangeSlider = /*#__PURE__*/function (_Component) {\n    (0, _inherits2[\"default\"])(RangeSlider, _Component);\n    var _super = _createSuper(RangeSlider);\n    function RangeSlider() {\n      var _this;\n      (0, _classCallCheck2[\"default\"])(this, RangeSlider);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"state\", {\n        value0: 0,\n        value1: 1,\n        prevValue0: 0,\n        prevValue1: 1,\n        width: 288\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"sliderContainer\", null);\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"setSliderContainer\", function (element) {\n        _this.sliderContainer = element;\n        _this._resize();\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"inputValue0\", /*#__PURE__*/(0, _react.createRef)());\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"inputValue1\", /*#__PURE__*/(0, _react.createRef)());\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"value0Selector\", function (props) {\n        return props.value0;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"value1Selector\", function (props) {\n        return props.value1;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"filterValueSelector\", (0, _reselect.createSelector)(_this.value0Selector, _this.value1Selector, function (value0, value1) {\n        return [value0, value1];\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_roundValToStep\", function (val) {\n        var _this$props = _this.props,\n          range = _this$props.range,\n          step = _this$props.step;\n        return (0, _dataUtils.roundValToStep)(range[0], step, val);\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_setRangeVal1\", function (val) {\n        var _this$props2 = _this.props,\n          value0 = _this$props2.value0,\n          range = _this$props2.range,\n          onChange = _this$props2.onChange;\n        var val1 = Number(val);\n        onChange([value0, (0, _dataUtils.clamp)([value0, range[1]], _this._roundValToStep(val1))]);\n        return true;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_setRangeVal0\", function (val) {\n        var _this$props3 = _this.props,\n          value1 = _this$props3.value1,\n          range = _this$props3.range,\n          onChange = _this$props3.onChange;\n        var val0 = Number(val);\n        onChange([(0, _dataUtils.clamp)([range[0], value1], _this._roundValToStep(val0)), value1]);\n        return true;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_resize\", function () {\n        if (_this.sliderContainer) {\n          var width = _this.sliderContainer.offsetWidth;\n          if (width !== _this.state.width) {\n            _this.setState({\n              width: width\n            });\n          }\n        }\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_onChangeInput\", function (key, e) {\n        _this.setState((0, _defineProperty2[\"default\"])({}, key, e.target.value));\n      });\n      return _this;\n    }\n    (0, _createClass2[\"default\"])(RangeSlider, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        if (this.sliderContainer instanceof Element) {\n          (0, _observeDimensions.observeDimensions)(this.sliderContainer, this._resize);\n        }\n      }\n    }, {\n      key: \"componentDidUpdate\",\n      value: function componentDidUpdate() {\n        this._resize();\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        if (this.sliderContainer instanceof Element) {\n          (0, _observeDimensions.unobserveDimensions)(this.sliderContainer);\n        }\n      }\n    }, {\n      key: \"_renderInput\",\n      value: function _renderInput(key) {\n        var _this2 = this;\n        var setRange = key === 'value0' ? this._setRangeVal0 : this._setRangeVal1;\n        var ref = key === 'value0' ? this.inputValue0 : this.inputValue1;\n        var update = function update(e) {\n          if (!setRange(e.target.value)) {\n            _this2.setState((0, _defineProperty2[\"default\"])({}, key, _this2.state[key]));\n          }\n        };\n        var onChange = this._onChangeInput.bind(this, key);\n        return /*#__PURE__*/_react[\"default\"].createElement(SliderInput, {\n          className: \"kg-range-slider__input\",\n          type: \"number\",\n          ref: ref,\n          id: \"slider-input-\".concat(key),\n          key: key,\n          value: this.state[key],\n          onChange: onChange,\n          onKeyPress: function onKeyPress(e) {\n            if (e.key === 'Enter') {\n              update(e);\n              ref.current.blur();\n            }\n          },\n          onBlur: update,\n          flush: key === 'value0',\n          size: this.props.inputSize,\n          secondary: this.props.inputTheme === 'secondary'\n        });\n      } // eslint-disable-next-line complexity\n    }, {\n      key: \"render\",\n      value: function render() {\n        var _this$props4 = this.props,\n          isRanged = _this$props4.isRanged,\n          showInput = _this$props4.showInput,\n          histogram = _this$props4.histogram,\n          lineChart = _this$props4.lineChart,\n          range = _this$props4.range,\n          onChange = _this$props4.onChange,\n          sliderHandleWidth = _this$props4.sliderHandleWidth,\n          step = _this$props4.step,\n          timezone = _this$props4.timezone,\n          timeFormat = _this$props4.timeFormat,\n          playbackControlWidth = _this$props4.playbackControlWidth;\n        var width = this.state.width;\n        var plotWidth = Math.max(width - sliderHandleWidth, 0);\n        var renderPlot = histogram && histogram.length || lineChart;\n        return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n          className: \"kg-range-slider\",\n          style: {\n            width: '100%',\n            padding: \"0 \".concat(sliderHandleWidth / 2, \"px\")\n          },\n          ref: this.setSliderContainer\n        }, Array.isArray(range) && range.every(Number.isFinite) && /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, renderPlot ? /*#__PURE__*/_react[\"default\"].createElement(RangePlot, {\n          histogram: histogram,\n          lineChart: this.props.lineChart,\n          plotType: this.props.plotType,\n          isEnlarged: this.props.isEnlarged,\n          onBrush: function onBrush(val0, val1) {\n            return onChange([val0, val1]);\n          },\n          marks: this.props.marks,\n          range: range,\n          value: this.props.plotValue || this.filterValueSelector(this.props),\n          width: plotWidth,\n          isRanged: isRanged,\n          step: step,\n          timezone: timezone,\n          timeFormat: timeFormat,\n          playbackControlWidth: playbackControlWidth\n        }) : null, /*#__PURE__*/_react[\"default\"].createElement(SliderWrapper, {\n          className: \"kg-range-slider__slider\",\n          isRanged: isRanged,\n          showInput: showInput\n        }, this.props.xAxis ? /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n          style: {\n            height: '30px'\n          }\n        }, /*#__PURE__*/_react[\"default\"].createElement(this.props.xAxis, {\n          width: plotWidth,\n          timezone: timezone,\n          domain: range,\n          isEnlarged: this.props.isEnlarged\n        })) : null, /*#__PURE__*/_react[\"default\"].createElement(_slider[\"default\"], {\n          marks: this.props.marks,\n          showValues: false,\n          isRanged: isRanged,\n          minValue: range[0],\n          maxValue: range[1],\n          value0: this.props.value0,\n          value1: this.props.value1,\n          step: step,\n          handleWidth: sliderHandleWidth,\n          onSlider0Change: this._setRangeVal0,\n          onSlider1Change: this._setRangeVal1,\n          onSliderBarChange: function onSliderBarChange(val0, val1) {\n            onChange([val0, val1]);\n          },\n          enableBarDrag: true\n        }), !isRanged && showInput ? this._renderInput('value1') : null), isRanged && showInput ? /*#__PURE__*/_react[\"default\"].createElement(RangeInputWrapper, {\n          className: \"range-slider__input-group\"\n        }, this._renderInput('value0'), this._renderInput('value1')) : null));\n      }\n    }], [{\n      key: \"getDerivedStateFromProps\",\n      value: function getDerivedStateFromProps(props, state) {\n        var update = null;\n        var value0 = props.value0,\n          value1 = props.value1;\n        if (props.value0 !== state.prevValue0 && !isNaN(value0)) {\n          update = _objectSpread(_objectSpread({}, update || {}), {}, {\n            value0: value0,\n            prevValue0: value0\n          });\n        }\n        if (props.value1 !== state.prevValue1 && !isNaN(value1)) {\n          update = _objectSpread(_objectSpread({}, update || {}), {}, {\n            value1: value1,\n            prevValue1: value1\n          });\n        }\n        return update;\n      }\n    }]);\n    return RangeSlider;\n  }(_react.Component);\n  (0, _defineProperty2[\"default\"])(RangeSlider, \"propTypes\", {\n    range: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].number),\n    value0: _propTypes[\"default\"].number.isRequired,\n    value1: _propTypes[\"default\"].number.isRequired,\n    onChange: _propTypes[\"default\"].func.isRequired,\n    histogram: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].any),\n    isRanged: _propTypes[\"default\"].bool,\n    isEnlarged: _propTypes[\"default\"].bool,\n    showInput: _propTypes[\"default\"].bool,\n    inputTheme: _propTypes[\"default\"].string,\n    inputSize: _propTypes[\"default\"].string,\n    step: _propTypes[\"default\"].number,\n    sliderHandleWidth: _propTypes[\"default\"].number,\n    xAxis: _propTypes[\"default\"].elementType\n  });\n  (0, _defineProperty2[\"default\"])(RangeSlider, \"defaultProps\", {\n    isEnlarged: false,\n    isRanged: true,\n    showInput: true,\n    sliderHandleWidth: 12,\n    inputTheme: '',\n    inputSize: 'small',\n    onChange: function onChange() {}\n  });\n  (0, _reactLifecyclesCompat.polyfill)(RangeSlider);\n  return RangeSlider;\n}","map":{"version":3,"sources":["../../../src/components/common/range-slider.js"],"names":["SliderInput","Input","props","theme","sliderInputWidth","flush","size","sliderInputFontSize","sliderInputPadding","SliderWrapper","styled","div","isRanged","showInput","RangeInputWrapper","RangeSliderFactory","deps","RangePlotFactory","RangePlot","RangeSlider","Component","range","PropTypes","arrayOf","number","value0","isRequired","value1","onChange","func","histogram","any","bool","isEnlarged","inputTheme","string","inputSize","step","sliderHandleWidth","xAxis","elementType","state","update","prevValue0","isNaN","prevValue1","width","sliderContainer","Element","_resize","element","value0Selector","value1Selector","val","val1","Number","_roundValToStep","val0","offsetWidth","setState","key","e","target","value","setRange","_setRangeVal0","_setRangeVal1","ref","inputValue0","inputValue1","_onChangeInput","bind","current","blur","lineChart","timezone","timeFormat","playbackControlWidth","plotWidth","Math","max","renderPlot","length","padding","setSliderContainer","Array","isArray","every","isFinite","plotType","marks","plotValue","filterValueSelector","height","_renderInput"],"mappings":";;;;;;;;;;;;;;;;AAoBA,IAAA,MAAA,GAAA,uBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,CAAA;AACA,IAAA,sBAAA,GAAA,OAAA,CAAA,yBAAA,CAAA;AACA,IAAA,SAAA,GAAA,OAAA,CAAA,UAAA,CAAA;AACA,IAAA,UAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,YAAA,CAAA,CAAA;AACA,IAAA,iBAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,mBAAA,CAAA,CAAA;AACA,IAAA,UAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,cAAA,CAAA,CAAA;AACA,IAAA,OAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,iBAAA,CAAA,CAAA;AACA,IAAA,kBAAA,GAAA,OAAA,CAAA,qBAAA,CAAA;AAEA,IAAA,UAAA,GAAA,OAAA,CAAA,wBAAA,CAAA;AACA,IAAA,kBAAA,GAAA,OAAA,CAAA,gCAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,WAAW,GAAG,CAAA,CAAA,EAAA,iBAAA,CAAA,SAAA,CAAA,EAAOC,kBAAAA,CAAAA,KAAP,CAAH,CAAA,eAAA,KAAA,eAAA,GAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,aAAA,EAAA,sBAAA,EAAA,oBAAA,EAAA,iCAAA,EAAA,8BAAA,CAAA,CAAA,CAAA,EACN,UAAA,KAAK,EAAA;EAAA,OAAIC,KAAK,CAACC,KAAND,CAAYE,gBAAhB;AAAA,CADC,EAEA,UAAA,KAAK,EAAA;EAAA,OAAKF,KAAK,CAACG,KAANH,GAAc,CAAdA,GAAkBA,KAAK,CAACI,IAANJ,KAAe,MAAfA,GAAwB,EAAxBA,GAA6B,EAApD;AAAA,CAFL,EAGF,UAAA,KAAK,EAAA;EAAA,OAAIA,KAAK,CAACC,KAAND,CAAYK,mBAAhB;AAAA,CAHH,EAIJ,UAAA,KAAK,EAAA;EAAA,OAAIL,KAAK,CAACC,KAAND,CAAYM,kBAAhB;AAAA,CAJD,CAAjB;AAOA,IAAMC,aAAa,GAAGC,iBAAAA,CAAAA,SAAAA,CAAAA,CAAOC,GAAV,CAAA,gBAAA,KAAA,gBAAA,GAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,4DAAA,EAAA,KAAA,CAAA,CAAA,CAAA,EAGF,UAAA,KAAK,EAAA;EAAA,OAAK,CAACT,KAAK,CAACU,QAAP,IAAmBV,KAAK,CAACW,SAAzB,GAAqC,QAArC,GAAgD,YAArD;AAAA,CAHH,CAAnB;AAMA,IAAMC,iBAAiB,GAAGJ,iBAAAA,CAAAA,SAAAA,CAAAA,CAAOC,GAAV,CAAA,gBAAA,KAAA,gBAAA,GAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,8EAAA,CAAA,CAAA,CAAA,CAAvB;AAMAI,kBAAkB,CAACC,IAAnBD,GAA0B,CAACE,UAAAA,CAAAA,SAAAA,CAAD,CAA1BF;AAEe,SAASA,kBAAT,CAA4BG,SAA5B,EAAuC;EAAA,IAC9CC,WAD8C,GAAA,aAAA,UAAA,UAAA,EAAA;IAAA,CAAA,CAAA,EAAA,UAAA,CAAA,SAAA,CAAA,EAAA,WAAA,EAAA,UAAA,CAAA;IAAA,IAAA,MAAA,GAAA,YAAA,CAAA,WAAA,CAAA;IAAA,SAAA,WAAA,GAAA;MAAA,IAAA,KAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,IAAA,EAAA,WAAA,CAAA;MAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAAA,IAAA,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;QAAA,IAAA,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA;MAAA;MAAA,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,KAAA,CAAA,MAAA,EAAA,CAAA,IAAA,CAAA,CAAA,MAAA,CAAA,IAAA,CAAA,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,OAAA,EAwC1C;QACNM,MAAM,EAAE,CADF;QAENE,MAAM,EAAE,CAFF;QAGNgB,UAAU,EAAE,CAHN;QAINE,UAAU,EAAE,CAJN;QAKNC,KAAK,EAAE;MALD,CAxC0C,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,iBAAA,EAgEhC,IAhEgC,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,oBAAA,EAiE7B,UAAA,OAAO,EAAI;QAC9B,KAAA,CAAKC,eAAL,GAAuBG,OAAvB;QACA,KAAA,CAAKD,OAAL,EAAA;MACD,CApEiD,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,aAAA,EAAA,aAqEpC,CAAA,CAAA,EAAA,MAAA,CAAA,SAAA,GArEoC,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,aAAA,EAAA,aAsEpC,CAAA,CAAA,EAAA,MAAA,CAAA,SAAA,GAtEoC,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,gBAAA,EAuEjC,UAAA,KAAK,EAAA;QAAA,OAAI/C,KAAK,CAACuB,MAAV;MAAA,CAvE4B,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,gBAAA,EAwEjC,UAAA,KAAK,EAAA;QAAA,OAAIvB,KAAK,CAACyB,MAAV;MAAA,CAxE4B,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,qBAAA,EAyE5B,CAAA,CAAA,EAAA,SAAA,CAAA,cAAA,EACpB,KAAA,CAAKwB,cADe,EAEpB,KAAA,CAAKC,cAFe,EAGpB,UAAC3B,MAAD,EAASE,MAAT,EAAA;QAAA,OAAoB,CAACF,MAAD,EAASE,MAAT,CAApB;MAAA,CAHoB,CAzE4B,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,iBAAA,EA+EhC,UAAA,GAAG,EAAI;QAAA,IAAA,WAAA,GACD,KAAA,CAAKzB,KADJ;UAChBmB,KADgB,GAAA,WAAA,CAChBA,KADgB;UACTgB,IADS,GAAA,WAAA,CACTA,IADS;QAGvB,OAAO,CAAA,CAAA,EAAA,UAAA,CAAA,cAAA,EAAehB,KAAK,CAAC,CAAD,CAApB,EAAyBgB,IAAzB,EAA+BgB,GAA/B,CAAP;MACD,CAnFiD,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,eAAA,EAqFlC,UAAA,GAAG,EAAI;QAAA,IAAA,YAAA,GACa,KAAA,CAAKnD,KADlB;UACduB,MADc,GAAA,YAAA,CACdA,MADc;UACNJ,KADM,GAAA,YAAA,CACNA,KADM;UACCO,QADD,GAAA,YAAA,CACCA,QADD;QAErB,IAAM0B,IAAI,GAAGC,MAAM,CAACF,GAAD,CAAnB;QACAzB,QAAQ,CAAC,CAACH,MAAD,EAAS,CAAA,CAAA,EAAA,UAAA,CAAA,KAAA,EAAM,CAACA,MAAD,EAASJ,KAAK,CAAC,CAAD,CAAd,CAAN,EAA0B,KAAA,CAAKmC,eAAL,CAAqBF,IAArB,CAA1B,CAAT,CAAD,CAAR1B;QACA,OAAO,IAAP;MACD,CA1FiD,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,eAAA,EA4FlC,UAAA,GAAG,EAAI;QAAA,IAAA,YAAA,GACa,KAAA,CAAK1B,KADlB;UACdyB,MADc,GAAA,YAAA,CACdA,MADc;UACNN,KADM,GAAA,YAAA,CACNA,KADM;UACCO,QADD,GAAA,YAAA,CACCA,QADD;QAErB,IAAM6B,IAAI,GAAGF,MAAM,CAACF,GAAD,CAAnB;QACAzB,QAAQ,CAAC,CAAC,CAAA,CAAA,EAAA,UAAA,CAAA,KAAA,EAAM,CAACP,KAAK,CAAC,CAAD,CAAN,EAAWM,MAAX,CAAN,EAA0B,KAAA,CAAK6B,eAAL,CAAqBC,IAArB,CAA1B,CAAD,EAAwD9B,MAAxD,CAAD,CAARC;QACA,OAAO,IAAP;MACD,CAjGiD,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,SAAA,EAmGxC,YAAM;QACd,IAAI,KAAA,CAAKmB,eAAT,EAA0B;UACxB,IAAMD,KAAK,GAAG,KAAA,CAAKC,eAAL,CAAqBW,WAAnC;UACA,IAAIZ,KAAK,KAAK,KAAA,CAAKL,KAAL,CAAWK,KAAzB,EAAgC;YAC9B,KAAA,CAAKa,QAAL,CAAc;cAACb,KAAK,EAALA;YAAD,CAAd,CAAA;UACD;QACF;MACF,CA1GiD,CAAA;MAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,uBAAA,CAAA,SAAA,CAAA,EAAA,KAAA,CAAA,EAAA,gBAAA,EA4GjC,UAACc,GAAD,EAAMC,CAAN,EAAY;QAC3B,KAAA,CAAKF,QAAL,CAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAgBC,GAAhB,EAAsBC,CAAC,CAACC,MAAFD,CAASE,KAA/B,CAAA,CAAA;MACD,CA9GiD,CAAA;MAAA,OAAA,KAAA;IAAA;IAAA,CAAA,CAAA,EAAA,aAAA,CAAA,SAAA,CAAA,EAAA,WAAA,EAAA,CAAA;MAAA,GAAA,EAAA,mBAAA;MAAA,KAAA,EAgDlD,SAAA,iBAAA,GAAoB;QAClB,IAAI,IAAA,CAAKhB,eAAL,YAAgCC,OAApC,EAA6C;UAC3C,CAAA,CAAA,EAAA,kBAAA,CAAA,iBAAA,EAAkB,IAAA,CAAKD,eAAvB,EAAwC,IAAA,CAAKE,OAA7C,CAAA;QACD;MACF;IApDiD,CAAA,EAAA;MAAA,GAAA,EAAA,oBAAA;MAAA,KAAA,EAsDlD,SAAA,kBAAA,GAAqB;QACnB,IAAA,CAAKA,OAAL,EAAA;MACD;IAxDiD,CAAA,EAAA;MAAA,GAAA,EAAA,sBAAA;MAAA,KAAA,EA0DlD,SAAA,oBAAA,GAAuB;QACrB,IAAI,IAAA,CAAKF,eAAL,YAAgCC,OAApC,EAA6C;UAC3C,CAAA,CAAA,EAAA,kBAAA,CAAA,mBAAA,EAAoB,IAAA,CAAKD,eAAzB,CAAA;QACD;MACF;IA9DiD,CAAA,EAAA;MAAA,GAAA,EAAA,cAAA;MAAA,KAAA,EAgHlD,SAAA,YAAA,CAAaa,GAAb,EAAkB;QAAA,IAAA,MAAA,GAAA,IAAA;QAChB,IAAMI,QAAQ,GAAGJ,GAAG,KAAK,QAARA,GAAmB,IAAA,CAAKK,aAAxBL,GAAwC,IAAA,CAAKM,aAA9D;QACA,IAAMC,GAAG,GAAGP,GAAG,KAAK,QAARA,GAAmB,IAAA,CAAKQ,WAAxBR,GAAsC,IAAA,CAAKS,WAAvD;QACA,IAAM3B,MAAM,GAAG,SAATA,MAAS,CAAA,CAAC,EAAI;UAClB,IAAI,CAACsB,QAAQ,CAACH,CAAC,CAACC,MAAFD,CAASE,KAAV,CAAb,EAA+B;YAC7B,MAAI,CAACJ,QAAL,CAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAgBC,GAAhB,EAAsB,MAAI,CAACnB,KAAL,CAAWmB,GAAX,CAAtB,CAAA,CAAA;UACD;QACF,CAJD;QAMA,IAAMhC,QAAQ,GAAG,IAAA,CAAK0C,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,EAA+BX,GAA/B,CAAjB;QAEA,OAAA,aACE,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAC,WAAD,EAAA;UACE,SAAS,EAAC,wBADZ;UAEE,IAAI,EAAC,QAFP;UAGE,GAAG,EAAEO,GAHP;UAIE,EAAE,EAAA,eAAA,CAAA,MAAA,CAAkBP,GAAlB,CAJJ;UAKE,GAAG,EAAEA,GALP;UAME,KAAK,EAAE,IAAA,CAAKnB,KAAL,CAAWmB,GAAX,CANT;UAOE,QAAQ,EAAEhC,QAPZ;UAQE,UAAU,EAAE,SAAA,UAAA,CAAA,CAAC,EAAI;YACf,IAAIiC,CAAC,CAACD,GAAFC,KAAU,OAAd,EAAuB;cACrBnB,MAAM,CAACmB,CAAD,CAANnB;cACAyB,GAAG,CAACK,OAAJL,CAAYM,IAAZN,EAAAA;YACD;UACF,CAbH;UAcE,MAAM,EAAEzB,MAdV;UAeE,KAAK,EAAEkB,GAAG,KAAK,QAfjB;UAgBE,IAAI,EAAE,IAAA,CAAK1D,KAAL,CAAWkC,SAhBnB;UAiBE,SAAS,EAAE,IAAA,CAAKlC,KAAL,CAAWgC,UAAX,KAA0B;QAjBvC,CAAA,CADF;MAqBD,CAhJiD,CAkJlD;IAlJkD,CAAA,EAAA;MAAA,GAAA,EAAA,QAAA;MAAA,KAAA,EAmJlD,SAAA,MAAA,GAAS;QAAA,IAAA,YAAA,GAaH,IAAA,CAAKhC,KAbF;UAELU,QAFK,GAAA,YAAA,CAELA,QAFK;UAGLC,SAHK,GAAA,YAAA,CAGLA,SAHK;UAILiB,SAJK,GAAA,YAAA,CAILA,SAJK;UAKL4C,SALK,GAAA,YAAA,CAKLA,SALK;UAMLrD,KANK,GAAA,YAAA,CAMLA,KANK;UAOLO,QAPK,GAAA,YAAA,CAOLA,QAPK;UAQLU,iBARK,GAAA,YAAA,CAQLA,iBARK;UASLD,IATK,GAAA,YAAA,CASLA,IATK;UAULsC,QAVK,GAAA,YAAA,CAULA,QAVK;UAWLC,UAXK,GAAA,YAAA,CAWLA,UAXK;UAYLC,oBAZK,GAAA,YAAA,CAYLA,oBAZK;QAAA,IAeA/B,KAfA,GAeS,IAAA,CAAKL,KAfd,CAeAK,KAfA;QAgBP,IAAMgC,SAAS,GAAGC,IAAI,CAACC,GAALD,CAASjC,KAAK,GAAGR,iBAAjByC,EAAoC,CAApCA,CAAlB;QACA,IAAME,UAAU,GAAInD,SAAS,IAAIA,SAAS,CAACoD,MAAxB,IAAmCR,SAAtD;QACA,OAAA,aACE,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAA,KAAA,EAAA;UACE,SAAS,EAAC,iBADZ;UAEE,KAAK,EAAE;YAAC5B,KAAK,EAAE,MAAR;YAAgBqC,OAAO,EAAA,IAAA,CAAA,MAAA,CAAO7C,iBAAiB,GAAG,CAA3B,EAAA,IAAA;UAAvB,CAFT;UAGE,GAAG,EAAE,IAAA,CAAK8C;QAHZ,CAAA,EAKGC,KAAK,CAACC,OAAND,CAAchE,KAAdgE,CAAAA,IAAwBhE,KAAK,CAACkE,KAANlE,CAAYkC,MAAM,CAACiC,QAAnBnE,CAAxBgE,IAAAA,aACC,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAA,MAAA,CAAA,SAAA,CAAA,CAAA,QAAA,EAAA,IAAA,EACGJ,UAAU,GAAA,aACT,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAC,SAAD,EAAA;UACE,SAAS,EAAEnD,SADb;UAEE,SAAS,EAAE,IAAA,CAAK5B,KAAL,CAAWwE,SAFxB;UAGE,QAAQ,EAAE,IAAA,CAAKxE,KAAL,CAAWuF,QAHvB;UAIE,UAAU,EAAE,IAAA,CAAKvF,KAAL,CAAW+B,UAJzB;UAKE,OAAO,EAAE,SAAA,OAAA,CAACwB,IAAD,EAAOH,IAAP,EAAA;YAAA,OAAgB1B,QAAQ,CAAC,CAAC6B,IAAD,EAAOH,IAAP,CAAD,CAAxB;UAAA,CALX;UAME,KAAK,EAAE,IAAA,CAAKpD,KAAL,CAAWwF,KANpB;UAOE,KAAK,EAAErE,KAPT;UAQE,KAAK,EAAE,IAAA,CAAKnB,KAAL,CAAWyF,SAAX,IAAwB,IAAA,CAAKC,mBAAL,CAAyB,IAAA,CAAK1F,KAA9B,CARjC;UASE,KAAK,EAAE4E,SATT;UAUE,QAAQ,EAAElE,QAVZ;UAWE,IAAI,EAAEyB,IAXR;UAYE,QAAQ,EAAEsC,QAZZ;UAaE,UAAU,EAAEC,UAbd;UAcE,oBAAoB,EAAEC;QAdxB,CAAA,CADS,GAiBP,IAlBN,EAAA,aAmBE,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAC,aAAD,EAAA;UACE,SAAS,EAAC,yBADZ;UAEE,QAAQ,EAAEjE,QAFZ;UAGE,SAAS,EAAEC;QAHb,CAAA,EAKG,IAAA,CAAKX,KAAL,CAAWqC,KAAX,GAAA,aACC,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAA,KAAA,EAAA;UAAK,KAAK,EAAE;YAACsD,MAAM,EAAE;UAAT;QAAZ,CAAA,EAAA,aACE,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAA,IAAA,CAAM,KAAN,CAAY,KAAZ,EAAA;UACE,KAAK,EAAEf,SADT;UAEE,QAAQ,EAAEH,QAFZ;UAGE,MAAM,EAAEtD,KAHV;UAIE,UAAU,EAAE,IAAA,CAAKnB,KAAL,CAAW+B;QAJzB,CAAA,CADF,CADD,GASG,IAdN,EAAA,aAeE,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAC,OAAA,CAAA,SAAA,CAAD,EAAA;UACE,KAAK,EAAE,IAAA,CAAK/B,KAAL,CAAWwF,KADpB;UAEE,UAAU,EAAE,KAFd;UAGE,QAAQ,EAAE9E,QAHZ;UAIE,QAAQ,EAAES,KAAK,CAAC,CAAD,CAJjB;UAKE,QAAQ,EAAEA,KAAK,CAAC,CAAD,CALjB;UAME,MAAM,EAAE,IAAA,CAAKnB,KAAL,CAAWuB,MANrB;UAOE,MAAM,EAAE,IAAA,CAAKvB,KAAL,CAAWyB,MAPrB;UAQE,IAAI,EAAEU,IARR;UASE,WAAW,EAAEC,iBATf;UAUE,eAAe,EAAE,IAAA,CAAK2B,aAVxB;UAWE,eAAe,EAAE,IAAA,CAAKC,aAXxB;UAYE,iBAAiB,EAAE,SAAA,iBAAA,CAACT,IAAD,EAAOH,IAAP,EAAgB;YACjC1B,QAAQ,CAAC,CAAC6B,IAAD,EAAOH,IAAP,CAAD,CAAR1B;UACD,CAdH;UAeE,aAAa,EAAA;QAff,CAAA,CAfF,EAgCG,CAAChB,QAAD,IAAaC,SAAb,GAAyB,IAAA,CAAKiF,YAAL,CAAkB,QAAlB,CAAzB,GAAuD,IAhC1D,CAnBF,EAqDG,QAAQ,IAAIjF,SAAZ,GAAA,aACC,MAAA,CAAA,SAAA,CAAA,CAAA,aAAA,CAAC,iBAAD,EAAA;UAAmB,SAAS,EAAC;QAA7B,CAAA,EACG,IAAA,CAAKiF,YAAL,CAAkB,QAAlB,CADH,EAEG,IAAA,CAAKA,YAAL,CAAkB,QAAlB,CAFH,CADD,GAKG,IA1DN,CANJ,CADF;MAsED;IA3OiD,CAAA,CAAA,EAAA,CAAA;MAAA,GAAA,EAAA,0BAAA;MAAA,KAAA,EA4BlD,SAAA,wBAAA,CAAgC5F,KAAhC,EAAuCuC,KAAvC,EAA8C;QAC5C,IAAIC,MAAM,GAAG,IAAb;QAD4C,IAErCjB,MAFqC,GAEnBvB,KAFmB,CAErCuB,MAFqC;UAE7BE,MAF6B,GAEnBzB,KAFmB,CAE7ByB,MAF6B;QAG5C,IAAIzB,KAAK,CAACuB,MAANvB,KAAiBuC,KAAK,CAACE,UAAvBzC,IAAqC,CAAC0C,KAAK,CAACnB,MAAD,CAA/C,EAAyD;UACvDiB,MAAM,GAAA,aAAA,CAAA,aAAA,CAAA,CAAA,CAAA,EAAQA,MAAM,IAAI,CAAA,CAAlB,CAAA,EAAA,CAAA,CAAA,EAAA;YAAuBjB,MAAM,EAANA,MAAvB;YAA+BkB,UAAU,EAAElB;UAA3C,CAAA,CAANiB;QACD;QACD,IAAIxC,KAAK,CAACyB,MAANzB,KAAiBuC,KAAK,CAACI,UAAvB3C,IAAqC,CAAC0C,KAAK,CAACjB,MAAD,CAA/C,EAAyD;UACvDe,MAAM,GAAA,aAAA,CAAA,aAAA,CAAA,CAAA,CAAA,EAAQA,MAAM,IAAI,CAAA,CAAlB,CAAA,EAAA,CAAA,CAAA,EAAA;YAAuBf,MAAM,EAANA,MAAvB;YAA+BkB,UAAU,EAAElB;UAA3C,CAAA,CAANe;QACD;QACD,OAAOA,MAAP;MACD;IAtCiD,CAAA,CAAA,CAAA;IAAA,OAAA,WAAA;EAAA,CAAA,CAC1BtB,MAAAA,CAAAA,SAD0B,CAAA;EAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAC9CD,WAD8C,EAAA,WAAA,EAE/B;IACjBE,KAAK,EAAEC,UAAAA,CAAAA,SAAAA,CAAAA,CAAUC,OAAVD,CAAkBA,UAAAA,CAAAA,SAAAA,CAAAA,CAAUE,MAA5BF,CADU;IAEjBG,MAAM,EAAEH,UAAAA,CAAAA,SAAAA,CAAAA,CAAUE,MAAVF,CAAiBI,UAFR;IAGjBC,MAAM,EAAEL,UAAAA,CAAAA,SAAAA,CAAAA,CAAUE,MAAVF,CAAiBI,UAHR;IAIjBE,QAAQ,EAAEN,UAAAA,CAAAA,SAAAA,CAAAA,CAAUO,IAAVP,CAAeI,UAJR;IAKjBI,SAAS,EAAER,UAAAA,CAAAA,SAAAA,CAAAA,CAAUC,OAAVD,CAAkBA,UAAAA,CAAAA,SAAAA,CAAAA,CAAUS,GAA5BT,CALM;IAMjBV,QAAQ,EAAEU,UAAAA,CAAAA,SAAAA,CAAAA,CAAUU,IANH;IAOjBC,UAAU,EAAEX,UAAAA,CAAAA,SAAAA,CAAAA,CAAUU,IAPL;IAQjBnB,SAAS,EAAES,UAAAA,CAAAA,SAAAA,CAAAA,CAAUU,IARJ;IASjBE,UAAU,EAAEZ,UAAAA,CAAAA,SAAAA,CAAAA,CAAUa,MATL;IAUjBC,SAAS,EAAEd,UAAAA,CAAAA,SAAAA,CAAAA,CAAUa,MAVJ;IAWjBE,IAAI,EAAEf,UAAAA,CAAAA,SAAAA,CAAAA,CAAUE,MAXC;IAYjBc,iBAAiB,EAAEhB,UAAAA,CAAAA,SAAAA,CAAAA,CAAUE,MAZZ;IAajBe,KAAK,EAAEjB,UAAAA,CAAAA,SAAAA,CAAAA,CAAUkB;EAbA,CAF+B,CAAA;EAAA,CAAA,CAAA,EAAA,gBAAA,CAAA,SAAA,CAAA,EAC9CrB,WAD8C,EAAA,cAAA,EAkB5B;IACpBc,UAAU,EAAE,KADQ;IAEpBrB,QAAQ,EAAE,IAFU;IAGpBC,SAAS,EAAE,IAHS;IAIpByB,iBAAiB,EAAE,EAJC;IAKpBJ,UAAU,EAAE,EALQ;IAMpBE,SAAS,EAAE,OANS;IAOpBR,QAAQ,EAAE,SAAA,QAAA,GAAM,CAAE;EAPE,CAlB4B,CAAA;EA8OpD,CAAA,CAAA,EAAA,sBAAA,CAAA,QAAA,EAAST,WAAT,CAAA;EAEA,OAAOA,WAAP;AACD","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {Component, createRef} from 'react';\nimport {polyfill} from 'react-lifecycles-compat';\nimport {createSelector} from 'reselect';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport RangePlotFactory from './range-plot';\nimport Slider from 'components/common/slider/slider';\nimport {Input} from 'components/common/styled-components';\n\nimport {roundValToStep, clamp} from 'utils/data-utils';\nimport {observeDimensions, unobserveDimensions} from '../../utils/observe-dimensions';\n\nconst SliderInput = styled(Input)`\n  width: ${props => props.theme.sliderInputWidth}px;\n  margin-left: ${props => (props.flush ? 0 : props.size === 'tiny' ? 12 : 18)}px;\n  font-size: ${props => props.theme.sliderInputFontSize}; // 10px // 12px;\n  padding: ${props => props.theme.sliderInputPadding}; // 4px 6px; // 6px 12px;\n`;\n\nconst SliderWrapper = styled.div`\n  display: flex;\n  position: relative;\n  align-items: ${props => (!props.isRanged && props.showInput ? 'center' : 'flex-start')};\n`;\n\nconst RangeInputWrapper = styled.div`\n  margin-top: 12px;\n  display: flex;\n  justify-content: space-between;\n`;\n\nRangeSliderFactory.deps = [RangePlotFactory];\n\nexport default function RangeSliderFactory(RangePlot) {\n  class RangeSlider extends Component {\n    static propTypes = {\n      range: PropTypes.arrayOf(PropTypes.number),\n      value0: PropTypes.number.isRequired,\n      value1: PropTypes.number.isRequired,\n      onChange: PropTypes.func.isRequired,\n      histogram: PropTypes.arrayOf(PropTypes.any),\n      isRanged: PropTypes.bool,\n      isEnlarged: PropTypes.bool,\n      showInput: PropTypes.bool,\n      inputTheme: PropTypes.string,\n      inputSize: PropTypes.string,\n      step: PropTypes.number,\n      sliderHandleWidth: PropTypes.number,\n      xAxis: PropTypes.elementType\n    };\n\n    static defaultProps = {\n      isEnlarged: false,\n      isRanged: true,\n      showInput: true,\n      sliderHandleWidth: 12,\n      inputTheme: '',\n      inputSize: 'small',\n      onChange: () => {}\n    };\n\n    static getDerivedStateFromProps(props, state) {\n      let update = null;\n      const {value0, value1} = props;\n      if (props.value0 !== state.prevValue0 && !isNaN(value0)) {\n        update = {...(update || {}), value0, prevValue0: value0};\n      }\n      if (props.value1 !== state.prevValue1 && !isNaN(value1)) {\n        update = {...(update || {}), value1, prevValue1: value1};\n      }\n      return update;\n    }\n\n    state = {\n      value0: 0,\n      value1: 1,\n      prevValue0: 0,\n      prevValue1: 1,\n      width: 288\n    };\n\n    componentDidMount() {\n      if (this.sliderContainer instanceof Element) {\n        observeDimensions(this.sliderContainer, this._resize);\n      }\n    }\n\n    componentDidUpdate() {\n      this._resize();\n    }\n\n    componentWillUnmount() {\n      if (this.sliderContainer instanceof Element) {\n        unobserveDimensions(this.sliderContainer);\n      }\n    }\n\n    sliderContainer = null;\n    setSliderContainer = element => {\n      this.sliderContainer = element;\n      this._resize();\n    };\n    inputValue0 = createRef();\n    inputValue1 = createRef();\n    value0Selector = props => props.value0;\n    value1Selector = props => props.value1;\n    filterValueSelector = createSelector(\n      this.value0Selector,\n      this.value1Selector,\n      (value0, value1) => [value0, value1]\n    );\n\n    _roundValToStep = val => {\n      const {range, step} = this.props;\n\n      return roundValToStep(range[0], step, val);\n    };\n\n    _setRangeVal1 = val => {\n      const {value0, range, onChange} = this.props;\n      const val1 = Number(val);\n      onChange([value0, clamp([value0, range[1]], this._roundValToStep(val1))]);\n      return true;\n    };\n\n    _setRangeVal0 = val => {\n      const {value1, range, onChange} = this.props;\n      const val0 = Number(val);\n      onChange([clamp([range[0], value1], this._roundValToStep(val0)), value1]);\n      return true;\n    };\n\n    _resize = () => {\n      if (this.sliderContainer) {\n        const width = this.sliderContainer.offsetWidth;\n        if (width !== this.state.width) {\n          this.setState({width});\n        }\n      }\n    };\n\n    _onChangeInput = (key, e) => {\n      this.setState({[key]: e.target.value});\n    };\n\n    _renderInput(key) {\n      const setRange = key === 'value0' ? this._setRangeVal0 : this._setRangeVal1;\n      const ref = key === 'value0' ? this.inputValue0 : this.inputValue1;\n      const update = e => {\n        if (!setRange(e.target.value)) {\n          this.setState({[key]: this.state[key]});\n        }\n      };\n\n      const onChange = this._onChangeInput.bind(this, key);\n\n      return (\n        <SliderInput\n          className=\"kg-range-slider__input\"\n          type=\"number\"\n          ref={ref}\n          id={`slider-input-${key}`}\n          key={key}\n          value={this.state[key]}\n          onChange={onChange}\n          onKeyPress={e => {\n            if (e.key === 'Enter') {\n              update(e);\n              ref.current.blur();\n            }\n          }}\n          onBlur={update}\n          flush={key === 'value0'}\n          size={this.props.inputSize}\n          secondary={this.props.inputTheme === 'secondary'}\n        />\n      );\n    }\n\n    // eslint-disable-next-line complexity\n    render() {\n      const {\n        isRanged,\n        showInput,\n        histogram,\n        lineChart,\n        range,\n        onChange,\n        sliderHandleWidth,\n        step,\n        timezone,\n        timeFormat,\n        playbackControlWidth\n      } = this.props;\n\n      const {width} = this.state;\n      const plotWidth = Math.max(width - sliderHandleWidth, 0);\n      const renderPlot = (histogram && histogram.length) || lineChart;\n      return (\n        <div\n          className=\"kg-range-slider\"\n          style={{width: '100%', padding: `0 ${sliderHandleWidth / 2}px`}}\n          ref={this.setSliderContainer}\n        >\n          {Array.isArray(range) && range.every(Number.isFinite) && (\n            <>\n              {renderPlot ? (\n                <RangePlot\n                  histogram={histogram}\n                  lineChart={this.props.lineChart}\n                  plotType={this.props.plotType}\n                  isEnlarged={this.props.isEnlarged}\n                  onBrush={(val0, val1) => onChange([val0, val1])}\n                  marks={this.props.marks}\n                  range={range}\n                  value={this.props.plotValue || this.filterValueSelector(this.props)}\n                  width={plotWidth}\n                  isRanged={isRanged}\n                  step={step}\n                  timezone={timezone}\n                  timeFormat={timeFormat}\n                  playbackControlWidth={playbackControlWidth}\n                />\n              ) : null}\n              <SliderWrapper\n                className=\"kg-range-slider__slider\"\n                isRanged={isRanged}\n                showInput={showInput}\n              >\n                {this.props.xAxis ? (\n                  <div style={{height: '30px'}}>\n                    <this.props.xAxis\n                      width={plotWidth}\n                      timezone={timezone}\n                      domain={range}\n                      isEnlarged={this.props.isEnlarged}\n                    />\n                  </div>\n                ) : null}\n                <Slider\n                  marks={this.props.marks}\n                  showValues={false}\n                  isRanged={isRanged}\n                  minValue={range[0]}\n                  maxValue={range[1]}\n                  value0={this.props.value0}\n                  value1={this.props.value1}\n                  step={step}\n                  handleWidth={sliderHandleWidth}\n                  onSlider0Change={this._setRangeVal0}\n                  onSlider1Change={this._setRangeVal1}\n                  onSliderBarChange={(val0, val1) => {\n                    onChange([val0, val1]);\n                  }}\n                  enableBarDrag\n                />\n                {!isRanged && showInput ? this._renderInput('value1') : null}\n              </SliderWrapper>\n              {isRanged && showInput ? (\n                <RangeInputWrapper className=\"range-slider__input-group\">\n                  {this._renderInput('value0')}\n                  {this._renderInput('value1')}\n                </RangeInputWrapper>\n              ) : null}\n            </>\n          )}\n        </div>\n      );\n    }\n  }\n\n  polyfill(RangeSlider);\n\n  return RangeSlider;\n}\n"]},"metadata":{},"sourceType":"script"}