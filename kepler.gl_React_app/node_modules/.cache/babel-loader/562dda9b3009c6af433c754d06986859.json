{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AddDataButtonFactory = AddDataButtonFactory;\nexports[\"default\"] = void 0;\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\nvar _taggedTemplateLiteral2 = _interopRequireDefault(require(\"@babel/runtime/helpers/taggedTemplateLiteral\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _classnames = _interopRequireDefault(require(\"classnames\"));\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\nvar _reactSortableHoc = require(\"react-sortable-hoc\");\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\nvar _reselect = require(\"reselect\");\nvar _reactIntl = require(\"react-intl\");\nvar _localization = require(\"../../localization\");\nvar _dataUtils = require(\"../../utils/data-utils\");\nvar _layerPanel = _interopRequireDefault(require(\"./layer-panel/layer-panel\"));\nvar _sourceDataCatalog = _interopRequireDefault(require(\"./common/source-data-catalog\"));\nvar _icons = require(\"../common/icons\");\nvar _itemSelector = _interopRequireDefault(require(\"../common/item-selector/item-selector\"));\nvar _styledComponents2 = require(\"../common/styled-components\");\nvar _defaultSettings = require(\"../../constants/default-settings\");\nvar _templateObject;\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2[\"default\"])(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2[\"default\"])(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return (0, _possibleConstructorReturn2[\"default\"])(this, result);\n  };\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nvar LayerBlendingSelector = function LayerBlendingSelector(_ref) {\n  var layerBlending = _ref.layerBlending,\n    updateLayerBlending = _ref.updateLayerBlending,\n    intl = _ref.intl;\n  var labeledLayerBlendings = Object.keys(_defaultSettings.LAYER_BLENDINGS).reduce(function (acc, current) {\n    return _objectSpread(_objectSpread({}, acc), {}, (0, _defineProperty2[\"default\"])({}, intl.formatMessage({\n      id: _defaultSettings.LAYER_BLENDINGS[current].label\n    }), current));\n  }, {});\n  var onChange = (0, _react.useCallback)(function (blending) {\n    return updateLayerBlending(labeledLayerBlendings[blending]);\n  }, [updateLayerBlending, labeledLayerBlendings]);\n  return /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.SidePanelSection, null, /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.PanelLabel, null, /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n    id: \"layerBlending.title\"\n  })), /*#__PURE__*/_react[\"default\"].createElement(_itemSelector[\"default\"], {\n    selectedItems: intl.formatMessage({\n      id: _defaultSettings.LAYER_BLENDINGS[layerBlending].label\n    }),\n    options: Object.keys(labeledLayerBlendings),\n    multiSelect: false,\n    searchable: false,\n    onChange: onChange\n  }));\n}; // make sure the element is always visible while is being dragged\n// item being dragged is appended in body, here to reset its global style\n\nvar SortableStyledItem = _styledComponents[\"default\"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2[\"default\"])([\"\\n  z-index: \", \";\\n\\n  &.sorting {\\n    pointer-events: none;\\n  }\\n\\n  &.sorting-layers .layer-panel__header {\\n    background-color: \", \";\\n    font-family: \", \";\\n    font-weight: \", \";\\n    font-size: \", \";\\n    line-height: \", \";\\n    *,\\n    *:before,\\n    *:after {\\n      box-sizing: border-box;\\n    }\\n    .layer__drag-handle {\\n      opacity: 1;\\n      color: \", \";\\n    }\\n  }\\n\"])), function (props) {\n  return props.theme.dropdownWrapperZ + 1;\n}, function (props) {\n  return props.theme.panelBackgroundHover;\n}, function (props) {\n  return props.theme.fontFamily;\n}, function (props) {\n  return props.theme.fontWeight;\n}, function (props) {\n  return props.theme.fontSize;\n}, function (props) {\n  return props.theme.lineHeight;\n}, function (props) {\n  return props.theme.textColorHl;\n});\nfunction AddDataButtonFactory() {\n  var AddDataButton = function AddDataButton(_ref2) {\n    var onClick = _ref2.onClick,\n      isInactive = _ref2.isInactive;\n    return /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.Button, {\n      className: \"add-data-button\",\n      onClick: onClick,\n      isInactive: !isInactive,\n      width: \"105px\",\n      secondary: true\n    }, /*#__PURE__*/_react[\"default\"].createElement(_icons.Add, {\n      height: \"12px\"\n    }), /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n      id: 'layerManager.addData'\n    }));\n  };\n  return AddDataButton;\n}\nLayerManagerFactory.deps = [AddDataButtonFactory, _layerPanel[\"default\"], _sourceDataCatalog[\"default\"]];\nfunction LayerManagerFactory(AddDataButton, LayerPanel, SourceDataCatalog) {\n  // By wrapping layer panel using a sortable element we don't have to implement the drag and drop logic into the panel itself;\n  // Developers can provide any layer panel implementation and it will still be sortable\n  var SortableItem = (0, _reactSortableHoc.SortableElement)(function (_ref3) {\n    var children = _ref3.children,\n      isSorting = _ref3.isSorting;\n    return /*#__PURE__*/_react[\"default\"].createElement(SortableStyledItem, {\n      className: (0, _classnames[\"default\"])('sortable-layer-items', {\n        sorting: isSorting\n      })\n    }, children);\n  });\n  var WrappedSortableContainer = (0, _reactSortableHoc.SortableContainer)(function (_ref4) {\n    var children = _ref4.children;\n    return /*#__PURE__*/_react[\"default\"].createElement(\"div\", null, children);\n  });\n  var LayerManager = /*#__PURE__*/function (_Component) {\n    (0, _inherits2[\"default\"])(LayerManager, _Component);\n    var _super = _createSuper(LayerManager);\n    function LayerManager() {\n      var _this;\n      (0, _classCallCheck2[\"default\"])(this, LayerManager);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"state\", {\n        isSorting: false\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"layerClassSelector\", function (props) {\n        return props.layerClasses;\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"layerTypeOptionsSelector\", (0, _reselect.createSelector)(_this.layerClassSelector, function (layerClasses) {\n        return Object.keys(layerClasses).map(function (key) {\n          var layer = new layerClasses[key]();\n          return {\n            id: key,\n            label: layer.name,\n            icon: layer.layerIcon,\n            requireData: layer.requireData\n          };\n        });\n      }));\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_addEmptyNewLayer\", function () {\n        var visStateActions = _this.props.visStateActions;\n        visStateActions.addLayer();\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_handleSort\", function (_ref5) {\n        var oldIndex = _ref5.oldIndex,\n          newIndex = _ref5.newIndex;\n        var visStateActions = _this.props.visStateActions;\n        visStateActions.reorderLayer((0, _dataUtils.arrayMove)(_this.props.layerOrder, oldIndex, newIndex));\n        _this.setState({\n          isSorting: false\n        });\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_onSortStart\", function () {\n        _this.setState({\n          isSorting: true\n        });\n      });\n      (0, _defineProperty2[\"default\"])((0, _assertThisInitialized2[\"default\"])(_this), \"_updateBeforeSortStart\", function (_ref6) {\n        var index = _ref6.index;\n        // if layer config is active, close it\n        var _this$props = _this.props,\n          layerOrder = _this$props.layerOrder,\n          layers = _this$props.layers,\n          visStateActions = _this$props.visStateActions;\n        var layerIdx = layerOrder[index];\n        if (layers[layerIdx].config.isConfigActive) {\n          visStateActions.layerConfigChange(layers[layerIdx], {\n            isConfigActive: false\n          });\n        }\n      });\n      return _this;\n    }\n    (0, _createClass2[\"default\"])(LayerManager, [{\n      key: \"render\",\n      value: function render() {\n        var _this2 = this;\n        var _this$props2 = this.props,\n          layers = _this$props2.layers,\n          datasets = _this$props2.datasets,\n          intl = _this$props2.intl,\n          layerOrder = _this$props2.layerOrder,\n          showAddDataModal = _this$props2.showAddDataModal,\n          showDatasetTable = _this$props2.showDatasetTable,\n          removeDataset = _this$props2.removeDataset,\n          uiStateActions = _this$props2.uiStateActions,\n          visStateActions = _this$props2.visStateActions;\n        var openModal = uiStateActions.toggleModal;\n        var defaultDataset = Object.keys(datasets)[0];\n        var layerTypeOptions = this.layerTypeOptionsSelector(this.props);\n        var layerActions = {\n          layerColorUIChange: visStateActions.layerColorUIChange,\n          layerConfigChange: visStateActions.layerConfigChange,\n          layerVisualChannelConfigChange: visStateActions.layerVisualChannelConfigChange,\n          layerTypeChange: visStateActions.layerTypeChange,\n          layerVisConfigChange: visStateActions.layerVisConfigChange,\n          layerTextLabelChange: visStateActions.layerTextLabelChange,\n          removeLayer: visStateActions.removeLayer,\n          duplicateLayer: visStateActions.duplicateLayer\n        };\n        var panelProps = {\n          datasets: datasets,\n          openModal: openModal,\n          layerTypeOptions: layerTypeOptions\n        };\n        return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n          className: \"layer-manager\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(SourceDataCatalog, {\n          datasets: datasets,\n          showDatasetTable: showDatasetTable,\n          removeDataset: removeDataset,\n          showDeleteDataset: true\n        }), /*#__PURE__*/_react[\"default\"].createElement(AddDataButton, {\n          onClick: showAddDataModal,\n          isInactive: !defaultDataset\n        }), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.SidePanelDivider, null), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.SidePanelSection, null, /*#__PURE__*/_react[\"default\"].createElement(WrappedSortableContainer, {\n          onSortEnd: this._handleSort,\n          onSortStart: this._onSortStart,\n          updateBeforeSortStart: this._updateBeforeSortStart,\n          lockAxis: \"y\",\n          helperClass: \"sorting-layers\",\n          useDragHandle: true\n        }, layerOrder.map(function (layerIdx, index) {\n          return !layers[layerIdx].config.hidden && /*#__PURE__*/_react[\"default\"].createElement(SortableItem, {\n            key: \"layer-\".concat(layerIdx),\n            index: index,\n            isSorting: _this2.state.isSorting\n          }, /*#__PURE__*/_react[\"default\"].createElement(LayerPanel, (0, _extends2[\"default\"])({}, panelProps, layerActions, {\n            sortData: layerIdx,\n            key: layers[layerIdx].id,\n            idx: layerIdx,\n            layer: layers[layerIdx]\n          })));\n        }))), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.SidePanelSection, null, defaultDataset ? /*#__PURE__*/_react[\"default\"].createElement(_styledComponents2.Button, {\n          className: \"add-layer-button\",\n          onClick: this._addEmptyNewLayer,\n          width: \"105px\"\n        }, /*#__PURE__*/_react[\"default\"].createElement(_icons.Add, {\n          height: \"12px\"\n        }), /*#__PURE__*/_react[\"default\"].createElement(_localization.FormattedMessage, {\n          id: 'layerManager.addLayer'\n        })) : null), /*#__PURE__*/_react[\"default\"].createElement(LayerBlendingSelector, {\n          layerBlending: this.props.layerBlending,\n          updateLayerBlending: visStateActions.updateLayerBlending,\n          intl: intl\n        }));\n      }\n    }]);\n    return LayerManager;\n  }(_react.Component);\n  (0, _defineProperty2[\"default\"])(LayerManager, \"propTypes\", {\n    datasets: _propTypes[\"default\"].object.isRequired,\n    layerBlending: _propTypes[\"default\"].string.isRequired,\n    layerClasses: _propTypes[\"default\"].object.isRequired,\n    layers: _propTypes[\"default\"].arrayOf(_propTypes[\"default\"].any).isRequired,\n    visStateActions: _propTypes[\"default\"].object.isRequired,\n    // functions\n    removeDataset: _propTypes[\"default\"].func.isRequired,\n    showDatasetTable: _propTypes[\"default\"].func.isRequired\n  });\n  return (0, _reactIntl.injectIntl)(LayerManager);\n}\nvar _default = LayerManagerFactory;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../../src/components/side-panel/layer-manager.js"],"names":["LayerBlendingSelector","layerBlending","updateLayerBlending","intl","labeledLayerBlendings","keys","LAYER_BLENDINGS","reduce","acc","current","formatMessage","id","label","onChange","blending","Object","SortableStyledItem","styled","div","props","theme","dropdownWrapperZ","panelBackgroundHover","fontFamily","fontWeight","fontSize","lineHeight","textColorHl","AddDataButtonFactory","AddDataButton","onClick","isInactive","LayerManagerFactory","deps","LayerPanelFactory","SourceDataCatalogFactory","LayerPanel","SourceDataCatalog","SortableItem","children","isSorting","sorting","WrappedSortableContainer","LayerManager","Component","datasets","PropTypes","object","isRequired","string","layerClasses","layers","arrayOf","any","visStateActions","removeDataset","func","showDatasetTable","layerClassSelector","map","layer","key","name","icon","layerIcon","requireData","addLayer","oldIndex","newIndex","reorderLayer","layerOrder","setState","index","layerIdx","config","isConfigActive","layerConfigChange","showAddDataModal","uiStateActions","toggleModal","openModal","defaultDataset","layerTypeOptions","layerTypeOptionsSelector","layerActions","layerColorUIChange","layerVisualChannelConfigChange","layerTypeChange","layerVisConfigChange","layerTextLabelChange","removeLayer","duplicateLayer","panelProps","_handleSort","_onSortStart","_updateBeforeSortStart","hidden","state","_addEmptyNewLayer"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {Component, useCallback} from 'react';\nimport classnames from 'classnames';\n\nimport PropTypes from 'prop-types';\nimport {SortableContainer, SortableElement} from 'react-sortable-hoc';\nimport styled from 'styled-components';\nimport {createSelector} from 'reselect';\nimport {injectIntl} from 'react-intl';\nimport {FormattedMessage} from 'localization';\nimport {arrayMove} from 'utils/data-utils';\n\nimport LayerPanelFactory from './layer-panel/layer-panel';\nimport SourceDataCatalogFactory from './common/source-data-catalog';\nimport {Add} from 'components/common/icons';\nimport ItemSelector from 'components/common/item-selector/item-selector';\nimport {\n  Button,\n  PanelLabel,\n  SidePanelDivider,\n  SidePanelSection\n} from 'components/common/styled-components';\n\nimport {LAYER_BLENDINGS} from 'constants/default-settings';\n\nconst LayerBlendingSelector = ({layerBlending, updateLayerBlending, intl}) => {\n  const labeledLayerBlendings = Object.keys(LAYER_BLENDINGS).reduce(\n    (acc, current) => ({\n      ...acc,\n      [intl.formatMessage({id: LAYER_BLENDINGS[current].label})]: current\n    }),\n    {}\n  );\n\n  const onChange = useCallback(blending => updateLayerBlending(labeledLayerBlendings[blending]), [\n    updateLayerBlending,\n    labeledLayerBlendings\n  ]);\n\n  return (\n    <SidePanelSection>\n      <PanelLabel>\n        <FormattedMessage id=\"layerBlending.title\" />\n      </PanelLabel>\n      <ItemSelector\n        selectedItems={intl.formatMessage({id: LAYER_BLENDINGS[layerBlending].label})}\n        options={Object.keys(labeledLayerBlendings)}\n        multiSelect={false}\n        searchable={false}\n        onChange={onChange}\n      />\n    </SidePanelSection>\n  );\n};\n\n// make sure the element is always visible while is being dragged\n// item being dragged is appended in body, here to reset its global style\nconst SortableStyledItem = styled.div`\n  z-index: ${props => props.theme.dropdownWrapperZ + 1};\n\n  &.sorting {\n    pointer-events: none;\n  }\n\n  &.sorting-layers .layer-panel__header {\n    background-color: ${props => props.theme.panelBackgroundHover};\n    font-family: ${props => props.theme.fontFamily};\n    font-weight: ${props => props.theme.fontWeight};\n    font-size: ${props => props.theme.fontSize};\n    line-height: ${props => props.theme.lineHeight};\n    *,\n    *:before,\n    *:after {\n      box-sizing: border-box;\n    }\n    .layer__drag-handle {\n      opacity: 1;\n      color: ${props => props.theme.textColorHl};\n    }\n  }\n`;\n\nexport function AddDataButtonFactory() {\n  const AddDataButton = ({onClick, isInactive}) => (\n    <Button\n      className=\"add-data-button\"\n      onClick={onClick}\n      isInactive={!isInactive}\n      width=\"105px\"\n      secondary\n    >\n      <Add height=\"12px\" />\n      <FormattedMessage id={'layerManager.addData'} />\n    </Button>\n  );\n\n  return AddDataButton;\n}\n\nLayerManagerFactory.deps = [AddDataButtonFactory, LayerPanelFactory, SourceDataCatalogFactory];\n\nfunction LayerManagerFactory(AddDataButton, LayerPanel, SourceDataCatalog) {\n  // By wrapping layer panel using a sortable element we don't have to implement the drag and drop logic into the panel itself;\n  // Developers can provide any layer panel implementation and it will still be sortable\n  const SortableItem = SortableElement(({children, isSorting}) => {\n    return (\n      <SortableStyledItem className={classnames('sortable-layer-items', {sorting: isSorting})}>\n        {children}\n      </SortableStyledItem>\n    );\n  });\n\n  const WrappedSortableContainer = SortableContainer(({children}) => {\n    return <div>{children}</div>;\n  });\n\n  class LayerManager extends Component {\n    static propTypes = {\n      datasets: PropTypes.object.isRequired,\n      layerBlending: PropTypes.string.isRequired,\n      layerClasses: PropTypes.object.isRequired,\n      layers: PropTypes.arrayOf(PropTypes.any).isRequired,\n      visStateActions: PropTypes.object.isRequired,\n      // functions\n      removeDataset: PropTypes.func.isRequired,\n      showDatasetTable: PropTypes.func.isRequired\n    };\n    state = {\n      isSorting: false\n    };\n\n    layerClassSelector = props => props.layerClasses;\n    layerTypeOptionsSelector = createSelector(this.layerClassSelector, layerClasses =>\n      Object.keys(layerClasses).map(key => {\n        const layer = new layerClasses[key]();\n        return {\n          id: key,\n          label: layer.name,\n          icon: layer.layerIcon,\n          requireData: layer.requireData\n        };\n      })\n    );\n\n    _addEmptyNewLayer = () => {\n      const {visStateActions} = this.props;\n      visStateActions.addLayer();\n    };\n\n    _handleSort = ({oldIndex, newIndex}) => {\n      const {visStateActions} = this.props;\n      visStateActions.reorderLayer(arrayMove(this.props.layerOrder, oldIndex, newIndex));\n      this.setState({isSorting: false});\n    };\n\n    _onSortStart = () => {\n      this.setState({isSorting: true});\n    };\n\n    _updateBeforeSortStart = ({index}) => {\n      // if layer config is active, close it\n      const {layerOrder, layers, visStateActions} = this.props;\n      const layerIdx = layerOrder[index];\n      if (layers[layerIdx].config.isConfigActive) {\n        visStateActions.layerConfigChange(layers[layerIdx], {isConfigActive: false});\n      }\n    };\n\n    render() {\n      const {\n        layers,\n        datasets,\n        intl,\n        layerOrder,\n        showAddDataModal,\n        showDatasetTable,\n        removeDataset,\n        uiStateActions,\n        visStateActions\n      } = this.props;\n      const {toggleModal: openModal} = uiStateActions;\n      const defaultDataset = Object.keys(datasets)[0];\n      const layerTypeOptions = this.layerTypeOptionsSelector(this.props);\n\n      const layerActions = {\n        layerColorUIChange: visStateActions.layerColorUIChange,\n        layerConfigChange: visStateActions.layerConfigChange,\n        layerVisualChannelConfigChange: visStateActions.layerVisualChannelConfigChange,\n        layerTypeChange: visStateActions.layerTypeChange,\n        layerVisConfigChange: visStateActions.layerVisConfigChange,\n        layerTextLabelChange: visStateActions.layerTextLabelChange,\n        removeLayer: visStateActions.removeLayer,\n        duplicateLayer: visStateActions.duplicateLayer\n      };\n\n      const panelProps = {\n        datasets,\n        openModal,\n        layerTypeOptions\n      };\n\n      return (\n        <div className=\"layer-manager\">\n          <SourceDataCatalog\n            datasets={datasets}\n            showDatasetTable={showDatasetTable}\n            removeDataset={removeDataset}\n            showDeleteDataset\n          />\n          <AddDataButton onClick={showAddDataModal} isInactive={!defaultDataset} />\n          <SidePanelDivider />\n          <SidePanelSection>\n            <WrappedSortableContainer\n              onSortEnd={this._handleSort}\n              onSortStart={this._onSortStart}\n              updateBeforeSortStart={this._updateBeforeSortStart}\n              lockAxis=\"y\"\n              helperClass=\"sorting-layers\"\n              useDragHandle\n            >\n              {layerOrder.map(\n                (layerIdx, index) =>\n                  !layers[layerIdx].config.hidden && (\n                    <SortableItem\n                      key={`layer-${layerIdx}`}\n                      index={index}\n                      isSorting={this.state.isSorting}\n                    >\n                      <LayerPanel\n                        {...panelProps}\n                        {...layerActions}\n                        sortData={layerIdx}\n                        key={layers[layerIdx].id}\n                        idx={layerIdx}\n                        layer={layers[layerIdx]}\n                      />\n                    </SortableItem>\n                  )\n              )}\n            </WrappedSortableContainer>\n          </SidePanelSection>\n          <SidePanelSection>\n            {defaultDataset ? (\n              <Button className=\"add-layer-button\" onClick={this._addEmptyNewLayer} width=\"105px\">\n                <Add height=\"12px\" />\n                <FormattedMessage id={'layerManager.addLayer'} />\n              </Button>\n            ) : null}\n          </SidePanelSection>\n          <LayerBlendingSelector\n            layerBlending={this.props.layerBlending}\n            updateLayerBlending={visStateActions.updateLayerBlending}\n            intl={intl}\n          />\n        </div>\n      );\n    }\n  }\n  return injectIntl(LayerManager);\n}\n\nexport default LayerManagerFactory;\n"]},"metadata":{},"sourceType":"script"}