{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.processClone = processClone;\nexports.asArray = asArray;\nexports.fourRandomChars = fourRandomChars;\nexports.uid = uid;\nexports.makeImage = makeImage;\nexports.isDataUrl = isDataUrl;\nexports.mimeType = mimeType;\nexports.dataAsUrl = dataAsUrl;\nexports.escape = escape;\nexports.delay = delay;\nexports.isSrcAsDataUrl = isSrcAsDataUrl;\nexports.canvasToBlob = canvasToBlob;\nexports.escapeXhtml = escapeXhtml;\nexports.getWidth = getWidth;\nexports.getHeight = getHeight;\nexports.resolveUrl = resolveUrl;\nexports.getAndEncode = getAndEncode;\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _console = _interopRequireDefault(require(\"global/console\"));\nvar _window = _interopRequireDefault(require(\"global/window\"));\nvar _document = _interopRequireDefault(require(\"global/document\"));\nvar _userFeedbacks = require(\"../constants/user-feedbacks\");\n\n// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nfunction processClone(original, clone) {\n  if (!(clone instanceof _window[\"default\"].Element)) {\n    return clone;\n  }\n  function copyProperties(sourceStyle, targetStyle) {\n    var propertyKeys = asArray(sourceStyle);\n    propertyKeys.forEach(function (name) {\n      targetStyle.setProperty(name, sourceStyle.getPropertyValue(name), sourceStyle.getPropertyPriority(name));\n    });\n  }\n  function copyStyle(source, target) {\n    if (source.cssText) {\n      target.cssText = source.cssText; // add additional copy of composite styles\n\n      if (source.font) {\n        target.font = source.font;\n      }\n    } else {\n      copyProperties(source, target);\n    }\n  }\n  function cloneStyle(og, cln) {\n    var originalStyle = _window[\"default\"].getComputedStyle(og);\n    copyStyle(originalStyle, cln.style);\n  }\n  function formatPseudoElementStyle(cln, elm, stl) {\n    var formatCssText = function formatCssText(stl1) {\n      var cnt = stl1.getPropertyValue('content');\n      return \"\".concat(stl.cssText, \" content: \").concat(cnt, \";\");\n    };\n    var formatProperty = function formatProperty(name) {\n      return \"\".concat(name, \":\").concat(stl.getPropertyValue(name)).concat(stl.getPropertyPriority(name) ? ' !important' : '');\n    };\n    var formatCssProperties = function formatCssProperties(stl2) {\n      return \"\".concat(asArray(stl2).map(formatProperty).join('; '), \";\");\n    };\n    var selector = \".\".concat(cln, \":\").concat(elm);\n    var cssText = stl.cssText ? formatCssText(stl) : formatCssProperties(stl);\n    return _document[\"default\"].createTextNode(\"\".concat(selector, \"{\").concat(cssText, \"}\"));\n  }\n  function clonePseudoElement(org, cln, element) {\n    var style = _window[\"default\"].getComputedStyle(org, element);\n    var content = style.getPropertyValue('content');\n    if (content === '' || content === 'none') {\n      return;\n    }\n    var className = uid();\n    cln.className = \"\".concat(cln.className, \" \").concat(className);\n    var styleElement = _document[\"default\"].createElement('style');\n    styleElement.appendChild(formatPseudoElementStyle(className, element, style));\n    cln.appendChild(styleElement);\n  }\n  function clonePseudoElements(_ref) {\n    var _ref2 = (0, _slicedToArray2[\"default\"])(_ref, 2),\n      og = _ref2[0],\n      cln = _ref2[1];\n    [':before', ':after'].forEach(function (element) {\n      return clonePseudoElement(og, cln, element);\n    });\n  }\n  function copyUserInput(_ref3) {\n    var _ref4 = (0, _slicedToArray2[\"default\"])(_ref3, 2),\n      og = _ref4[0],\n      cln = _ref4[1];\n    if (og instanceof _window[\"default\"].HTMLTextAreaElement) cln.innerHTML = og.value;\n    if (og instanceof _window[\"default\"].HTMLInputElement) cln.setAttribute('value', og.value);\n  }\n  function fixSvg(cln) {\n    if (!(cln instanceof _window[\"default\"].SVGElement)) return;\n    cln.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n    if (!(cln instanceof _window[\"default\"].SVGRectElement)) return;\n    ['width', 'height'].forEach(function (attribute) {\n      var value = cln.getAttribute(attribute);\n      if (!value) return;\n      cln.style.setProperty(attribute, value);\n    });\n  }\n  return Promise.resolve([original, clone]).then(function (_ref5) {\n    var _ref6 = (0, _slicedToArray2[\"default\"])(_ref5, 2),\n      og = _ref6[0],\n      cln = _ref6[1];\n    cloneStyle(og, cln);\n    return [og, cln];\n  }).then(function (_ref7) {\n    var _ref8 = (0, _slicedToArray2[\"default\"])(_ref7, 2),\n      og = _ref8[0],\n      cln = _ref8[1];\n    clonePseudoElements([og, cln]);\n    return [og, cln];\n  }).then(function (_ref9) {\n    var _ref10 = (0, _slicedToArray2[\"default\"])(_ref9, 2),\n      og = _ref10[0],\n      cln = _ref10[1];\n    copyUserInput([og, cln]);\n    return [og, cln];\n  }).then(function (_ref11) {\n    var _ref12 = (0, _slicedToArray2[\"default\"])(_ref11, 2),\n      og = _ref12[0],\n      cln = _ref12[1];\n    fixSvg(cln);\n    return [og, cln];\n  }).then(function (_ref13) {\n    var _ref14 = (0, _slicedToArray2[\"default\"])(_ref13, 2),\n      og = _ref14[0],\n      cln = _ref14[1];\n    return cln;\n  });\n}\n/****\n * UTILS\n ****/\n\nfunction asArray(arrayLike) {\n  var array = [];\n  var length = arrayLike.length;\n  for (var i = 0; i < length; i++) {\n    array.push(arrayLike[i]);\n  }\n  return array;\n}\nfunction fourRandomChars() {\n  /* see http://stackoverflow.com/a/6248722/2519373 */\n  return \"0000\".concat((Math.random() * Math.pow(36, 4) << 0).toString(36)).slice(-4);\n}\nfunction uid() {\n  var index = 0;\n  return \"u\".concat(fourRandomChars()).concat(index++);\n}\nfunction makeImage(uri) {\n  return new Promise(function (resolve, reject) {\n    var image = new _window[\"default\"].Image();\n    image.onload = function () {\n      resolve(image);\n    };\n    image.onerror = function (err) {\n      var message = _userFeedbacks.IMAGE_EXPORT_ERRORS.dataUri;\n      _console[\"default\"].log(uri); // error is an Event Object\n      // https://www.w3schools.com/jsref/obj_event.asp\n\n      reject({\n        event: err,\n        message: message\n      });\n    };\n    image.src = uri;\n  });\n}\nfunction isDataUrl(url) {\n  return url.search(/^(data:)/) !== -1;\n}\nfunction parseExtension(url) {\n  var match = /\\.([^\\.\\/]*?)$/g.exec(url);\n  if (match) {\n    return match[1];\n  }\n  return '';\n}\nfunction mimes() {\n  /*\n   * Only WOFF and EOT mime types for fonts are 'real'\n   * see http://www.iana.org/assignments/media-types/media-types.xhtml\n   */\n  var WOFF = 'application/font-woff';\n  var JPEG = 'image/jpeg';\n  return {\n    woff: WOFF,\n    woff2: WOFF,\n    ttf: 'application/font-truetype',\n    eot: 'application/vnd.ms-fontobject',\n    png: 'image/png',\n    jpg: JPEG,\n    jpeg: JPEG,\n    gif: 'image/gif',\n    tiff: 'image/tiff',\n    svg: 'image/svg+xml'\n  };\n}\nfunction mimeType(url) {\n  var extension = parseExtension(url).toLowerCase();\n  return mimes()[extension] || '';\n}\nfunction dataAsUrl(content, type) {\n  return \"data:\".concat(type, \";base64,\").concat(content);\n}\nfunction escape(string) {\n  return string.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n}\nfunction delay(ms) {\n  return function (arg) {\n    return new Promise(function (resolve) {\n      _window[\"default\"].setTimeout(function () {\n        resolve(arg);\n      }, ms);\n    });\n  };\n}\nfunction isSrcAsDataUrl(text) {\n  var DATA_URL_REGEX = /url\\(['\"]?(data:)([^'\"]+?)['\"]?\\)/;\n  return text.search(DATA_URL_REGEX) !== -1;\n}\nfunction cvToBlob(canvas) {\n  return new Promise(function (resolve) {\n    var binaryString = _window[\"default\"].atob(canvas.toDataURL().split(',')[1]);\n    var length = binaryString.length;\n    var binaryArray = new Uint8Array(length);\n    for (var i = 0; i < length; i++) {\n      binaryArray[i] = binaryString.charCodeAt(i);\n    }\n    resolve(new _window[\"default\"].Blob([binaryArray], {\n      type: 'image/png'\n    }));\n  });\n}\nfunction canvasToBlob(canvas) {\n  if (canvas.toBlob) return new Promise(function (resolve) {\n    canvas.toBlob(resolve);\n  });\n  return cvToBlob(canvas);\n}\nfunction escapeXhtml(string) {\n  return string.replace(/#/g, '%23').replace(/\\n/g, '%0A');\n}\nfunction getWidth(node) {\n  var leftBorder = px(node, 'border-left-width');\n  var rightBorder = px(node, 'border-right-width');\n  return node.scrollWidth + leftBorder + rightBorder;\n}\nfunction getHeight(node) {\n  var topBorder = px(node, 'border-top-width');\n  var bottomBorder = px(node, 'border-bottom-width');\n  return node.scrollHeight + topBorder + bottomBorder;\n}\nfunction px(node, styleProperty) {\n  var value = _window[\"default\"].getComputedStyle(node).getPropertyValue(styleProperty);\n  return parseFloat(value.replace('px', ''));\n}\nfunction resolveUrl(url, baseUrl) {\n  var doc = _document[\"default\"].implementation.createHTMLDocument();\n  var base = doc.createElement('base');\n  doc.head.appendChild(base);\n  var a = doc.createElement('a');\n  doc.body.appendChild(a);\n  base.href = baseUrl;\n  a.href = url;\n  return a.href;\n}\nfunction getAndEncode(url, options) {\n  var TIMEOUT = 30000;\n  if (options.cacheBust) {\n    // Cache bypass so we dont have CORS issues with cached images\n    // Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n    url += (/\\?/.test(url) ? '&' : '?') + new Date().getTime();\n  }\n  return new Promise(function (resolve) {\n    var request = new _window[\"default\"].XMLHttpRequest();\n    request.onreadystatechange = done;\n    request.ontimeout = timeout;\n    request.responseType = 'blob';\n    request.timeout = TIMEOUT;\n    request.open('GET', url, true);\n    request.send();\n    var placeholder;\n    if (options.imagePlaceholder) {\n      var split = options.imagePlaceholder.split(/,/);\n      if (split && split[1]) {\n        placeholder = split[1];\n      }\n    }\n    function done() {\n      if (request.readyState !== 4) return;\n      if (request.status !== 200) {\n        if (placeholder) {\n          resolve(placeholder);\n        } else {\n          fail(\"cannot fetch resource: \".concat(url, \", status: \").concat(request.status));\n        }\n        return;\n      }\n      var encoder = new _window[\"default\"].FileReader();\n      encoder.onloadend = function () {\n        var content = encoder.result.split(/,/)[1];\n        resolve(content);\n      };\n      encoder.readAsDataURL(request.response);\n    }\n    function timeout() {\n      if (placeholder) {\n        resolve(placeholder);\n      } else {\n        fail(\"timeout of \".concat(TIMEOUT, \"ms occurred while fetching resource: \").concat(url));\n      }\n    }\n    function fail(message) {\n      _console[\"default\"].error(message);\n      resolve('');\n    }\n  });\n}","map":{"version":3,"sources":["../../src/utils/dom-utils.js"],"names":["processClone","original","clone","window","Element","copyProperties","sourceStyle","targetStyle","propertyKeys","asArray","forEach","setProperty","name","getPropertyValue","getPropertyPriority","copyStyle","source","target","cssText","font","cloneStyle","og","cln","originalStyle","getComputedStyle","style","formatPseudoElementStyle","elm","stl","formatCssText","cnt","stl1","formatProperty","formatCssProperties","stl2","map","join","selector","document","createTextNode","clonePseudoElement","org","element","content","className","uid","styleElement","createElement","appendChild","clonePseudoElements","copyUserInput","HTMLTextAreaElement","innerHTML","value","HTMLInputElement","setAttribute","fixSvg","SVGElement","SVGRectElement","getAttribute","attribute","resolve","then","arrayLike","array","length","i","push","fourRandomChars","Math","random","pow","toString","slice","index","makeImage","uri","Promise","reject","image","Image","onload","onerror","message","IMAGE_EXPORT_ERRORS","dataUri","console","log","event","err","src","isDataUrl","url","search","parseExtension","match","exec","mimes","WOFF","JPEG","woff","woff2","ttf","eot","png","jpg","jpeg","gif","tiff","svg","mimeType","extension","toLowerCase","dataAsUrl","type","escape","string","replace","delay","ms","setTimeout","arg","isSrcAsDataUrl","text","DATA_URL_REGEX","cvToBlob","canvas","binaryString","atob","toDataURL","split","binaryArray","Uint8Array","charCodeAt","Blob","canvasToBlob","toBlob","escapeXhtml","getWidth","node","leftBorder","px","rightBorder","scrollWidth","getHeight","topBorder","bottomBorder","scrollHeight","styleProperty","parseFloat","resolveUrl","baseUrl","doc","implementation","createHTMLDocument","base","head","a","body","href","getAndEncode","options","TIMEOUT","cacheBust","test","Date","getTime","request","XMLHttpRequest","onreadystatechange","done","ontimeout","timeout","responseType","open","send","placeholder","imagePlaceholder","readyState","status","fail","encoder","FileReader","onloadend","result","readAsDataURL","response","error"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport console from 'global/console';\nimport window from 'global/window';\nimport document from 'global/document';\nimport {IMAGE_EXPORT_ERRORS} from 'constants/user-feedbacks';\n\nexport function processClone(original, clone) {\n  if (!(clone instanceof window.Element)) {\n    return clone;\n  }\n\n  function copyProperties(sourceStyle, targetStyle) {\n    const propertyKeys = asArray(sourceStyle);\n    propertyKeys.forEach(name => {\n      targetStyle.setProperty(\n        name,\n        sourceStyle.getPropertyValue(name),\n        sourceStyle.getPropertyPriority(name)\n      );\n    });\n  }\n\n  function copyStyle(source, target) {\n    if (source.cssText) {\n      target.cssText = source.cssText;\n      // add additional copy of composite styles\n      if (source.font) {\n        target.font = source.font;\n      }\n    } else {\n      copyProperties(source, target);\n    }\n  }\n\n  function cloneStyle(og, cln) {\n    const originalStyle = window.getComputedStyle(og);\n    copyStyle(originalStyle, cln.style);\n  }\n\n  function formatPseudoElementStyle(cln, elm, stl) {\n    const formatCssText = stl1 => {\n      const cnt = stl1.getPropertyValue('content');\n      return `${stl.cssText} content: ${cnt};`;\n    };\n\n    const formatProperty = name => {\n      return `${name}:${stl.getPropertyValue(name)}${\n        stl.getPropertyPriority(name) ? ' !important' : ''\n      }`;\n    };\n\n    const formatCssProperties = stl2 => {\n      return `${asArray(stl2)\n        .map(formatProperty)\n        .join('; ')};`;\n    };\n\n    const selector = `.${cln}:${elm}`;\n    const cssText = stl.cssText ? formatCssText(stl) : formatCssProperties(stl);\n\n    return document.createTextNode(`${selector}{${cssText}}`);\n  }\n\n  function clonePseudoElement(org, cln, element) {\n    const style = window.getComputedStyle(org, element);\n    const content = style.getPropertyValue('content');\n\n    if (content === '' || content === 'none') {\n      return;\n    }\n\n    const className = uid();\n    cln.className = `${cln.className} ${className}`;\n    const styleElement = document.createElement('style');\n    styleElement.appendChild(formatPseudoElementStyle(className, element, style));\n    cln.appendChild(styleElement);\n  }\n\n  function clonePseudoElements([og, cln]) {\n    [':before', ':after'].forEach(element => clonePseudoElement(og, cln, element));\n  }\n\n  function copyUserInput([og, cln]) {\n    if (og instanceof window.HTMLTextAreaElement) cln.innerHTML = og.value;\n    if (og instanceof window.HTMLInputElement) cln.setAttribute('value', og.value);\n  }\n\n  function fixSvg(cln) {\n    if (!(cln instanceof window.SVGElement)) return;\n    cln.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n\n    if (!(cln instanceof window.SVGRectElement)) return;\n    ['width', 'height'].forEach(attribute => {\n      const value = cln.getAttribute(attribute);\n      if (!value) return;\n\n      cln.style.setProperty(attribute, value);\n    });\n  }\n\n  return Promise.resolve([original, clone])\n    .then(([og, cln]) => {\n      cloneStyle(og, cln);\n      return [og, cln];\n    })\n    .then(([og, cln]) => {\n      clonePseudoElements([og, cln]);\n      return [og, cln];\n    })\n    .then(([og, cln]) => {\n      copyUserInput([og, cln]);\n      return [og, cln];\n    })\n    .then(([og, cln]) => {\n      fixSvg(cln);\n      return [og, cln];\n    })\n    .then(([og, cln]) => cln);\n}\n\n/****\n * UTILS\n ****/\nexport function asArray(arrayLike) {\n  const array = [];\n  const length = arrayLike.length;\n  for (let i = 0; i < length; i++) array.push(arrayLike[i]);\n  return array;\n}\n\nexport function fourRandomChars() {\n  /* see http://stackoverflow.com/a/6248722/2519373 */\n  return `0000${((Math.random() * Math.pow(36, 4)) << 0).toString(36)}`.slice(-4);\n}\n\nexport function uid() {\n  let index = 0;\n\n  return `u${fourRandomChars()}${index++}`;\n}\n\nexport function makeImage(uri) {\n  return new Promise((resolve, reject) => {\n    const image = new window.Image();\n    image.onload = () => {\n      resolve(image);\n    };\n    image.onerror = err => {\n      const message = IMAGE_EXPORT_ERRORS.dataUri;\n      console.log(uri);\n      // error is an Event Object\n      // https://www.w3schools.com/jsref/obj_event.asp\n      reject({event: err, message});\n    };\n    image.src = uri;\n  });\n}\n\nexport function isDataUrl(url) {\n  return url.search(/^(data:)/) !== -1;\n}\n\nfunction parseExtension(url) {\n  const match = /\\.([^\\.\\/]*?)$/g.exec(url);\n  if (match) {\n    return match[1];\n  }\n  return '';\n}\n\nfunction mimes() {\n  /*\n   * Only WOFF and EOT mime types for fonts are 'real'\n   * see http://www.iana.org/assignments/media-types/media-types.xhtml\n   */\n  const WOFF = 'application/font-woff';\n  const JPEG = 'image/jpeg';\n\n  return {\n    woff: WOFF,\n    woff2: WOFF,\n    ttf: 'application/font-truetype',\n    eot: 'application/vnd.ms-fontobject',\n    png: 'image/png',\n    jpg: JPEG,\n    jpeg: JPEG,\n    gif: 'image/gif',\n    tiff: 'image/tiff',\n    svg: 'image/svg+xml'\n  };\n}\n\nexport function mimeType(url) {\n  const extension = parseExtension(url).toLowerCase();\n  return mimes()[extension] || '';\n}\n\nexport function dataAsUrl(content, type) {\n  return `data:${type};base64,${content}`;\n}\n\nexport function escape(string) {\n  return string.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n}\n\nexport function delay(ms) {\n  return arg => {\n    return new Promise(resolve => {\n      window.setTimeout(() => {\n        resolve(arg);\n      }, ms);\n    });\n  };\n}\n\nexport function isSrcAsDataUrl(text) {\n  const DATA_URL_REGEX = /url\\(['\"]?(data:)([^'\"]+?)['\"]?\\)/;\n\n  return text.search(DATA_URL_REGEX) !== -1;\n}\n\nfunction cvToBlob(canvas) {\n  return new Promise(resolve => {\n    const binaryString = window.atob(canvas.toDataURL().split(',')[1]);\n    const length = binaryString.length;\n    const binaryArray = new Uint8Array(length);\n\n    for (let i = 0; i < length; i++) binaryArray[i] = binaryString.charCodeAt(i);\n\n    resolve(new window.Blob([binaryArray], {type: 'image/png'}));\n  });\n}\n\nexport function canvasToBlob(canvas) {\n  if (canvas.toBlob)\n    return new Promise(resolve => {\n      canvas.toBlob(resolve);\n    });\n\n  return cvToBlob(canvas);\n}\n\nexport function escapeXhtml(string) {\n  return string.replace(/#/g, '%23').replace(/\\n/g, '%0A');\n}\n\nexport function getWidth(node) {\n  const leftBorder = px(node, 'border-left-width');\n  const rightBorder = px(node, 'border-right-width');\n  return node.scrollWidth + leftBorder + rightBorder;\n}\n\nexport function getHeight(node) {\n  const topBorder = px(node, 'border-top-width');\n  const bottomBorder = px(node, 'border-bottom-width');\n  return node.scrollHeight + topBorder + bottomBorder;\n}\n\nfunction px(node, styleProperty) {\n  const value = window.getComputedStyle(node).getPropertyValue(styleProperty);\n  return parseFloat(value.replace('px', ''));\n}\n\nexport function resolveUrl(url, baseUrl) {\n  const doc = document.implementation.createHTMLDocument();\n  const base = doc.createElement('base');\n  doc.head.appendChild(base);\n  const a = doc.createElement('a');\n  doc.body.appendChild(a);\n  base.href = baseUrl;\n  a.href = url;\n  return a.href;\n}\n\nexport function getAndEncode(url, options) {\n  const TIMEOUT = 30000;\n  if (options.cacheBust) {\n    // Cache bypass so we dont have CORS issues with cached images\n    // Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n    url += (/\\?/.test(url) ? '&' : '?') + new Date().getTime();\n  }\n\n  return new Promise(resolve => {\n    const request = new window.XMLHttpRequest();\n\n    request.onreadystatechange = done;\n    request.ontimeout = timeout;\n    request.responseType = 'blob';\n    request.timeout = TIMEOUT;\n    request.open('GET', url, true);\n    request.send();\n\n    let placeholder;\n    if (options.imagePlaceholder) {\n      const split = options.imagePlaceholder.split(/,/);\n      if (split && split[1]) {\n        placeholder = split[1];\n      }\n    }\n\n    function done() {\n      if (request.readyState !== 4) return;\n\n      if (request.status !== 200) {\n        if (placeholder) {\n          resolve(placeholder);\n        } else {\n          fail(`cannot fetch resource: ${url}, status: ${request.status}`);\n        }\n\n        return;\n      }\n\n      const encoder = new window.FileReader();\n      encoder.onloadend = () => {\n        const content = encoder.result.split(/,/)[1];\n        resolve(content);\n      };\n      encoder.readAsDataURL(request.response);\n    }\n\n    function timeout() {\n      if (placeholder) {\n        resolve(placeholder);\n      } else {\n        fail(`timeout of ${TIMEOUT}ms occurred while fetching resource: ${url}`);\n      }\n    }\n\n    function fail(message) {\n      console.error(message);\n      resolve('');\n    }\n  });\n}\n"]},"metadata":{},"sourceType":"script"}