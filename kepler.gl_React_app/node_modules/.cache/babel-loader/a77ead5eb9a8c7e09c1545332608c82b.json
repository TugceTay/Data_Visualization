{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _styledComponents = require(\"../../common/styled-components\");\nvar _filterPanelHeader = _interopRequireDefault(require(\"../../side-panel/filter-panel/filter-panel-header\"));\nvar _panelHeaderAction = _interopRequireDefault(require(\"../../side-panel/panel-header-action\"));\nvar _sourceDataSelector = _interopRequireDefault(require(\"../../side-panel/common/source-data-selector\"));\nvar _fieldSelector = _interopRequireDefault(require(\"../../common/field-selector\"));\nvar _newFilterPanel = require(\"./new-filter-panel\");\n\n// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nFieldPanelWithFieldSelectFactory.deps = [_filterPanelHeader[\"default\"], _sourceDataSelector[\"default\"], _fieldSelector[\"default\"], _panelHeaderAction[\"default\"]];\nfunction FieldPanelWithFieldSelectFactory(FilterPanelHeader, SourceDataSelector, FieldSelector, PanelHeaderAction) {\n  /** @type {import('./filter-panel-types').FilterPanelComponent} */\n  var FilterPanelWithFieldSelect = /*#__PURE__*/_react[\"default\"].memo(function (_ref) {\n    var allAvailableFields = _ref.allAvailableFields,\n      children = _ref.children,\n      datasets = _ref.datasets,\n      filter = _ref.filter,\n      idx = _ref.idx,\n      removeFilter = _ref.removeFilter,\n      setFilter = _ref.setFilter,\n      _ref$panelActions = _ref.panelActions,\n      panelActions = _ref$panelActions === void 0 ? [] : _ref$panelActions;\n    var onFieldSelector = (0, _react.useCallback)(function (field) {\n      return setFilter(idx, 'name', field.name);\n    }, [idx, setFilter]);\n    var onSourceDataSelector = (0, _react.useCallback)(function (value) {\n      return setFilter(idx, 'dataId', [value]);\n    }, [idx, setFilter]);\n    var fieldValue = (0, _react.useMemo)(function () {\n      return Array.isArray(filter.name) ? filter.name[0] : filter.name;\n    }, [filter.name]);\n    var dataset = datasets[filter.dataId[0]];\n    var supportedFields = (0, _react.useMemo)(function () {\n      return (0, _newFilterPanel.getSupportedFilterFields)(dataset.supportedFilterTypes, allAvailableFields);\n    }, [dataset.supportedFilterTypes, allAvailableFields]);\n    return /*#__PURE__*/_react[\"default\"].createElement(_react[\"default\"].Fragment, null, /*#__PURE__*/_react[\"default\"].createElement(FilterPanelHeader, {\n      datasets: [dataset],\n      allAvailableFields: supportedFields,\n      idx: idx,\n      filter: filter,\n      removeFilter: removeFilter\n    }, /*#__PURE__*/_react[\"default\"].createElement(FieldSelector, {\n      inputTheme: \"secondary\",\n      fields: supportedFields,\n      value: fieldValue,\n      erasable: false,\n      onSelect: onFieldSelector\n    }), panelActions && panelActions.map(function (panelAction) {\n      return /*#__PURE__*/_react[\"default\"].createElement(PanelHeaderAction, {\n        id: panelAction.id,\n        key: panelAction.id,\n        onClick: panelAction.onClick,\n        tooltip: panelAction.tooltip,\n        IconComponent: panelAction.iconComponent,\n        active: panelAction.active\n      });\n    })), /*#__PURE__*/_react[\"default\"].createElement(_styledComponents.StyledFilterContent, {\n      className: \"filter-panel__content\"\n    }, Object.keys(datasets).length > 1 && /*#__PURE__*/_react[\"default\"].createElement(SourceDataSelector, {\n      inputTheme: \"secondary\",\n      datasets: datasets,\n      disabled: filter.freeze,\n      dataId: filter.dataId,\n      onSelect: onSourceDataSelector\n    }), children));\n  });\n  FilterPanelWithFieldSelect.displayName = 'FilterPanelWithFieldSelect';\n  return FilterPanelWithFieldSelect;\n}\nvar _default = FieldPanelWithFieldSelectFactory;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../../../src/components/filters/filter-panels/filter-panel-with-field-select.js"],"names":["FieldPanelWithFieldSelectFactory","deps","FilterPanelHeaderFactory","SourceDataSelectorFactory","FieldSelectorFactory","PanelHeaderActionFactory","FilterPanelHeader","SourceDataSelector","FieldSelector","PanelHeaderAction","FilterPanelWithFieldSelect","memo","allAvailableFields","children","datasets","filter","idx","removeFilter","setFilter","panelActions","onFieldSelector","field","name","onSourceDataSelector","value","fieldValue","Array","isArray","dataset","dataId","supportedFields","supportedFilterTypes","map","panelAction","id","onClick","tooltip","iconComponent","active","Object","keys","length","freeze","displayName"],"mappings":"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","sourcesContent":["// Copyright (c) 2021 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {useCallback, useMemo} from 'react';\nimport {StyledFilterContent} from 'components/common/styled-components';\nimport FilterPanelHeaderFactory from 'components/side-panel/filter-panel/filter-panel-header';\nimport PanelHeaderActionFactory from 'components/side-panel/panel-header-action';\nimport SourceDataSelectorFactory from 'components/side-panel/common/source-data-selector';\nimport FieldSelectorFactory from '../../common/field-selector';\nimport {getSupportedFilterFields} from './new-filter-panel';\n\nFieldPanelWithFieldSelectFactory.deps = [\n  FilterPanelHeaderFactory,\n  SourceDataSelectorFactory,\n  FieldSelectorFactory,\n  PanelHeaderActionFactory\n];\n\nfunction FieldPanelWithFieldSelectFactory(\n  FilterPanelHeader,\n  SourceDataSelector,\n  FieldSelector,\n  PanelHeaderAction\n) {\n  /** @type {import('./filter-panel-types').FilterPanelComponent} */\n  const FilterPanelWithFieldSelect = React.memo(\n    ({\n      allAvailableFields,\n      children,\n      datasets,\n      filter,\n      idx,\n      removeFilter,\n      setFilter,\n      panelActions = []\n    }) => {\n      const onFieldSelector = useCallback(field => setFilter(idx, 'name', field.name), [\n        idx,\n        setFilter\n      ]);\n\n      const onSourceDataSelector = useCallback(value => setFilter(idx, 'dataId', [value]), [\n        idx,\n        setFilter\n      ]);\n\n      const fieldValue = useMemo(\n        () => ((Array.isArray(filter.name) ? filter.name[0] : filter.name)),\n        [filter.name]\n      );\n\n      const dataset = datasets[filter.dataId[0]];\n      const supportedFields = useMemo(\n        () => getSupportedFilterFields(dataset.supportedFilterTypes, allAvailableFields),\n        [dataset.supportedFilterTypes, allAvailableFields]\n      );\n      return (\n        <>\n          <FilterPanelHeader\n            datasets={[dataset]}\n            allAvailableFields={supportedFields}\n            idx={idx}\n            filter={filter}\n            removeFilter={removeFilter}\n          >\n            <FieldSelector\n              inputTheme=\"secondary\"\n              fields={supportedFields}\n              value={fieldValue}\n              erasable={false}\n              onSelect={onFieldSelector}\n            />\n            {panelActions &&\n              panelActions.map(panelAction => (\n                <PanelHeaderAction\n                  id={panelAction.id}\n                  key={panelAction.id}\n                  onClick={panelAction.onClick}\n                  tooltip={panelAction.tooltip}\n                  IconComponent={panelAction.iconComponent}\n                  active={panelAction.active}\n                />\n              ))}\n          </FilterPanelHeader>\n          <StyledFilterContent className=\"filter-panel__content\">\n            {Object.keys(datasets).length > 1 && (\n              <SourceDataSelector\n                inputTheme=\"secondary\"\n                datasets={datasets}\n                disabled={filter.freeze}\n                dataId={filter.dataId}\n                onSelect={onSourceDataSelector}\n              />\n            )}\n            {children}\n          </StyledFilterContent>\n        </>\n      );\n    }\n  );\n\n  FilterPanelWithFieldSelect.displayName = 'FilterPanelWithFieldSelect';\n\n  return FilterPanelWithFieldSelect;\n}\n\nexport default FieldPanelWithFieldSelectFactory;\n"]},"metadata":{},"sourceType":"script"}